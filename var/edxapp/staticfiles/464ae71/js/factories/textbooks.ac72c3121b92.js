/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */

/*!
 * jQuery Form Plugin
 * version: 3.18 (28-SEP-2012)
 * @requires jQuery v1.5 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses:
 *    http://malsup.github.com/mit-license.txt
 *    http://malsup.github.com/gpl-license-v2.txt
 */

!function(e,t){var n=t.prototype.trim,i=t.prototype.trimRight,r=t.prototype.trimLeft,s=function(e){return 1*e||0},a=function(e,t){if(1>t)return"";for(var n="";t>0;)1&t&&(n+=e),t>>=1,e+=e;return n},o=[].slice,l=function(e){return null==e?"\\s":e.source?e.source:"["+p.escapeRegExp(e)+"]"},c={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"},u={};for(var d in c)u[c[d]]=d;var h=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var n=a,i=function(){return i.cache.hasOwnProperty(arguments[0])||(i.cache[arguments[0]]=i.parse(arguments[0])),i.format.call(null,i.cache[arguments[0]],arguments)};return i.format=function(i,r){var s,a,o,l,c,u,d,p=1,f=i.length,m="",g=[];for(a=0;f>a;a++)if(m=e(i[a]),"string"===m)g.push(i[a]);else if("array"===m){if(l=i[a],l[2])for(s=r[p],o=0;o<l[2].length;o++){if(!s.hasOwnProperty(l[2][o]))throw new Error(h('[_.sprintf] property "%s" does not exist',l[2][o]));s=s[l[2][o]]}else s=l[1]?r[l[1]]:r[p++];if(/[^s]/.test(l[8])&&"number"!=e(s))throw new Error(h("[_.sprintf] expecting number but found %s",e(s)));switch(l[8]){case"b":s=s.toString(2);break;case"c":s=t.fromCharCode(s);break;case"d":s=parseInt(s,10);break;case"e":s=l[7]?s.toExponential(l[7]):s.toExponential();break;case"f":s=l[7]?parseFloat(s).toFixed(l[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s=t(s))&&l[7]?s.substring(0,l[7]):s;break;case"u":s=Math.abs(s);break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}s=/[def]/.test(l[8])&&l[3]&&s>=0?"+"+s:s,u=l[4]?"0"==l[4]?"0":l[4].charAt(1):" ",d=l[6]-t(s).length,c=l[6]?n(u,d):"",g.push(l[5]?s+c:c+s)}return g.join("")},i.cache={},i.parse=function(e){for(var t=e,n=[],i=[],r=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))i.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))i.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw new Error("[_.sprintf] huh?");if(n[2]){r|=1;var s=[],a=n[2],o=[];if(null===(o=/^([a-z_][a-z_\d]*)/i.exec(a)))throw new Error("[_.sprintf] huh?");for(s.push(o[1]);""!==(a=a.substring(o[0].length));)if(null!==(o=/^\.([a-z_][a-z_\d]*)/i.exec(a)))s.push(o[1]);else{if(null===(o=/^\[(\d+)\]/.exec(a)))throw new Error("[_.sprintf] huh?");s.push(o[1])}n[2]=s}else r|=2;if(3===r)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");i.push(n)}t=t.substring(n[0].length)}return i},i}(),p={VERSION:"2.3.0",isBlank:function(e){return null==e&&(e=""),/^\s*$/.test(e)},stripTags:function(e){return null==e?"":t(e).replace(/<\/?[^>]+>/g,"")},capitalize:function(e){return e=null==e?"":t(e),e.charAt(0).toUpperCase()+e.slice(1)},chop:function(e,n){return null==e?[]:(e=t(e),n=~~n,n>0?e.match(new RegExp(".{1,"+n+"}","g")):[e])},clean:function(e){return p.strip(e).replace(/\s+/g," ")},count:function(e,n){return null==e||null==n?0:t(e).split(n).length-1},chars:function(e){return null==e?[]:t(e).split("")},swapCase:function(e){return null==e?"":t(e).replace(/\S/g,function(e){return e===e.toUpperCase()?e.toLowerCase():e.toUpperCase()})},escapeHTML:function(e){return null==e?"":t(e).replace(/[&<>"']/g,function(e){return"&"+u[e]+";"})},unescapeHTML:function(e){return null==e?"":t(e).replace(/\&([^;]+);/g,function(e,n){var i;return n in c?c[n]:(i=n.match(/^#x([\da-fA-F]+)$/))?t.fromCharCode(parseInt(i[1],16)):(i=n.match(/^#(\d+)$/))?t.fromCharCode(~~i[1]):e})},escapeRegExp:function(e){return null==e?"":t(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(e,t,n,i){var r=p.chars(e);return r.splice(~~t,~~n,i),r.join("")},insert:function(e,t,n){return p.splice(e,t,0,n)},include:function(e,n){return""===n?!0:null==e?!1:-1!==t(e).indexOf(n)},join:function(){var e=o.call(arguments),t=e.shift();return null==t&&(t=""),e.join(t)},lines:function(e){return null==e?[]:t(e).split("\n")},reverse:function(e){return p.chars(e).reverse().join("")},startsWith:function(e,n){return""===n?!0:null==e||null==n?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(0,n.length)===n)},endsWith:function(e,n){return""===n?!0:null==e||null==n?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(e.length-n.length)===n)},succ:function(e){return null==e?"":(e=t(e),e.slice(0,-1)+t.fromCharCode(e.charCodeAt(e.length-1)+1))},titleize:function(e){return null==e?"":t(e).replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},camelize:function(e){return p.trim(e).replace(/[-_\s]+(.)?/g,function(e,t){return t.toUpperCase()})},underscored:function(e){return p.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(e){return p.trim(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(e){return p.titleize(t(e).replace(/_/g," ")).replace(/\s/g,"")},humanize:function(e){return p.capitalize(p.underscored(e).replace(/_id$/,"").replace(/_/g," "))},trim:function(e,i){return null==e?"":!i&&n?n.call(e):(i=l(i),t(e).replace(new RegExp("^"+i+"+|"+i+"+$","g"),""))},ltrim:function(e,n){return null==e?"":!n&&r?r.call(e):(n=l(n),t(e).replace(new RegExp("^"+n+"+"),""))},rtrim:function(e,n){return null==e?"":!n&&i?i.call(e):(n=l(n),t(e).replace(new RegExp(n+"+$"),""))},truncate:function(e,n,i){return null==e?"":(e=t(e),i=i||"...",n=~~n,e.length>n?e.slice(0,n)+i:e)},prune:function(e,n,i){if(null==e)return"";if(e=t(e),n=~~n,i=null!=i?t(i):"...",e.length<=n)return e;var r=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},s=e.slice(0,n+1).replace(/.(?=\W*\w*$)/g,r);return s=s.slice(s.length-2).match(/\w\w/)?s.replace(/\s*\S+$/,""):p.rtrim(s.slice(0,s.length-1)),(s+i).length>e.length?e:e.slice(0,s.length)+i},words:function(e,t){return p.isBlank(e)?[]:p.trim(e,t).split(t||/\s+/)},pad:function(e,n,i,r){e=null==e?"":t(e),n=~~n;var s=0;switch(i?i.length>1&&(i=i.charAt(0)):i=" ",r){case"right":return s=n-e.length,e+a(i,s);case"both":return s=n-e.length,a(i,Math.ceil(s/2))+e+a(i,Math.floor(s/2));default:return s=n-e.length,a(i,s)+e}},lpad:function(e,t,n){return p.pad(e,t,n)},rpad:function(e,t,n){return p.pad(e,t,n,"right")},lrpad:function(e,t,n){return p.pad(e,t,n,"both")},sprintf:h,vsprintf:function(e,t){return t.unshift(e),h.apply(null,t)},toNumber:function(e,n){if(null==e||""==e)return 0;e=t(e);var i=s(s(e).toFixed(~~n));return 0!==i||e.match(/^0+$/)?i:Number.NaN},numberFormat:function(e,t,n,i){if(isNaN(e)||null==e)return"";e=e.toFixed(~~t),i=i||",";var r=e.split("."),s=r[0],a=r[1]?(n||".")+r[1]:"";return s.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+i)+a},strRight:function(e,n){if(null==e)return"";e=t(e),n=null!=n?t(n):n;var i=n?e.indexOf(n):-1;return~i?e.slice(i+n.length,e.length):e},strRightBack:function(e,n){if(null==e)return"";e=t(e),n=null!=n?t(n):n;var i=n?e.lastIndexOf(n):-1;return~i?e.slice(i+n.length,e.length):e},strLeft:function(e,n){if(null==e)return"";e=t(e),n=null!=n?t(n):n;var i=n?e.indexOf(n):-1;return~i?e.slice(0,i):e},strLeftBack:function(e,t){if(null==e)return"";e+="",t=null!=t?""+t:t;var n=e.lastIndexOf(t);return~n?e.slice(0,n):e},toSentence:function(e,t,n,i){t=t||", ",n=n||" and ";var r=e.slice(),s=r.pop();return e.length>2&&i&&(n=p.rtrim(t)+n),r.length?r.join(t)+n+s:s},toSentenceSerial:function(){var e=o.call(arguments);return e[3]=!0,p.toSentence.apply(p,e)},slugify:function(e){if(null==e)return"";var n="ąàáäâãåæćęèéëêìíïîłńòóöôõøùúüûñçżź",i="aaaaaaaaceeeeeiiiilnoooooouuuunczz",r=new RegExp(l(n),"g");return e=t(e).toLowerCase().replace(r,function(e){var t=n.indexOf(e);return i.charAt(t)||"-"}),p.dasherize(e.replace(/[^\w\s-]/g,""))},surround:function(e,t){return[t,e,t].join("")},quote:function(e){return p.surround(e,'"')},exports:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&!t.match(/^(?:include|contains|reverse)$/)&&(e[t]=this[t]);return e},repeat:function(e,n,i){if(null==e)return"";if(n=~~n,null==i)return a(t(e),n);for(var r=[];n>0;r[--n]=e);return r.join(i)},levenshtein:function(e,n){if(null==e&&null==n)return 0;if(null==e)return t(n).length;if(null==n)return t(e).length;e=t(e),n=t(n);for(var i,r,s=[],a=0;a<=n.length;a++)for(var o=0;o<=e.length;o++)r=a&&o?e.charAt(o-1)===n.charAt(a-1)?i:Math.min(s[o],s[o-1],i)+1:a+o,i=s[o],s[o]=r;return s.pop()}};p.strip=p.trim,p.lstrip=p.ltrim,p.rstrip=p.rtrim,p.center=p.lrpad,p.rjust=p.lpad,p.ljust=p.rpad,p.contains=p.include,p.q=p.quote,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(module.exports=p),exports._s=p):"function"==typeof define&&define.amd?define("underscore.string",[],function(){return p}):(e._=e._||{},e._.string=e._.str=p)}(this,String),define("js/utils/templates",["jquery","underscore"],function(e,t){var n=function(n){var i="#"+n+"-tpl",r=e(i).text();return r||console.error("Failed to load "+n+" template"),t.template(r)};return{loadTemplate:n}}),define("js/views/feedback",["jquery","underscore","underscore.string","backbone","js/utils/templates"],function(e,t,n,i,r){var s=i.View.extend({options:{title:"",message:"",intent:null,type:null,shown:!0,icon:!0,closeIcon:!0,minShown:0,maxShown:1/0},initialize:function(){if(!this.options.type)throw"SystemFeedback: type required (given "+JSON.stringify(this.options)+")";if(!this.options.intent)throw"SystemFeedback: intent required (given "+JSON.stringify(this.options)+")";return this.template=r.loadTemplate("system-feedback"),this.setElement(e("#page-"+this.options.type)),this.options.actions&&this.options.actions.secondary&&!t.isArray(this.options.actions.secondary)&&(this.options.actions.secondary=[this.options.actions.secondary]),this},show:function(){return clearTimeout(this.hideTimeout),this.options.shown=!0,this.shownAt=new Date,this.render(),e.isNumeric(this.options.maxShown)&&(this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.maxShown)),this},hide:function(){return this.shownAt&&e.isNumeric(this.options.minShown)&&this.options.minShown>new Date-this.shownAt?(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.minShown-(new Date-this.shownAt))):(this.options.shown=!1,delete this.shownAt,this.render()),this},events:{"click .action-close":"hide","click .action-primary":"primaryClick","click .action-secondary":"secondaryClick"},render:function(){var e=s["active_"+this.options.type];return e&&e!==this&&(e.stopListening(),e.undelegateEvents()),this.$el.html(this.template(this.options)),s["active_"+this.options.type]=this,this},primaryClick:function(e){var t,n;t=this.options.actions,t&&(n=t.primary,n&&(n.preventDefault!==!1&&e.preventDefault(),n.click&&n.click.call(e.target,this,e)))},secondaryClick:function(e){var n,i,r,s;n=this.options.actions,n&&(i=n.secondary,i&&(s=0,e&&e.target&&(s=t.indexOf(this.$(".action-secondary"),e.target)),r=i[s],r.preventDefault!==!1&&e.preventDefault(),r.click&&r.click.call(e.target,this,e)))}});return s}),define("js/views/feedback_notification",["jquery","underscore","underscore.string","js/views/feedback"],function(e,t,n,i){var r,s,a=i.extend({options:e.extend({},i.prototype.options,{type:"notification",closeIcon:!1})});r=t.compose(n.capitalize,n.camelize),s=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(s,function(t){var n;n=a.extend({options:e.extend({},a.prototype.options,{intent:t})}),a[r(t)]=n});var o=a.Mini.prototype.options;return o.minShown=1250,o.closeIcon=!1,a}),define("js/utils/module",["underscore"],function(e){var t="/xblock",n=function(n){return e.isUndefined(n)?t+"/":t+"/"+n};return{urlRoot:t,getUpdateUrl:n}}),define("js/models/section",["backbone","gettext","js/views/feedback_notification","js/utils/module"],function(e,t,n,i){var r=e.Model.extend({defaults:{name:""},validate:function(e){return e.name?void 0:t("You must specify a name")},urlRoot:i.urlRoot,toJSON:function(){return{metadata:{display_name:this.get("name")}}},initialize:function(){this.listenTo(this,"request",this.showNotification),this.listenTo(this,"sync",this.hideNotification)},showNotification:function(){this.msg||(this.msg=new n.Mini({title:t("Saving")})),this.msg.show()},hideNotification:function(){this.msg&&this.msg.hide()}});return r}),function(){var e,t,n,i,r,s,a,o,l,c,u=this;"undefined"==typeof window?(e=require("underscore"),t=require("backbone"),"undefined"!=typeof exports&&(exports=module.exports=t)):(e=u._,t=u.Backbone),n=t.Model,i=t.Collection,r=n.prototype,s=i.prototype,l=/[\.\[\]]+/g,a="change add remove reset sort destroy".split(" "),c=["reset","sort"],t.Associations={VERSION:"0.5.0"},t.Associations.Many=t.Many="Many",t.Associations.One=t.One="One",o=t.AssociatedModel=t.Associations.AssociatedModel=n.extend({relations:void 0,_proxyCalls:void 0,get:function(e){var t=r.get.call(this,e);return t?t:this._getAttr.apply(this,arguments)},set:function(t,n,i){var r;return e.isObject(t)||null==t?(r=t,i=n):(r={},r[t]=n),t=this._set(r,i),this._processPendingEvents(),t},_set:function(t,n){var i,r,s,a,c=this;if(!t)return this;for(i in t)if(r||(r={}),i.match(l)){var u=h(i);a=e.initial(u),u=u[u.length-1],a=this.get(a),a instanceof o&&(a=r[a.cid]||(r[a.cid]={model:a,data:{}}),a.data[u]=t[i])}else a=r[this.cid]||(r[this.cid]={model:this,data:{}}),a.data[i]=t[i];if(r)for(s in r)a=r[s],this._setAttr.call(a.model,a.data,n)||(c=!1);else c=this._setAttr.call(this,t,n);return c},_setAttr:function(n,s){var a;if(s||(s={}),s.unset)for(a in n)n[a]=void 0;return this.parents=this.parents||[],this.relations&&e.each(this.relations,function(r){var a,l,c,u,d=r.key,h=r.relatedModel,f=r.collectionType,m=r.map,g=this.attributes[d],v=g&&g.idAttribute;if(h&&e.isString(h)&&(h=p(h)),f&&e.isString(f)&&(f=p(f)),m&&e.isString(m)&&(m=p(m)),l=r.options?e.extend({},r.options,s):s,n[d]){if(a=e.result(n,d),a=m?m(a):a,r.type===t.Many){if(f&&!f.prototype instanceof i)throw Error("collectionType must inherit from Backbone.Collection");a instanceof i?c=a:g?(g._deferEvents=!0,g.set(a,s),c=g):(c=f?new f:this._createCollection(h),c.add(a,l))}else r.type===t.One&&h&&(a instanceof o?c=a:g?g&&a[v]&&g.get(v)===a[v]?(g._deferEvents=!0,g._set(a,s),c=g):c=new h(a,l):c=new h(a,l));(u=n[d]=c)&&!u._proxyCallback&&(u._proxyCallback=function(){return this._bubbleEvent.call(this,d,u,arguments)},u.on("all",u._proxyCallback,this))}n.hasOwnProperty(d)&&(r=n[d],h=this.attributes[d],r?(r.parents=r.parents||[],-1==e.indexOf(r.parents,this)&&r.parents.push(this)):h&&h.parents.length>0&&(h.parents=e.difference(h.parents,[this])))},this),r.set.call(this,n,s)},_bubbleEvent:function(t,n,r){var s,l=r[0].split(":"),u=l[0],d="nested-change"==r[0],p=r[1],f=r[2],m=-1,g=n._proxyCalls,v=-1!==e.indexOf(a,u);if(!d){if(e.size(l)>1&&(s=l[1]),-1!==e.indexOf(c,u)&&(f=p),n instanceof i&&v&&p){var y=h(s),b=e.initial(y);(l=n.find(function(e){if(p===e)return!0;if(!e)return!1;var t=e.get(b);return(t instanceof o||t instanceof i)&&p===t?!0:(t=e.get(y),(t instanceof o||t instanceof i)&&p===t||t instanceof i&&f&&f===t?!0:void 0)}))&&(m=n.indexOf(l))}return s=t+(-1===m||"change"!==u&&!s?"":"["+m+"]")+(s?"."+s:""),/\[\*\]/g.test(s)?this:(l=s.replace(/\[\d+\]/g,"[*]"),m=[],m.push.apply(m,r),m[0]=u+":"+s,g=n._proxyCalls=g||{},this._isEventAvailable.call(this,g,s)?this:(g[s]=!0,"change"===u&&(this._previousAttributes[t]=n._previousAttributes,this.changed[t]=n),this.trigger.apply(this,m),"change"===u&&this.get(s)!=r[2]&&this.trigger.apply(this,["nested-change",s,r[1]]),g&&s&&delete g[s],s!==l&&(m[0]=u+":"+l,this.trigger.apply(this,m)),this))}},_isEventAvailable:function(t,n){return e.find(t,function(e,t){return-1!==n.indexOf(t,n.length-t.length)})},_createCollection:function(t){var n=t;if(e.isString(n)&&(n=p(n)),!(n&&n.prototype instanceof o))throw Error("type must inherit from Backbone.AssociatedModel");return t=new i,t.model=n,t},_processPendingEvents:function(){this.visited||(this.visited=!0,this._deferEvents=!1,e.each(this._pendingEvents,function(e){e.c.trigger.apply(e.c,e.a)}),this._pendingEvents=[],e.each(this.relations,function(e){(e=this.attributes[e.key])&&e._processPendingEvents()},this),delete this.visited)},trigger:function(){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):r.trigger.apply(this,arguments)},toJSON:function(t){var n,i;return this.visited||(this.visited=!0,n=r.toJSON.apply(this,arguments),this.relations&&e.each(this.relations,function(r){var s=this.attributes[r.key];s&&(i=s.toJSON(t),n[r.key]=e.isArray(i)?e.compact(i):i)},this),delete this.visited),n},clone:function(){return new this.constructor(this.toJSON())},_getAttr:function(t){var n,r,s=this,t=h(t);if(!(e.size(t)<1)){for(r=0;r<t.length&&(n=t[r],s);r++)s=s instanceof i?isNaN(n)?void 0:s.at(n):s.attributes[n];return s}}});var d=/[^\.\[\]]+/g,h=function(t){return""===t?[""]:e.isString(t)?t.match(d):t||[]},p=function(t){return e.reduce(t.split("."),function(e,t){return e[t]},u)},f=function(t,n,i){var r;return e.find(t,function(t){return(r=e.find(t.relations,function(e){return t.get(e.key)===n},this))?!0:void 0},this),r&&r.map?r.map(i):i},m={};e.each(["set","remove","reset"],function(e){m[e]=i.prototype[e],s[e]=function(t){return this.model.prototype instanceof o&&this.parents&&(arguments[0]=f(this.parents,this,t)),m[e].apply(this,arguments)}}),m.trigger=s.trigger,s.trigger=function(){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):m.trigger.apply(this,arguments)},s._processPendingEvents=o.prototype._processPendingEvents}.call(this),define("backbone.associations",["backbone"],function(e){return function(){var t;return t||e.Backbone.Associations}}(this)),define("js/models/chapter",["backbone","backbone.associations"],function(e){var t=e.AssociatedModel.extend({defaults:function(){return{name:"",asset_path:"",order:this.collection?this.collection.nextOrder():1}},isEmpty:function(){return!this.get("name")&&!this.get("asset_path")},parse:function(e){return"title"in e&&!("name"in e)&&(e.name=e.title,delete e.title),"url"in e&&!("asset_path"in e)&&(e.asset_path=e.url,delete e.url),e},toJSON:function(){return{title:this.get("name"),url:this.get("asset_path")}},validate:function(e){return e.name||e.asset_path?e.name?e.asset_path?void 0:{message:"asset_path is required",attributes:{asset_path:!0}}:{message:"Chapter name is required",attributes:{name:!0}}:{message:"Chapter name and asset_path are both required",attributes:{name:!0,asset_path:!0}}}});return t}),define("js/collections/chapter",["backbone","js/models/chapter"],function(e,t){var n=e.Collection.extend({model:t,comparator:"order",nextOrder:function(){return this.length?this.last().get("order")+1:1},isEmpty:function(){return 0===this.length||this.every(function(e){return e.isEmpty()})}});return n}),function(){this.AjaxPrefix={addAjaxPrefix:function(e,t){return e.postWithPrefix=function(e,n,i,r){return $.post(""+t()+e,n,i,r)},e.getWithPrefix=function(e,n,i,r){return $.get(""+t()+e,n,i,r)},e.ajaxWithPrefix=function(e,n){return null!=n?$.ajax(""+t()+e,n):(n=e,n.url=""+t()+n.url,$.ajax(n))}}}}.call(this),define("coffee/src/ajax_prefix",function(){}),function(e){e.cookie=function(t,n,i){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(n))||null===n||void 0===n)){if(i=e.extend({},i),(null===n||void 0===n)&&(i.expires=-1),"number"==typeof i.expires){var r=i.expires,s=i.expires=new Date;s.setDate(s.getDate()+r)}return n=String(n),document.cookie=[encodeURIComponent(t),"=",i.raw?n:encodeURIComponent(n),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}i=n||{};for(var a,o=i.raw?function(e){return e}:decodeURIComponent,l=document.cookie.split("; "),c=0;a=l[c]&&l[c].split("=");c++)if(o(a[0])===t)return o(a[1]||"");return null}}(jQuery),define("jquery.cookie",["jquery"],function(e){return function(){var t;return t||e.jQuery.fn.cookie}}(this)),function(){define("coffee/src/main",["domReady","jquery","underscore.string","backbone","gettext","js/views/feedback_notification","coffee/src/ajax_prefix","jquery.cookie"],function(e,t,n,i,r,s){var a;return a=function(){return AjaxPrefix.addAjaxPrefix(jQuery,function(){return t("meta[name='path_prefix']").attr("content")}),window.CMS=window.CMS||{},CMS.URL=CMS.URL||{},window.onTouchBasedDevice=function(){return navigator.userAgent.match(/iPhone|iPod|iPad|Android/i)},_.extend(CMS,i.Events),i.emulateHTTP=!0,t.ajaxSetup({headers:{"X-CSRFToken":t.cookie("csrftoken")},dataType:"json"}),t(document).ajaxError(function(e,t,i){var a,o;if(i.notifyOnError!==!1){if(t.responseText)try{a=JSON.parse(t.responseText).error}catch(l){a=n.truncate(t.responseText,300)}else a=r("This may be happening because of an error with our server or your internet connection. Try refreshing the page or making sure you are online.");return o=new s.Error({title:r("Studio's having trouble saving your work"),message:a}),o.show()}}),t.postJSON=function(e,n,i){return t.isFunction(n)&&(i=n,n=void 0),t.ajax({url:e,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(n),success:i})},e(function(){return onTouchBasedDevice()?t("body").addClass("touch-based-device"):void 0})},a(),a})}.call(this),define("js/models/textbook",["backbone","underscore","js/models/chapter","js/collections/chapter","backbone.associations","coffee/src/main"],function(e,t,n,i){var r=e.AssociatedModel.extend({defaults:function(){return{name:"",chapters:new i([{}]),showChapters:!1,editing:!1}},relations:[{type:e.Many,key:"chapters",relatedModel:n,collectionType:i}],initialize:function(){return this.setOriginalAttributes(),this},setOriginalAttributes:function(){this._originalAttributes=this.parse(this.toJSON())},reset:function(){this.set(this._originalAttributes,{parse:!0})},isDirty:function(){return!t.isEqual(this._originalAttributes,this.parse(this.toJSON()))},isEmpty:function(){return!this.get("name")&&this.get("chapters").isEmpty()},urlRoot:function(){return CMS.URL.TEXTBOOKS},parse:function(e){var n=$.extend(!0,{},e);return"tab_title"in n&&!("name"in n)&&(n.name=n.tab_title,delete n.tab_title),"url"in n&&!("chapters"in n)&&(n.chapters={url:n.url},delete n.url),t.each(n.chapters,function(e,t){e.order=e.order||t+1}),n},toJSON:function(){return{tab_title:this.get("name"),chapters:this.get("chapters").toJSON()}},validate:function(e){if(!e.name)return{message:"Textbook name is required",attributes:{name:!0}};if(0===e.chapters.length)return{message:"Please add at least one chapter",attributes:{chapters:!0}};var n=[];return e.chapters.each(function(e){e.isValid()||n.push(e)}),t.isEmpty(n)?void 0:{message:"All chapters must have a name and asset",attributes:{chapters:n}}}});return r}),define("js/collections/textbook",["backbone","js/models/textbook"],function(e,t){var n=e.Collection.extend({model:t,url:function(){return CMS.URL.TEXTBOOKS}});return n}),define("js/utils/handle_iframe_binding",["jquery"],function(e){var t=function(t){var i=null;i="undefined"==typeof t?e("iframe, embed"):"undefined"!=typeof t.nodeName?e(t).find("iframe, embed"):t.$("iframe, embed"),n(i)},n=function(t){t.each(function(){if("IFRAME"===e(this).prop("tagName")){var t=e(this).attr("src");if(t){var n="wmode=transparent";if(-1!==t.indexOf("?")){var i=t.split("?");if(-1===i[1].search("wmode=transparent")){var r=i[1],s=i[0];e(this).attr("src",s+"?"+n+"&"+r)}}else 0!==t.lastIndexOf("javascript:",0)&&e(this).attr("src",t+"?"+n)}}else e(this).attr("wmode","transparent")})},i=function(t){if(t){var i=null,r=document.createElement("div");e(r).html(t),i=e(r).find("iframe, embed"),i.length>0&&(n(i),t=e(r).html())}return t};return{iframeBinding:t,iframeBindingHtml:i}}),define("js/views/feedback_prompt",["jquery","underscore","underscore.string","js/views/feedback"],function(e,t,n,i){var r,s,a=i.extend({options:e.extend({},i.prototype.options,{type:"prompt",closeIcon:!1,icon:!1}),render:function(){return window.$body||(window.$body=e(document.body)),this.options.shown?$body.addClass("prompt-is-shown"):$body.removeClass("prompt-is-shown"),i.prototype.render.apply(this,arguments)}});return r=t.compose(n.capitalize,n.camelize),s=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(s,function(t){var n;n=a.extend({options:e.extend({},a.prototype.options,{intent:t})}),a[r(t)]=n}),a}),define("js/views/utils/view_utils",["jquery","underscore","gettext","js/views/feedback_notification","js/views/feedback_prompt"],function(e,t,n,i,r){var s,a,o,l,c,u,d,h,p,f,m,g,v,y,b,x,w,j=65;return s=function(e,t){t||(t="collapsed"),e.closest(".expand-collapse").toggleClass("expand collapse"),e.closest(".is-collapsible, .window").toggleClass(t),e.closest(".is-collapsible").children("article").slideToggle()},a=function(){e(".ui-loading").show()},o=function(){e(".ui-loading").hide()},l=function(e,t,i,s,a){return new r.Warning({title:e,message:t,actions:{primary:{text:i,click:function(e){e.hide(),s()}},secondary:{text:n("Cancel"),click:function(e){return a&&a(),e.hide()}}}}).show()},c=function(e,t){var r;return r=new i.Mini({title:n(e)}),r.show(),t().done(function(){r.hide()})},u=function(e,t){return e.addClass("is-disabled").attr("aria-disabled",!0),t().always(function(){e.removeClass("is-disabled").attr("aria-disabled",!1)})},v=function(t){return function(n){n.preventDefault(),e.ajax({url:e(this).data("dismiss-link"),type:"DELETE",success:t})}},p=function(t){e("html, body").animate({scrollTop:t},500)},d=function(t){var n=t.offset().top;return n-e(window).scrollTop()},h=function(e,t){var n=e.offset().top,i=n-t;p(i)},f=function(e){window.location=e},m=function(){window.location.reload()},g=function(e,n){var i,r=e.changedAttributes();if(!r)return!1;for(i=0;i<n.length;i++)if(t.has(r,n[i]))return!0;return!1},y=function(e){return 0===e.length?n("Required field."):""},b=function(e,t){var i=y(e);if(i)return i;if(t){if(/\s/g.test(e))return n("Please do not use any spaces in this field.")}else if(e!==encodeURIComponent(e)||e.match(/[!'()*]/))return n("Please do not use any spaces or special characters in this field.");return""},x=function(n){var i=t.reduce(n,function(t,n){return t+e(n).val().length},0);return j>=i},w=function(n,i,r,s){x(r)?e(n.errorWrapper).removeClass(i.shown).addClass(i.hiding):(e(n.errorWrapper).addClass(i.shown).removeClass(i.hiding),e(n.errorMessage).html("<p>"+t.template(s,{limit:j})+"</p>"),e(n.save).addClass(i.disabled))},{toggleExpandCollapse:s,showLoadingIndicator:a,hideLoadingIndicator:o,confirmThenRunOperation:l,runOperationShowingMessage:c,disableElementWhileRunning:u,deleteNotificationHandler:v,setScrollTop:p,getScrollOffset:d,setScrollOffset:h,redirect:f,reload:m,hasChangedAttributes:g,validateRequiredField:y,validateURLItemEncoding:b,validateTotalKeyLength:x,checkTotalKeyLengthViolations:w}}),define("js/views/baseview",["jquery","underscore","backbone","gettext","js/utils/handle_iframe_binding","js/utils/templates","js/views/utils/view_utils"],function(e,t,n,i,r,s,a){var o=n.View.extend({events:{"click .ui-toggle-expansion":"toggleExpandCollapse"},options:{collapsedClass:"collapsed"},constructor:function(){t.bindAll(this,"beforeRender","render","afterRender");var e=this;this.render=t.wrap(this.render,function(t,n){return e.beforeRender(),t(n),e.afterRender(),e}),n.View.prototype.constructor.apply(this,arguments)},beforeRender:function(){},render:function(){return this},afterRender:function(){r.iframeBinding(this)},toggleExpandCollapse:function(t){var n=e(t.target);t.stopPropagation(),t.preventDefault(),a.toggleExpandCollapse(n,this.options.collapsedClass)},loadTemplate:function(e){return s.loadTemplate(e)}});return o}),define("js/models/uploads",["backbone","underscore","gettext"],function(e,t,n){var i=e.Model.extend({defaults:{title:"",message:"",selectedFile:null,uploading:!1,uploadedBytes:0,totalBytes:0,finished:!1,mimeTypes:[],fileFormats:[]},validate:function(e){return e.selectedFile&&!this.checkTypeValidity(e.selectedFile)?{message:t.template(n("Only <%= fileTypes %> files can be uploaded. Please select a file ending in <%= fileExtensions %> to upload."),this.formatValidTypes()),attributes:{selectedFile:!0}}:void 0},fileTypes:function(){var e=t.map(this.attributes.mimeTypes,function(e){return e.split("/")[1].toUpperCase()}),n=t.map(this.attributes.fileFormats,function(e){return e.toUpperCase()});return e.concat(n)},checkTypeValidity:function(e){var n=this.attributes,i=function(e){return RegExp("(?:.+)\\.("+e.join("|")+")$","i")};return 0===n.mimeTypes.length&&0===n.fileFormats.length||t.contains(n.mimeTypes,e.type)||i(n.fileFormats).test(e.name)},formatValidTypes:function(){var e=this.attributes;if(1===e.mimeTypes.concat(e.fileFormats).length)return{fileTypes:this.fileTypes()[0],fileExtensions:"."+this.fileTypes()[0].toLowerCase()};var i=n("or"),r=function(e){return t.template("<%= initial %> <%= or %> <%= last %>",{initial:t.initial(e).join(", "),or:i,last:t.last(e)})};return{fileTypes:r(this.fileTypes()),fileExtensions:r(t.map(this.fileTypes(),function(e){return"."+e.toLowerCase()}))}}});return i}),define("js/views/modals/base_modal",["jquery","underscore","gettext","js/views/baseview"],function(e,t,n,i){var r=i.extend({events:{"click .action-cancel":"cancel"},options:e.extend({},i.prototype.options,{type:"prompt",closeIcon:!1,icon:!1,modalName:"basic",modalType:"generic",modalSize:"lg",title:"",viewSpecificClasses:""}),initialize:function(){var t=this.options.parent,n=this.options.parentElement;this.modalTemplate=this.loadTemplate("basic-modal"),this.buttonTemplate=this.loadTemplate("modal-button"),t?n=t.$el:n||(n=this.$el.closest(".modal-window"),0===n.length&&(n=e("body"))),this.parentElement=n},render:function(){this.$el.html(this.modalTemplate({name:this.options.modalName,type:this.options.modalType,size:this.options.modalSize,title:this.getTitle(),viewSpecificClasses:this.options.viewSpecificClasses})),this.addActionButtons(),this.renderContents(),this.parentElement.append(this.$el)},getTitle:function(){return this.options.title},renderContents:function(){var e=this.getContentHtml();this.$(".modal-content").html(e)},getContentHtml:function(){return""},show:function(){this.render(),this.resize(),e(window).resize(t.bind(this.resize,this))},hide:function(){this.undelegateEvents(),this.$el.html("")},cancel:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.hide()},addActionButtons:function(){this.options.addSaveButton&&this.addActionButton("save",n("Save"),!0),this.addActionButton("cancel",n("Cancel"))},addActionButton:function(e,t,n){var i=this.buttonTemplate({type:e,name:t,isPrimary:n});this.getActionBar().find("ul").append(i)},getActionBar:function(){return this.$(".modal-window > div > .modal-actions")},getActionButton:function(e){return this.getActionBar().find(".action-"+e)},resize:function(){var t,n,i,r,s,a,o,l,c;i=this.$(".modal-window"),a=e(window).width(),o=e(window).height(),l=.8*a,c=.8*o,r=Math.min(i.outerWidth(),l),s=Math.min(i.outerHeight(),c),n=(a-r)/2,t=(o-s)/2,i.css({top:t+e(window).scrollTop(),left:n+e(window).scrollLeft()})}});return r}),function(e){function t(t){var n=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(this).ajaxSubmit(n))}function n(t){var n=t.target,i=e(n);if(!i.is(":submit,input:image")){var r=i.closest(":submit");if(0===r.length)return;n=r[0]}var s=this;if(s.clk=n,"image"==n.type)if(void 0!==t.offsetX)s.clk_x=t.offsetX,s.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var a=i.offset();s.clk_x=t.pageX-a.left,s.clk_y=t.pageY-a.top}else s.clk_x=t.pageX-n.offsetLeft,s.clk_y=t.pageY-n.offsetTop;setTimeout(function(){s.clk=s.clk_x=s.clk_y=null},100)}function i(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var r={};r.fileapi=void 0!==e("<input type='file'/>").get(0).files,r.formdata=void 0!==window.FormData,e.fn.ajaxSubmit=function(t){function n(t){var n,i,r=e.param(t).split("&"),s=r.length,a={};for(n=0;s>n;n++)i=r[n].split("="),a[decodeURIComponent(i[0])]=decodeURIComponent(i[1]);return a}function s(i){for(var r=new FormData,s=0;s<i.length;s++)r.append(i[s].name,i[s].value);
if(t.extraData){var a=n(t.extraData);for(var l in a)a.hasOwnProperty(l)&&r.append(l,a[l])}t.data=null;var c=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:o||"POST"});t.uploadProgress&&(c.xhr=function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&(e.upload.onprogress=function(e){var n=0,i=e.loaded||e.position,r=e.total;e.lengthComputable&&(n=Math.ceil(i/r*100)),t.uploadProgress(e,i,r,n)}),e}),c.data=null;var u=c.beforeSend;return c.beforeSend=function(e,t){t.data=r,u&&u.call(this,e,t)},e.ajax(c)}function a(n){function r(e){var t=e.contentWindow?e.contentWindow.document:e.contentDocument?e.contentDocument:e.document;return t}function s(){function t(){try{var e=r(g).readyState;i("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(n){i("Server abort: ",n," (",n.name,")"),a(C),w&&clearTimeout(w),w=void 0}}var n=u.attr("target"),s=u.attr("action");j.setAttribute("target",p),o||j.setAttribute("method","POST"),s!=d.url&&j.setAttribute("action",d.url),d.skipEncodingOverride||o&&!/post/i.test(o)||u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),d.timeout&&(w=setTimeout(function(){x=!0,a(_)},d.timeout));var l=[];try{if(d.extraData)for(var c in d.extraData)d.extraData.hasOwnProperty(c)&&l.push(e.isPlainObject(d.extraData[c])&&d.extraData[c].hasOwnProperty("name")&&d.extraData[c].hasOwnProperty("value")?e('<input type="hidden" name="'+d.extraData[c].name+'">').attr("value",d.extraData[c].value).appendTo(j)[0]:e('<input type="hidden" name="'+c+'">').attr("value",d.extraData[c]).appendTo(j)[0]);d.iframeTarget||(m.appendTo("body"),g.attachEvent?g.attachEvent("onload",a):g.addEventListener("load",a,!1)),setTimeout(t,15),j.submit()}finally{j.setAttribute("action",s),n?j.setAttribute("target",n):u.removeAttr("target"),e(l).remove()}}function a(t){if(!v.aborted&&!O){try{D=r(g)}catch(n){i("cannot access response document: ",n),t=C}if(t===_&&v)return v.abort("timeout"),void T.reject(v,"timeout");if(t==C&&v)return v.abort("server abort"),void T.reject(v,"error","server abort");if(D&&D.location.href!=d.iframeSrc||x){g.detachEvent?g.detachEvent("onload",a):g.removeEventListener("load",a,!1);var s,o="success";try{if(x)throw"timeout";var l="xml"==d.dataType||D.XMLDocument||e.isXMLDoc(D);if(i("isXml="+l),!l&&window.opera&&(null===D.body||!D.body.innerHTML)&&--$)return i("requeing onLoad callback, DOM not available"),void setTimeout(a,250);var c=D.body?D.body:D.documentElement;v.responseText=c?c.innerHTML:null,v.responseXML=D.XMLDocument?D.XMLDocument:D,l&&(d.dataType="xml"),v.getResponseHeader=function(e){var t={"content-type":d.dataType};return t[e]},c&&(v.status=Number(c.getAttribute("status"))||v.status,v.statusText=c.getAttribute("statusText")||v.statusText);var u=(d.dataType||"").toLowerCase(),p=/(json|script|text)/.test(u);if(p||d.textarea){var f=D.getElementsByTagName("textarea")[0];if(f)v.responseText=f.value,v.status=Number(f.getAttribute("status"))||v.status,v.statusText=f.getAttribute("statusText")||v.statusText;else if(p){var y=D.getElementsByTagName("pre")[0],b=D.getElementsByTagName("body")[0];y?v.responseText=y.textContent?y.textContent:y.innerText:b&&(v.responseText=b.textContent?b.textContent:b.innerText)}}else"xml"==u&&!v.responseXML&&v.responseText&&(v.responseXML=M(v.responseText));try{A=F(v,u,d)}catch(t){o="parsererror",v.error=s=t||o}}catch(t){i("error caught: ",t),o="error",v.error=s=t||o}v.aborted&&(i("upload aborted"),o=null),v.status&&(o=v.status>=200&&v.status<300||304===v.status?"success":"error"),"success"===o?(d.success&&d.success.call(d.context,A,"success",v),T.resolve(v.responseText,"success",v),h&&e.event.trigger("ajaxSuccess",[v,d])):o&&(void 0===s&&(s=v.statusText),d.error&&d.error.call(d.context,v,o,s),T.reject(v,"error",s),h&&e.event.trigger("ajaxError",[v,d,s])),h&&e.event.trigger("ajaxComplete",[v,d]),h&&!--e.active&&e.event.trigger("ajaxStop"),d.complete&&d.complete.call(d.context,v,o),O=!0,d.timeout&&clearTimeout(w),setTimeout(function(){d.iframeTarget||m.remove(),v.responseXML=null},100)}}}var l,c,d,h,p,m,g,v,y,b,x,w,j=u[0],k=!!e.fn.prop,T=e.Deferred();if(e(":input[name=submit],:input[id=submit]",j).length)return alert('Error: Form elements must not have name or id of "submit".'),T.reject(),T;if(n)for(c=0;c<f.length;c++)l=e(f[c]),k?l.prop("disabled",!1):l.removeAttr("disabled");if(d=e.extend(!0,{},e.ajaxSettings,t),d.context=d.context||d,p="jqFormIO"+(new Date).getTime(),d.iframeTarget?(m=e(d.iframeTarget),b=m.attr("name"),b?p=b:m.attr("name",p)):(m=e('<iframe name="'+p+'" src="'+d.iframeSrc+'" />'),m.css({position:"absolute",top:"-1000px",left:"-1000px"})),g=m[0],v={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var n="timeout"===t?"timeout":"aborted";if(i("aborting upload... "+n),this.aborted=1,g.contentWindow.document.execCommand)try{g.contentWindow.document.execCommand("Stop")}catch(r){}m.attr("src",d.iframeSrc),v.error=n,d.error&&d.error.call(d.context,v,n,t),h&&e.event.trigger("ajaxError",[v,d,n]),d.complete&&d.complete.call(d.context,v,n)}},h=d.global,h&&0===e.active++&&e.event.trigger("ajaxStart"),h&&e.event.trigger("ajaxSend",[v,d]),d.beforeSend&&d.beforeSend.call(d.context,v,d)===!1)return d.global&&e.active--,T.reject(),T;if(v.aborted)return T.reject(),T;y=j.clk,y&&(b=y.name,b&&!y.disabled&&(d.extraData=d.extraData||{},d.extraData[b]=y.value,"image"==y.type&&(d.extraData[b+".x"]=j.clk_x,d.extraData[b+".y"]=j.clk_y)));var _=1,C=2,S=e("meta[name=csrf-token]").attr("content"),E=e("meta[name=csrf-param]").attr("content");E&&S&&(d.extraData=d.extraData||{},d.extraData[E]=S),d.forceSync?s():setTimeout(s,10);var A,D,O,$=50,M=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},N=e.parseJSON||function(e){return window.eval("("+e+")")},F=function(t,n,i){var r=t.getResponseHeader("content-type")||"",s="xml"===n||!n&&r.indexOf("xml")>=0,a=s?t.responseXML:t.responseText;return s&&"parsererror"===a.documentElement.nodeName&&e.error&&e.error("parsererror"),i&&i.dataFilter&&(a=i.dataFilter(a,n)),"string"==typeof a&&("json"===n||!n&&r.indexOf("json")>=0?a=N(a):("script"===n||!n&&r.indexOf("javascript")>=0)&&e.globalEval(a)),a};return T}if(!this.length)return i("ajaxSubmit: skipping submit process - no element selected"),this;var o,l,c,u=this;"function"==typeof t&&(t={success:t}),o=this.attr("method"),l=this.attr("action"),c="string"==typeof l?e.trim(l):"",c=c||window.location.href||"",c&&(c=(c.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:c,success:e.ajaxSettings.success,type:o||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var d={};if(this.trigger("form-pre-serialize",[this,t,d]),d.veto)return i("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return i("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var h=t.traditional;void 0===h&&(h=e.ajaxSettings.traditional);var p,f=[],m=this.formToArray(t.semantic,f);if(t.data&&(t.extraData=t.data,p=e.param(t.data,h)),t.beforeSubmit&&t.beforeSubmit(m,this,t)===!1)return i("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[m,this,t,d]),d.veto)return i("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var g=e.param(m,h);p&&(g=g?g+"&"+p:p),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+g,t.data=null):t.data=g;var v=[];if(t.resetForm&&v.push(function(){u.resetForm()}),t.clearForm&&v.push(function(){u.clearForm(t.includeHidden)}),!t.dataType&&t.target){var y=t.success||function(){};v.push(function(n){var i=t.replaceTarget?"replaceWith":"html";e(t.target)[i](n).each(y,arguments)})}else t.success&&v.push(t.success);t.success=function(e,n,i){for(var r=t.context||this,s=0,a=v.length;a>s;s++)v[s].apply(r,[e,n,i||u,u])};var b=e("input:file:enabled[value]",this),x=b.length>0,w="multipart/form-data",j=u.attr("enctype")==w||u.attr("encoding")==w,k=r.fileapi&&r.formdata;i("fileAPI :"+k);var T,_=(x||j)&&!k;t.iframe!==!1&&(t.iframe||_)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){T=a(m)}):T=a(m):T=(x||j)&&k?s(m):e.ajax(t),u.removeData("jqxhr").data("jqxhr",T);for(var C=0;C<f.length;C++)f[C]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(r){if(r=r||{},r.delegation=r.delegation&&e.isFunction(e.fn.on),!r.delegation&&0===this.length){var s={s:this.selector,c:this.context};return!e.isReady&&s.s?(i("DOM not ready, queuing ajaxForm"),e(function(){e(s.s,s.c).ajaxForm(r)}),this):(i("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return r.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,n).on("submit.form-plugin",this.selector,r,t).on("click.form-plugin",this.selector,r,n),this):this.ajaxFormUnbind().bind("submit.form-plugin",r,t).bind("click.form-plugin",r,n)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,n){var i=[];if(0===this.length)return i;var s=this[0],a=t?s.getElementsByTagName("*"):s.elements;if(!a)return i;var o,l,c,u,d,h,p;for(o=0,h=a.length;h>o;o++)if(d=a[o],c=d.name)if(t&&s.clk&&"image"==d.type)d.disabled||s.clk!=d||(i.push({name:c,value:e(d).val(),type:d.type}),i.push({name:c+".x",value:s.clk_x},{name:c+".y",value:s.clk_y}));else if(u=e.fieldValue(d,!0),u&&u.constructor==Array)for(n&&n.push(d),l=0,p=u.length;p>l;l++)i.push({name:c,value:u[l]});else if(r.fileapi&&"file"==d.type&&!d.disabled){n&&n.push(d);var f=d.files;if(f.length)for(l=0;l<f.length;l++)i.push({name:c,value:f[l],type:d.type});else i.push({name:c,value:"",type:d.type})}else null!==u&&"undefined"!=typeof u&&(n&&n.push(d),i.push({name:c,value:u,type:d.type,required:d.required}));if(!t&&s.clk){var m=e(s.clk),g=m[0];c=g.name,c&&!g.disabled&&"image"==g.type&&(i.push({name:c,value:m.val()}),i.push({name:c+".x",value:s.clk_x},{name:c+".y",value:s.clk_y}))}return i},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var n=[];return this.each(function(){var i=this.name;if(i){var r=e.fieldValue(this,t);if(r&&r.constructor==Array)for(var s=0,a=r.length;a>s;s++)n.push({name:i,value:r[s]});else null!==r&&"undefined"!=typeof r&&n.push({name:this.name,value:r})}}),e.param(n)},e.fn.fieldValue=function(t){for(var n=[],i=0,r=this.length;r>i;i++){var s=this[i],a=e.fieldValue(s,t);null===a||"undefined"==typeof a||a.constructor==Array&&!a.length||(a.constructor==Array?e.merge(n,a):n.push(a))}return n},e.fieldValue=function(t,n){var i=t.name,r=t.type,s=t.tagName.toLowerCase();if(void 0===n&&(n=!0),n&&(!i||t.disabled||"reset"==r||"button"==r||("checkbox"==r||"radio"==r)&&!t.checked||("submit"==r||"image"==r)&&t.form&&t.form.clk!=t||"select"==s&&-1==t.selectedIndex))return null;if("select"==s){var a=t.selectedIndex;if(0>a)return null;for(var o=[],l=t.options,c="select-one"==r,u=c?a+1:l.length,d=c?a:0;u>d;d++){var h=l[d];if(h.selected){var p=h.value;if(p||(p=h.attributes&&h.attributes.value&&!h.attributes.value.specified?h.text:h.value),c)return p;o.push(p)}}return o}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var n=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var i=this.type,r=this.tagName.toLowerCase();n.test(i)||"textarea"==r?this.value="":"checkbox"==i||"radio"==i?this.checked=!1:"select"==r?this.selectedIndex=-1:t&&(t===!0&&/hidden/.test(i)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var n=this.type;if("checkbox"==n||"radio"==n)this.checked=t;else if("option"==this.tagName.toLowerCase()){var i=e(this).parent("select");t&&i[0]&&"select-one"==i[0].type&&i.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}(jQuery),define("jquery.form",["jquery"],function(e){return function(){var t;return t||e.jQuery.fn.ajaxForm}}(this)),define("js/views/uploads",["jquery","underscore","gettext","js/views/modals/base_modal","jquery.form"],function(e,t,n,i){var r=i.extend({events:{"change input[type=file]":"selectFile","click .action-upload":"upload"},options:e.extend({},i.prototype.options,{modalName:"assetupload",modalSize:"med",successMessageTimeout:2e3,viewSpecificClasses:"confirm"}),initialize:function(){i.prototype.initialize.call(this),this.events=t.extend({},i.prototype.events,this.events),this.template=this.loadTemplate("upload-dialog"),this.listenTo(this.model,"change",this.renderContents),this.options.title=this.model.get("title")},addActionButtons:function(){this.addActionButton("upload",n("Upload"),!0),i.prototype.addActionButtons.call(this)},renderContents:function(){var t=this.model.isValid(),n=this.model.get("selectedFile"),r=this.$("input[type=file]").get(0);return i.prototype.renderContents.call(this),n&&t?(e(r).removeClass("error"),this.$("input[type=file]").replaceWith(r),this.$(".action-upload").removeClass("disabled")):this.$(".action-upload").addClass("disabled"),this},getContentHtml:function(){return this.template({url:this.options.url||CMS.URL.UPLOAD_ASSET,message:this.model.escape("message"),selectedFile:this.model.get("selectedFile"),uploading:this.model.get("uploading"),uploadedBytes:this.model.get("uploadedBytes"),totalBytes:this.model.get("totalBytes"),finished:this.model.get("finished"),error:this.model.validationError})},selectFile:function(t){var n=t.target.files[0]||null;this.model.set({selectedFile:n}),n&&e.isEmptyObject(this.model.changed)&&this.model.trigger("change")},upload:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("uploading",!0),this.$("form").ajaxSubmit({success:t.bind(this.success,this),error:t.bind(this.error,this),uploadProgress:t.bind(this.progress,this),data:{notifyOnError:!1}})},progress:function(e,t,n){this.model.set({uploadedBytes:t,totalBytes:n})},success:function(e,t,n,i){this.model.set({uploading:!1,finished:!0}),this.options.onSuccess&&this.options.onSuccess(e,t,n,i);var r=this;this.removalTimeout=setTimeout(function(){r.hide()},this.options.successMessageTimeout)},error:function(){this.model.set({uploading:!1,uploadedBytes:0,title:n("We're sorry, there was an error")})}});return r}),define("js/views/edit_chapter",["js/views/baseview","underscore","underscore.string","jquery","gettext","js/models/uploads","js/views/uploads"],function(e,t,n,i,r,s,a){t.str=n;var o=e.extend({initialize:function(){this.template=this.loadTemplate("edit-chapter"),this.listenTo(this.model,"change",this.render)},tagName:"li",className:function(){return"field-group chapter chapter"+this.model.get("order")},render:function(){return this.$el.html(this.template({name:this.model.escape("name"),asset_path:this.model.escape("asset_path"),order:this.model.get("order"),error:this.model.validationError})),this},events:{"change .chapter-name":"changeName","change .chapter-asset-path":"changeAssetPath","click .action-close":"removeChapter","click .action-upload":"openUploadDialog",submit:"uploadAsset"},changeName:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.set({name:this.$(".chapter-name").val()},{silent:!0}),this},changeAssetPath:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.set({asset_path:this.$(".chapter-asset-path").val()},{silent:!0}),this},removeChapter:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.collection.remove(this.model),this.remove()},openUploadDialog:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set({name:this.$("input.chapter-name").val(),asset_path:this.$("input.chapter-asset-path").val()});var n=new s({title:t.template(r("Upload a new PDF to “<%= name %>”"),{name:course.escape("name")}),message:r("Please select a PDF file to upload."),mimeTypes:["application/pdf"]}),i=this,o=new a({model:n,onSuccess:function(e){var t={};i.model.get("name")||(t.name=e.asset.displayname),t.asset_path=e.asset.portable_url,i.model.set(t)}});o.show()}});return o}),define("js/views/edit_textbook",["js/views/baseview","underscore","jquery","js/views/edit_chapter","js/views/feedback_notification"],function(e,t,n,i,r){var s=e.extend({initialize:function(){this.template=this.loadTemplate("edit-textbook"),this.listenTo(this.model,"invalid",this.render);var e=this.model.get("chapters");this.listenTo(e,"add",this.addOne),this.listenTo(e,"reset",this.addAll),this.listenTo(e,"all",this.render)},tagName:"section",className:"textbook",render:function(){return this.$el.html(this.template({name:this.model.escape("name"),error:this.model.validationError})),this.addAll(),this},events:{"change input[name=textbook-name]":"setName",submit:"setAndClose","click .action-cancel":"cancel","click .action-add-chapter":"createChapter"},addOne:function(e){var t=new i({model:e});return this.$("ol.chapters").append(t.render().el),this},addAll:function(){this.model.get("chapters").each(this.addOne,this)},createChapter:function(e){e&&e.preventDefault&&e.preventDefault(),this.setValues(),this.model.get("chapters").add([{}])},setName:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("name",this.$("#textbook-name-input").val(),{silent:!0})},setValues:function(){this.setName();var e=this;return t.each(this.$("li"),function(t,i){var r=e.model.get("chapters").at(i);r&&r.set({name:n(".chapter-name",t).val(),asset_path:n(".chapter-asset-path",t).val()})}),this},setAndClose:function(e){if(e&&e.preventDefault&&e.preventDefault(),this.setValues(),this.model.isValid()){var t=new r.Mini({title:gettext("Saving")}).show(),n=this;this.model.save({},{success:function(){n.model.setOriginalAttributes(),n.close()},complete:function(){t.hide()}})}},cancel:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.reset(),this.close()},close:function(){var e=this.model.collection;return this.remove(),this.model.isNew()&&e.remove(this.model),this.model.set("editing",!1),this}});return s}),define("js/views/show_textbook",["js/views/baseview","underscore","gettext","js/views/feedback_notification","js/views/feedback_prompt"],function(e,t,n,i,r){var s=e.extend({initialize:function(){this.template=t.template($("#show-textbook-tpl").text()),this.listenTo(this.model,"change",this.render)},tagName:"section",className:"textbook",events:{"click .edit":"editTextbook","click .delete":"confirmDelete","click .show-chapters":"showChapters","click .hide-chapters":"hideChapters"},render:function(){var e=$.extend({},this.model.attributes);return e.bookindex=this.model.collection.indexOf(this.model),e.course=window.course.attributes,this.$el.html(this.template(e)),this},editTextbook:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("editing",!0)},confirmDelete:function(e){e&&e.preventDefault&&e.preventDefault();{var s=this.model;this.model.collection,new r.Warning({title:t.template(n("Delete “<%= name %>”?"),{name:s.escape("name")}),message:n("Deleting a textbook cannot be undone and once deleted any reference to it in your courseware's navigation will also be removed."),actions:{primary:{text:n("Delete"),click:function(e){e.hide();var t=new i.Mini({title:n("Deleting")}).show();s.destroy({complete:function(){t.hide()}})}},secondary:{text:n("Cancel"),click:function(e){e.hide()}}}}).show()}},showChapters:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("showChapters",!0)},hideChapters:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("showChapters",!1)}});return s}),define("js/views/list_textbooks",["js/views/baseview","jquery","js/views/edit_textbook","js/views/show_textbook"],function(e,t,n,i){var r=e.extend({initialize:function(){this.emptyTemplate=this.loadTemplate("no-textbooks"),this.listenTo(this.collection,"all",this.render),this.listenTo(this.collection,"destroy",this.handleDestroy)},tagName:"div",className:"textbooks-list",render:function(){var e=this.collection;if(0===e.length)this.$el.html(this.emptyTemplate());else{this.$el.empty();var t=this;e.each(function(e){var r;r=e.get("editing")?new n({model:e}):new i({model:e}),t.$el.append(r.render().el)})}return this},events:{"click .new-button":"addOne"},addOne:function(e){e&&e.preventDefault&&e.preventDefault(),this.collection.add([{editing:!0}])},handleDestroy:function(e,t){t.remove(e)}});return r}),define("js/factories/textbooks",["gettext","js/models/section","js/collections/textbook","js/views/list_textbooks"],function(e,t,n,i){return function(t){var r=new n(t,{parse:!0}),s=new i({collection:r});$(".content-primary").append(s.render().el),$(".nav-actions .new-button").click(function(e){s.addOne(e)}),$(window).on("beforeunload",function(){var t=r.find(function(e){return e.isDirty()});return t?e("You have unsaved changes. Do you really want to leave this page?"):void 0})}});