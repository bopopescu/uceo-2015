/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */

!function(e,t){var n=t.prototype.trim,i=t.prototype.trimRight,r=t.prototype.trimLeft,o=function(e){return 1*e||0},s=function(e,t){if(1>t)return"";for(var n="";t>0;)1&t&&(n+=e),t>>=1,e+=e;return n},a=[].slice,u=function(e){return null==e?"\\s":e.source?e.source:"["+h.escapeRegExp(e)+"]"},l={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"},c={};for(var d in l)c[l[d]]=d;var p=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var n=s,i=function(){return i.cache.hasOwnProperty(arguments[0])||(i.cache[arguments[0]]=i.parse(arguments[0])),i.format.call(null,i.cache[arguments[0]],arguments)};return i.format=function(i,r){var o,s,a,u,l,c,d,h=1,f=i.length,g="",m=[];for(s=0;f>s;s++)if(g=e(i[s]),"string"===g)m.push(i[s]);else if("array"===g){if(u=i[s],u[2])for(o=r[h],a=0;a<u[2].length;a++){if(!o.hasOwnProperty(u[2][a]))throw new Error(p('[_.sprintf] property "%s" does not exist',u[2][a]));o=o[u[2][a]]}else o=u[1]?r[u[1]]:r[h++];if(/[^s]/.test(u[8])&&"number"!=e(o))throw new Error(p("[_.sprintf] expecting number but found %s",e(o)));switch(u[8]){case"b":o=o.toString(2);break;case"c":o=t.fromCharCode(o);break;case"d":o=parseInt(o,10);break;case"e":o=u[7]?o.toExponential(u[7]):o.toExponential();break;case"f":o=u[7]?parseFloat(o).toFixed(u[7]):parseFloat(o);break;case"o":o=o.toString(8);break;case"s":o=(o=t(o))&&u[7]?o.substring(0,u[7]):o;break;case"u":o=Math.abs(o);break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}o=/[def]/.test(u[8])&&u[3]&&o>=0?"+"+o:o,c=u[4]?"0"==u[4]?"0":u[4].charAt(1):" ",d=u[6]-t(o).length,l=u[6]?n(c,d):"",m.push(u[5]?o+l:l+o)}return m.join("")},i.cache={},i.parse=function(e){for(var t=e,n=[],i=[],r=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))i.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))i.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw new Error("[_.sprintf] huh?");if(n[2]){r|=1;var o=[],s=n[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(s)))throw new Error("[_.sprintf] huh?");for(o.push(a[1]);""!==(s=s.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(s)))o.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(s)))throw new Error("[_.sprintf] huh?");o.push(a[1])}n[2]=o}else r|=2;if(3===r)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");i.push(n)}t=t.substring(n[0].length)}return i},i}(),h={VERSION:"2.3.0",isBlank:function(e){return null==e&&(e=""),/^\s*$/.test(e)},stripTags:function(e){return null==e?"":t(e).replace(/<\/?[^>]+>/g,"")},capitalize:function(e){return e=null==e?"":t(e),e.charAt(0).toUpperCase()+e.slice(1)},chop:function(e,n){return null==e?[]:(e=t(e),n=~~n,n>0?e.match(new RegExp(".{1,"+n+"}","g")):[e])},clean:function(e){return h.strip(e).replace(/\s+/g," ")},count:function(e,n){return null==e||null==n?0:t(e).split(n).length-1},chars:function(e){return null==e?[]:t(e).split("")},swapCase:function(e){return null==e?"":t(e).replace(/\S/g,function(e){return e===e.toUpperCase()?e.toLowerCase():e.toUpperCase()})},escapeHTML:function(e){return null==e?"":t(e).replace(/[&<>"']/g,function(e){return"&"+c[e]+";"})},unescapeHTML:function(e){return null==e?"":t(e).replace(/\&([^;]+);/g,function(e,n){var i;return n in l?l[n]:(i=n.match(/^#x([\da-fA-F]+)$/))?t.fromCharCode(parseInt(i[1],16)):(i=n.match(/^#(\d+)$/))?t.fromCharCode(~~i[1]):e})},escapeRegExp:function(e){return null==e?"":t(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(e,t,n,i){var r=h.chars(e);return r.splice(~~t,~~n,i),r.join("")},insert:function(e,t,n){return h.splice(e,t,0,n)},include:function(e,n){return""===n?!0:null==e?!1:-1!==t(e).indexOf(n)},join:function(){var e=a.call(arguments),t=e.shift();return null==t&&(t=""),e.join(t)},lines:function(e){return null==e?[]:t(e).split("\n")},reverse:function(e){return h.chars(e).reverse().join("")},startsWith:function(e,n){return""===n?!0:null==e||null==n?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(0,n.length)===n)},endsWith:function(e,n){return""===n?!0:null==e||null==n?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(e.length-n.length)===n)},succ:function(e){return null==e?"":(e=t(e),e.slice(0,-1)+t.fromCharCode(e.charCodeAt(e.length-1)+1))},titleize:function(e){return null==e?"":t(e).replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},camelize:function(e){return h.trim(e).replace(/[-_\s]+(.)?/g,function(e,t){return t.toUpperCase()})},underscored:function(e){return h.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(e){return h.trim(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(e){return h.titleize(t(e).replace(/_/g," ")).replace(/\s/g,"")},humanize:function(e){return h.capitalize(h.underscored(e).replace(/_id$/,"").replace(/_/g," "))},trim:function(e,i){return null==e?"":!i&&n?n.call(e):(i=u(i),t(e).replace(new RegExp("^"+i+"+|"+i+"+$","g"),""))},ltrim:function(e,n){return null==e?"":!n&&r?r.call(e):(n=u(n),t(e).replace(new RegExp("^"+n+"+"),""))},rtrim:function(e,n){return null==e?"":!n&&i?i.call(e):(n=u(n),t(e).replace(new RegExp(n+"+$"),""))},truncate:function(e,n,i){return null==e?"":(e=t(e),i=i||"...",n=~~n,e.length>n?e.slice(0,n)+i:e)},prune:function(e,n,i){if(null==e)return"";if(e=t(e),n=~~n,i=null!=i?t(i):"...",e.length<=n)return e;var r=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},o=e.slice(0,n+1).replace(/.(?=\W*\w*$)/g,r);return o=o.slice(o.length-2).match(/\w\w/)?o.replace(/\s*\S+$/,""):h.rtrim(o.slice(0,o.length-1)),(o+i).length>e.length?e:e.slice(0,o.length)+i},words:function(e,t){return h.isBlank(e)?[]:h.trim(e,t).split(t||/\s+/)},pad:function(e,n,i,r){e=null==e?"":t(e),n=~~n;var o=0;switch(i?i.length>1&&(i=i.charAt(0)):i=" ",r){case"right":return o=n-e.length,e+s(i,o);case"both":return o=n-e.length,s(i,Math.ceil(o/2))+e+s(i,Math.floor(o/2));default:return o=n-e.length,s(i,o)+e}},lpad:function(e,t,n){return h.pad(e,t,n)},rpad:function(e,t,n){return h.pad(e,t,n,"right")},lrpad:function(e,t,n){return h.pad(e,t,n,"both")},sprintf:p,vsprintf:function(e,t){return t.unshift(e),p.apply(null,t)},toNumber:function(e,n){if(null==e||""==e)return 0;e=t(e);var i=o(o(e).toFixed(~~n));return 0!==i||e.match(/^0+$/)?i:Number.NaN},numberFormat:function(e,t,n,i){if(isNaN(e)||null==e)return"";e=e.toFixed(~~t),i=i||",";var r=e.split("."),o=r[0],s=r[1]?(n||".")+r[1]:"";return o.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+i)+s},strRight:function(e,n){if(null==e)return"";e=t(e),n=null!=n?t(n):n;var i=n?e.indexOf(n):-1;return~i?e.slice(i+n.length,e.length):e},strRightBack:function(e,n){if(null==e)return"";e=t(e),n=null!=n?t(n):n;var i=n?e.lastIndexOf(n):-1;return~i?e.slice(i+n.length,e.length):e},strLeft:function(e,n){if(null==e)return"";e=t(e),n=null!=n?t(n):n;var i=n?e.indexOf(n):-1;return~i?e.slice(0,i):e},strLeftBack:function(e,t){if(null==e)return"";e+="",t=null!=t?""+t:t;var n=e.lastIndexOf(t);return~n?e.slice(0,n):e},toSentence:function(e,t,n,i){t=t||", ",n=n||" and ";var r=e.slice(),o=r.pop();return e.length>2&&i&&(n=h.rtrim(t)+n),r.length?r.join(t)+n+o:o},toSentenceSerial:function(){var e=a.call(arguments);return e[3]=!0,h.toSentence.apply(h,e)},slugify:function(e){if(null==e)return"";var n="ąàáäâãåæćęèéëêìíïîłńòóöôõøùúüûñçżź",i="aaaaaaaaceeeeeiiiilnoooooouuuunczz",r=new RegExp(u(n),"g");return e=t(e).toLowerCase().replace(r,function(e){var t=n.indexOf(e);return i.charAt(t)||"-"}),h.dasherize(e.replace(/[^\w\s-]/g,""))},surround:function(e,t){return[t,e,t].join("")},quote:function(e){return h.surround(e,'"')},exports:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&!t.match(/^(?:include|contains|reverse)$/)&&(e[t]=this[t]);return e},repeat:function(e,n,i){if(null==e)return"";if(n=~~n,null==i)return s(t(e),n);for(var r=[];n>0;r[--n]=e);return r.join(i)},levenshtein:function(e,n){if(null==e&&null==n)return 0;if(null==e)return t(n).length;if(null==n)return t(e).length;e=t(e),n=t(n);for(var i,r,o=[],s=0;s<=n.length;s++)for(var a=0;a<=e.length;a++)r=s&&a?e.charAt(a-1)===n.charAt(s-1)?i:Math.min(o[a],o[a-1],i)+1:s+a,i=o[a],o[a]=r;return o.pop()}};h.strip=h.trim,h.lstrip=h.ltrim,h.rstrip=h.rtrim,h.center=h.lrpad,h.rjust=h.lpad,h.ljust=h.rpad,h.contains=h.include,h.q=h.quote,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(module.exports=h),exports._s=h):"function"==typeof define&&define.amd?define("underscore.string",[],function(){return h}):(e._=e._||{},e._.string=e._.str=h)}(this,String),function(){var e,t,n,i,r,o,s,a,u,l,c=this;"undefined"==typeof window?(e=require("underscore"),t=require("backbone"),"undefined"!=typeof exports&&(exports=module.exports=t)):(e=c._,t=c.Backbone),n=t.Model,i=t.Collection,r=n.prototype,o=i.prototype,u=/[\.\[\]]+/g,s="change add remove reset sort destroy".split(" "),l=["reset","sort"],t.Associations={VERSION:"0.5.0"},t.Associations.Many=t.Many="Many",t.Associations.One=t.One="One",a=t.AssociatedModel=t.Associations.AssociatedModel=n.extend({relations:void 0,_proxyCalls:void 0,get:function(e){var t=r.get.call(this,e);return t?t:this._getAttr.apply(this,arguments)},set:function(t,n,i){var r;return e.isObject(t)||null==t?(r=t,i=n):(r={},r[t]=n),t=this._set(r,i),this._processPendingEvents(),t},_set:function(t,n){var i,r,o,s,l=this;if(!t)return this;for(i in t)if(r||(r={}),i.match(u)){var c=p(i);s=e.initial(c),c=c[c.length-1],s=this.get(s),s instanceof a&&(s=r[s.cid]||(r[s.cid]={model:s,data:{}}),s.data[c]=t[i])}else s=r[this.cid]||(r[this.cid]={model:this,data:{}}),s.data[i]=t[i];if(r)for(o in r)s=r[o],this._setAttr.call(s.model,s.data,n)||(l=!1);else l=this._setAttr.call(this,t,n);return l},_setAttr:function(n,o){var s;if(o||(o={}),o.unset)for(s in n)n[s]=void 0;return this.parents=this.parents||[],this.relations&&e.each(this.relations,function(r){var s,u,l,c,d=r.key,p=r.relatedModel,f=r.collectionType,g=r.map,m=this.attributes[d],v=m&&m.idAttribute;if(p&&e.isString(p)&&(p=h(p)),f&&e.isString(f)&&(f=h(f)),g&&e.isString(g)&&(g=h(g)),u=r.options?e.extend({},r.options,o):o,n[d]){if(s=e.result(n,d),s=g?g(s):s,r.type===t.Many){if(f&&!f.prototype instanceof i)throw Error("collectionType must inherit from Backbone.Collection");s instanceof i?l=s:m?(m._deferEvents=!0,m.set(s,o),l=m):(l=f?new f:this._createCollection(p),l.add(s,u))}else r.type===t.One&&p&&(s instanceof a?l=s:m?m&&s[v]&&m.get(v)===s[v]?(m._deferEvents=!0,m._set(s,o),l=m):l=new p(s,u):l=new p(s,u));(c=n[d]=l)&&!c._proxyCallback&&(c._proxyCallback=function(){return this._bubbleEvent.call(this,d,c,arguments)},c.on("all",c._proxyCallback,this))}n.hasOwnProperty(d)&&(r=n[d],p=this.attributes[d],r?(r.parents=r.parents||[],-1==e.indexOf(r.parents,this)&&r.parents.push(this)):p&&p.parents.length>0&&(p.parents=e.difference(p.parents,[this])))},this),r.set.call(this,n,o)},_bubbleEvent:function(t,n,r){var o,u=r[0].split(":"),c=u[0],d="nested-change"==r[0],h=r[1],f=r[2],g=-1,m=n._proxyCalls,v=-1!==e.indexOf(s,c);if(!d){if(e.size(u)>1&&(o=u[1]),-1!==e.indexOf(l,c)&&(f=h),n instanceof i&&v&&h){var w=p(o),x=e.initial(w);(u=n.find(function(e){if(h===e)return!0;if(!e)return!1;var t=e.get(x);return(t instanceof a||t instanceof i)&&h===t?!0:(t=e.get(w),(t instanceof a||t instanceof i)&&h===t||t instanceof i&&f&&f===t?!0:void 0)}))&&(g=n.indexOf(u))}return o=t+(-1===g||"change"!==c&&!o?"":"["+g+"]")+(o?"."+o:""),/\[\*\]/g.test(o)?this:(u=o.replace(/\[\d+\]/g,"[*]"),g=[],g.push.apply(g,r),g[0]=c+":"+o,m=n._proxyCalls=m||{},this._isEventAvailable.call(this,m,o)?this:(m[o]=!0,"change"===c&&(this._previousAttributes[t]=n._previousAttributes,this.changed[t]=n),this.trigger.apply(this,g),"change"===c&&this.get(o)!=r[2]&&this.trigger.apply(this,["nested-change",o,r[1]]),m&&o&&delete m[o],o!==u&&(g[0]=c+":"+u,this.trigger.apply(this,g)),this))}},_isEventAvailable:function(t,n){return e.find(t,function(e,t){return-1!==n.indexOf(t,n.length-t.length)})},_createCollection:function(t){var n=t;if(e.isString(n)&&(n=h(n)),!(n&&n.prototype instanceof a))throw Error("type must inherit from Backbone.AssociatedModel");return t=new i,t.model=n,t},_processPendingEvents:function(){this.visited||(this.visited=!0,this._deferEvents=!1,e.each(this._pendingEvents,function(e){e.c.trigger.apply(e.c,e.a)}),this._pendingEvents=[],e.each(this.relations,function(e){(e=this.attributes[e.key])&&e._processPendingEvents()},this),delete this.visited)},trigger:function(){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):r.trigger.apply(this,arguments)},toJSON:function(t){var n,i;return this.visited||(this.visited=!0,n=r.toJSON.apply(this,arguments),this.relations&&e.each(this.relations,function(r){var o=this.attributes[r.key];o&&(i=o.toJSON(t),n[r.key]=e.isArray(i)?e.compact(i):i)},this),delete this.visited),n},clone:function(){return new this.constructor(this.toJSON())},_getAttr:function(t){var n,r,o=this,t=p(t);if(!(e.size(t)<1)){for(r=0;r<t.length&&(n=t[r],o);r++)o=o instanceof i?isNaN(n)?void 0:o.at(n):o.attributes[n];return o}}});var d=/[^\.\[\]]+/g,p=function(t){return""===t?[""]:e.isString(t)?t.match(d):t||[]},h=function(t){return e.reduce(t.split("."),function(e,t){return e[t]},c)},f=function(t,n,i){var r;return e.find(t,function(t){return(r=e.find(t.relations,function(e){return t.get(e.key)===n},this))?!0:void 0},this),r&&r.map?r.map(i):i},g={};e.each(["set","remove","reset"],function(e){g[e]=i.prototype[e],o[e]=function(t){return this.model.prototype instanceof a&&this.parents&&(arguments[0]=f(this.parents,this,t)),g[e].apply(this,arguments)}}),g.trigger=o.trigger,o.trigger=function(){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):g.trigger.apply(this,arguments)},o._processPendingEvents=a.prototype._processPendingEvents}.call(this),define("backbone.associations",["backbone"],function(e){return function(){var t;return t||e.Backbone.Associations}}(this)),define("js/models/group",["backbone","underscore","underscore.string","gettext","backbone.associations"],function(e,t,n,i){var r=e.AssociatedModel.extend({defaults:function(){return{name:"",version:1,order:null}},isEmpty:function(){return!this.get("name")},toJSON:function(){return{id:this.get("id"),name:this.get("name"),version:this.get("version")}},validate:function(e){return n.trim(e.name)?void 0:{message:i("Group name is required"),attributes:{name:!0}}}});return r}),define("js/collections/group",["underscore","underscore.string","backbone","gettext","js/models/group"],function(e,t,n,i,r){var o=n.Collection.extend({model:r,comparator:"order",nextOrder:function(){return this.length?this.last().get("order")+1:0},isEmpty:function(){return 0===this.length||this.every(function(e){return e.isEmpty()})},getNextDefaultGroupName:function(){var n=this.nextOrder(),r=e.pluck(this.toJSON(),"name"),o="";do o=t.sprintf(i("Group %s"),this.getGroupId(n)),n++;while(e.contains(r,o));return o},getGroupId:function(){var t,n=i("ABCDEFGHIJKLMNOPQRSTUVWXYZ").split(""),r=n.length;return t=function(t,n){return e.isNumber(t)&&n?{quotient:t/n,remainder:t%n}:null},function o(e){var i,s="",a=t(e,r);return a?(i=Math.floor(a.quotient)-1,r>i?i>-1&&(s+=n[i]):s+=o(i),s+n[a.remainder]):String(e)}}()});return o}),function(){this.AjaxPrefix={addAjaxPrefix:function(e,t){return e.postWithPrefix=function(e,n,i,r){return $.post(""+t()+e,n,i,r)},e.getWithPrefix=function(e,n,i,r){return $.get(""+t()+e,n,i,r)},e.ajaxWithPrefix=function(e,n){return null!=n?$.ajax(""+t()+e,n):(n=e,n.url=""+t()+n.url,$.ajax(n))}}}}.call(this),define("coffee/src/ajax_prefix",function(){}),define("js/utils/templates",["jquery","underscore"],function(e,t){var n=function(n){var i="#"+n+"-tpl",r=e(i).text();return r||console.error("Failed to load "+n+" template"),t.template(r)};return{loadTemplate:n}}),define("js/views/feedback",["jquery","underscore","underscore.string","backbone","js/utils/templates"],function(e,t,n,i,r){var o=i.View.extend({options:{title:"",message:"",intent:null,type:null,shown:!0,icon:!0,closeIcon:!0,minShown:0,maxShown:1/0},initialize:function(){if(!this.options.type)throw"SystemFeedback: type required (given "+JSON.stringify(this.options)+")";if(!this.options.intent)throw"SystemFeedback: intent required (given "+JSON.stringify(this.options)+")";return this.template=r.loadTemplate("system-feedback"),this.setElement(e("#page-"+this.options.type)),this.options.actions&&this.options.actions.secondary&&!t.isArray(this.options.actions.secondary)&&(this.options.actions.secondary=[this.options.actions.secondary]),this},show:function(){return clearTimeout(this.hideTimeout),this.options.shown=!0,this.shownAt=new Date,this.render(),e.isNumeric(this.options.maxShown)&&(this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.maxShown)),this},hide:function(){return this.shownAt&&e.isNumeric(this.options.minShown)&&this.options.minShown>new Date-this.shownAt?(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.minShown-(new Date-this.shownAt))):(this.options.shown=!1,delete this.shownAt,this.render()),this},events:{"click .action-close":"hide","click .action-primary":"primaryClick","click .action-secondary":"secondaryClick"},render:function(){var e=o["active_"+this.options.type];return e&&e!==this&&(e.stopListening(),e.undelegateEvents()),this.$el.html(this.template(this.options)),o["active_"+this.options.type]=this,this},primaryClick:function(e){var t,n;t=this.options.actions,t&&(n=t.primary,n&&(n.preventDefault!==!1&&e.preventDefault(),n.click&&n.click.call(e.target,this,e)))},secondaryClick:function(e){var n,i,r,o;n=this.options.actions,n&&(i=n.secondary,i&&(o=0,e&&e.target&&(o=t.indexOf(this.$(".action-secondary"),e.target)),r=i[o],r.preventDefault!==!1&&e.preventDefault(),r.click&&r.click.call(e.target,this,e)))}});return o}),define("js/views/feedback_notification",["jquery","underscore","underscore.string","js/views/feedback"],function(e,t,n,i){var r,o,s=i.extend({options:e.extend({},i.prototype.options,{type:"notification",closeIcon:!1})});r=t.compose(n.capitalize,n.camelize),o=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(o,function(t){var n;n=s.extend({options:e.extend({},s.prototype.options,{intent:t})}),s[r(t)]=n});var a=s.Mini.prototype.options;return a.minShown=1250,a.closeIcon=!1,s}),function(e){e.cookie=function(t,n,i){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(n))||null===n||void 0===n)){if(i=e.extend({},i),(null===n||void 0===n)&&(i.expires=-1),"number"==typeof i.expires){var r=i.expires,o=i.expires=new Date;o.setDate(o.getDate()+r)}return n=String(n),document.cookie=[encodeURIComponent(t),"=",i.raw?n:encodeURIComponent(n),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}i=n||{};for(var s,a=i.raw?function(e){return e}:decodeURIComponent,u=document.cookie.split("; "),l=0;s=u[l]&&u[l].split("=");l++)if(a(s[0])===t)return a(s[1]||"");return null}}(jQuery),define("jquery.cookie",["jquery"],function(e){return function(){var t;return t||e.jQuery.fn.cookie}}(this)),function(){define("coffee/src/main",["domReady","jquery","underscore.string","backbone","gettext","js/views/feedback_notification","coffee/src/ajax_prefix","jquery.cookie"],function(e,t,n,i,r,o){var s;return s=function(){return AjaxPrefix.addAjaxPrefix(jQuery,function(){return t("meta[name='path_prefix']").attr("content")}),window.CMS=window.CMS||{},CMS.URL=CMS.URL||{},window.onTouchBasedDevice=function(){return navigator.userAgent.match(/iPhone|iPod|iPad|Android/i)},_.extend(CMS,i.Events),i.emulateHTTP=!0,t.ajaxSetup({headers:{"X-CSRFToken":t.cookie("csrftoken")},dataType:"json"}),t(document).ajaxError(function(e,t,i){var s,a;if(i.notifyOnError!==!1){if(t.responseText)try{s=JSON.parse(t.responseText).error}catch(u){s=n.truncate(t.responseText,300)}else s=r("This may be happening because of an error with our server or your internet connection. Try refreshing the page or making sure you are online.");return a=new o.Error({title:r("Studio's having trouble saving your work"),message:s}),a.show()}}),t.postJSON=function(e,n,i){return t.isFunction(n)&&(i=n,n=void 0),t.ajax({url:e,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(n),success:i})},e(function(){return onTouchBasedDevice()?t("body").addClass("touch-based-device"):void 0})},s(),s})}.call(this),define("js/models/group_configuration",["backbone","underscore","underscore.string","gettext","js/models/group","js/collections/group","backbone.associations","coffee/src/main"],function(e,t,n,i,r,o){t.str=n;var s=e.AssociatedModel.extend({defaults:function(){return{name:"",scheme:"random",description:"",version:2,groups:new o([{name:i("Group A"),order:0},{name:i("Group B"),order:1}]),showGroups:!1,editing:!1,usage:[]}},relations:[{type:e.Many,key:"groups",relatedModel:r,collectionType:o}],initialize:function(e,t){return this.canBeEmpty=t&&t.canBeEmpty,this.setOriginalAttributes(),this},setOriginalAttributes:function(){this._originalAttributes=this.parse(this.toJSON())},reset:function(){this.set(this._originalAttributes,{parse:!0,validate:!0})},isDirty:function(){return!t.isEqual(this._originalAttributes,this.parse(this.toJSON()))},isEmpty:function(){return!this.get("name")&&this.get("groups").isEmpty()},parse:function(e){var n=$.extend(!0,{},e);return t.each(n.groups,function(e,t){e.order=e.order||t}),n},toJSON:function(){return{id:this.get("id"),name:this.get("name"),scheme:this.get("scheme"),description:this.get("description"),version:this.get("version"),groups:this.get("groups").toJSON()}},validate:function(n){if(!t.str.trim(n.name))return{message:i("Group Configuration name is required."),attributes:{name:!0}};if(!this.canBeEmpty&&n.groups.length<1)return{message:i("There must be at least one group."),attributes:{groups:!0}};var r=new e.Collection,o=new e.Collection;if(n.groups.each(function(e){e.isValid()?r.add(e):o.add(e)}),!o.isEmpty())return{message:i("All groups must have a name."),attributes:{groups:o.toJSON()}};var s=r.map(function(e){return e.get("name")});return s.length!==t.uniq(s).length?{message:i("All groups must have a unique name."),attributes:{groups:r.toJSON()}}:void 0}});return s}),define("js/collections/group_configuration",["backbone","js/models/group_configuration"],function(e,t){var n=e.Collection.extend({model:t});return n}),define("js/utils/handle_iframe_binding",["jquery"],function(e){var t=function(t){var i=null;i="undefined"==typeof t?e("iframe, embed"):"undefined"!=typeof t.nodeName?e(t).find("iframe, embed"):t.$("iframe, embed"),n(i)},n=function(t){t.each(function(){if("IFRAME"===e(this).prop("tagName")){var t=e(this).attr("src");if(t){var n="wmode=transparent";if(-1!==t.indexOf("?")){var i=t.split("?");if(-1===i[1].search("wmode=transparent")){var r=i[1],o=i[0];e(this).attr("src",o+"?"+n+"&"+r)}}else 0!==t.lastIndexOf("javascript:",0)&&e(this).attr("src",t+"?"+n)}}else e(this).attr("wmode","transparent")})},i=function(t){if(t){var i=null,r=document.createElement("div");e(r).html(t),i=e(r).find("iframe, embed"),i.length>0&&(n(i),t=e(r).html())}return t};return{iframeBinding:t,iframeBindingHtml:i}}),define("js/views/feedback_prompt",["jquery","underscore","underscore.string","js/views/feedback"],function(e,t,n,i){var r,o,s=i.extend({options:e.extend({},i.prototype.options,{type:"prompt",closeIcon:!1,icon:!1}),render:function(){return window.$body||(window.$body=e(document.body)),this.options.shown?$body.addClass("prompt-is-shown"):$body.removeClass("prompt-is-shown"),i.prototype.render.apply(this,arguments)}});return r=t.compose(n.capitalize,n.camelize),o=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(o,function(t){var n;n=s.extend({options:e.extend({},s.prototype.options,{intent:t})}),s[r(t)]=n}),s}),define("js/views/utils/view_utils",["jquery","underscore","gettext","js/views/feedback_notification","js/views/feedback_prompt"],function(e,t,n,i,r){var o,s,a,u,l,c,d,p,h,f,g,m,v,w,x,y,b,_=65;return o=function(e,t){t||(t="collapsed"),e.closest(".expand-collapse").toggleClass("expand collapse"),e.closest(".is-collapsible, .window").toggleClass(t),e.closest(".is-collapsible").children("article").slideToggle()},s=function(){e(".ui-loading").show()},a=function(){e(".ui-loading").hide()},u=function(e,t,i,o,s){return new r.Warning({title:e,message:t,actions:{primary:{text:i,click:function(e){e.hide(),o()}},secondary:{text:n("Cancel"),click:function(e){return s&&s(),e.hide()}}}}).show()},l=function(e,t){var r;return r=new i.Mini({title:n(e)}),r.show(),t().done(function(){r.hide()})},c=function(e,t){return e.addClass("is-disabled").attr("aria-disabled",!0),t().always(function(){e.removeClass("is-disabled").attr("aria-disabled",!1)})},v=function(t){return function(n){n.preventDefault(),e.ajax({url:e(this).data("dismiss-link"),type:"DELETE",success:t})}},h=function(t){e("html, body").animate({scrollTop:t},500)},d=function(t){var n=t.offset().top;return n-e(window).scrollTop()},p=function(e,t){var n=e.offset().top,i=n-t;h(i)},f=function(e){window.location=e},g=function(){window.location.reload()},m=function(e,n){var i,r=e.changedAttributes();if(!r)return!1;for(i=0;i<n.length;i++)if(t.has(r,n[i]))return!0;return!1},w=function(e){return 0===e.length?n("Required field."):""},x=function(e,t){var i=w(e);if(i)return i;if(t){if(/\s/g.test(e))return n("Please do not use any spaces in this field.")}else if(e!==encodeURIComponent(e)||e.match(/[!'()*]/))return n("Please do not use any spaces or special characters in this field.");return""},y=function(n){var i=t.reduce(n,function(t,n){return t+e(n).val().length},0);return _>=i},b=function(n,i,r,o){y(r)?e(n.errorWrapper).removeClass(i.shown).addClass(i.hiding):(e(n.errorWrapper).addClass(i.shown).removeClass(i.hiding),e(n.errorMessage).html("<p>"+t.template(o,{limit:_})+"</p>"),e(n.save).addClass(i.disabled))},{toggleExpandCollapse:o,showLoadingIndicator:s,hideLoadingIndicator:a,confirmThenRunOperation:u,runOperationShowingMessage:l,disableElementWhileRunning:c,deleteNotificationHandler:v,setScrollTop:h,getScrollOffset:d,setScrollOffset:p,redirect:f,reload:g,hasChangedAttributes:m,validateRequiredField:w,validateURLItemEncoding:x,validateTotalKeyLength:y,checkTotalKeyLengthViolations:b}}),define("js/views/baseview",["jquery","underscore","backbone","gettext","js/utils/handle_iframe_binding","js/utils/templates","js/views/utils/view_utils"],function(e,t,n,i,r,o,s){var a=n.View.extend({events:{"click .ui-toggle-expansion":"toggleExpandCollapse"},options:{collapsedClass:"collapsed"},constructor:function(){t.bindAll(this,"beforeRender","render","afterRender");var e=this;this.render=t.wrap(this.render,function(t,n){return e.beforeRender(),t(n),e.afterRender(),e}),n.View.prototype.constructor.apply(this,arguments)},beforeRender:function(){},render:function(){return this},afterRender:function(){r.iframeBinding(this)},toggleExpandCollapse:function(t){var n=e(t.target);t.stopPropagation(),t.preventDefault(),s.toggleExpandCollapse(n,this.options.collapsedClass)},loadTemplate:function(e){return o.loadTemplate(e)}});return a}),define("js/views/pages/base_page",["jquery","js/views/baseview"],function(e,t){var n=t.extend({initialize:function(){t.prototype.initialize.call(this)},hasContent:function(){return!0},renderPage:function(){return e.Deferred().resolve().promise()},render:function(){var e=this;return this.$(".ui-loading").removeClass("is-hidden"),this.renderPage().done(function(){e.hasContent()||e.$(".no-content").removeClass("is-hidden")}).always(function(){e.$(".ui-loading").addClass("is-hidden")}),this}});return n}),define("js/views/list",["js/views/baseview"],function(e){var t=e.extend({events:{"click .action-add":"onAddItem","click .new-button":"onAddItem"},listContainerCss:".list-items",initialize:function(){this.listenTo(this.collection,"add",this.addNewItemView),this.listenTo(this.collection,"remove",this.onRemoveItem),this.template=this.loadTemplate("list"),this.listenTo(this.collection,"change:editing",this.toggleAddButton),this.listenTo(this.collection,"add",this.toggleAddButton),this.listenTo(this.collection,"remove",this.toggleAddButton)},render:function(e){return this.$el.html(this.template({itemCategoryDisplayName:this.itemCategoryDisplayName,emptyMessage:this.emptyMessage,length:this.collection.length,isEditing:e&&e.get("editing")})),this.collection.each(function(e){this.$(this.listContainerCss).append(this.createItemView({model:e}).render().el)},this),this},hideOrShowAddButton:function(e){var t=".action-add";this.collection.length&&(e?this.$(t).removeClass("is-hidden"):this.$(t).addClass("is-hidden"))},toggleAddButton:function(e){this.hideOrShowAddButton(e.get("editing")&&this.collection.contains(e)?!1:!0)},addNewItemView:function(e){var t=this.createItemView({model:e});this.collection.length>1?this.$(this.listContainerCss).append(t.render().el):this.render(),t.$el.focus()},onAddItem:function(e){e&&e.preventDefault&&e.preventDefault(),this.collection.add({editing:!0},this.newModelOptions)},onRemoveItem:function(){0===this.collection.length&&this.render()}});return t}),define("js/views/list_item",["js/views/baseview","jquery","gettext","js/views/utils/view_utils"],function(e,t,n,i){var r=e.extend({canDelete:!1,initialize:function(){this.listenTo(this.model,"change:editing",this.render),this.listenTo(this.model,"remove",this.remove)},className:function(){var e=this.model.collection.indexOf(this.model);return["wrapper-collection","wrapper-collection-"+e,this.baseClassName,this.baseClassName+"s-list-item",this.baseClassName+"s-list-item-"+e].join(" ")},deleteItem:function(e){if(e&&e.preventDefault&&e.preventDefault(),this.canDelete){var t=this.model,r=this.itemDisplayName;i.confirmThenRunOperation(interpolate(n("Delete this %(item_display_name)s?"),{item_display_name:r},!0),interpolate(n("Deleting this %(item_display_name)s is permanent and cannot be undone."),{item_display_name:r},!0),n("Delete"),function(){return i.runOperationShowingMessage(n("Deleting"),function(){return t.destroy({wait:!0})})})}},render:function(){return this.view&&this.view.remove(),this.view=this.model.get("editing")?this.createEditView():this.createDetailsView(),this.$el.html(this.view.render().el),this}});return r}),define("js/views/group_configuration_details",["js/views/baseview","underscore","gettext","underscore.string"],function(e,t,n,i){var r=e.extend({tagName:"div",events:{"click .edit":"editConfiguration","click .show-groups":"showGroups","click .hide-groups":"hideGroups"},className:function(){var e=this.model.collection.indexOf(this.model);return["collection","group-configuration-details","group-configuration-details-"+e].join(" ")},initialize:function(){this.template=t.template($("#group-configuration-details-tpl").text()),this.listenTo(this.model,"change",this.render)},render:function(){var e=$.extend({},this.model.attributes,{groupsCountMessage:this.getGroupsCountTitle(),usageCountMessage:this.getUsageCountTitle(),outlineAnchorMessage:this.getOutlineAnchorMessage(),index:this.model.collection.indexOf(this.model)});return this.$el.html(this.template(e)),this},editConfiguration:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("editing",!0)},showGroups:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("showGroups",!0)},hideGroups:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("showGroups",!1)},getGroupsCountTitle:function(){var e=this.model.get("groups").length,t=ngettext("Contains %(count)s group","Contains %(count)s groups",e);return interpolate(t,{count:e},!0)},getUsageCountTitle:function(){var e,t=this.model.get("usage").length;return e=0===t?n("Not in Use"):ngettext("Used in %(count)s unit","Used in %(count)s units",t),interpolate(e,{count:t},!0)},getOutlineAnchorMessage:function(){var e=n("This Group Configuration is not in use. Start by adding a content experiment to any Unit via the %(outlineAnchor)s."),t=i.sprintf('<a href="%(url)s" title="%(text)s">%(text)s</a>',{url:this.model.collection.outlineUrl,text:n("Course Outline")});
return i.sprintf(e,{outlineAnchor:t})}});return r}),define("js/views/list_item_editor",["js/views/baseview","js/views/utils/view_utils","underscore","gettext"],function(e,t,n,i){var r=e.extend({initialize:function(){this.listenTo(this.model,"invalid",this.render),this.listenTo(this.getSaveableModel(),"invalid",this.render)},render:function(){this.$el.html(this.template(n.extend({error:this.model.validationError||this.getSaveableModel().validationError},this.getTemplateOptions())))},setAndClose:function(e){return e&&e.preventDefault&&e.preventDefault(),this.setValues(),this.model.isValid()&&this.getSaveableModel().isValid()?void t.runOperationShowingMessage(i("Saving"),function(){var e=$.Deferred(),t=this.getSaveableModel();return t.save({},{success:function(){t.setOriginalAttributes(),this.close(),e.resolve()}.bind(this)}),e}.bind(this)):!1},cancel:function(e){return e&&e.preventDefault&&e.preventDefault(),this.getSaveableModel().reset(),this.close()},close:function(){return this.remove(),this.model.isNew()&&!n.isUndefined(this.model.collection)?this.model.collection.remove(this.model):this.model.set("editing",!1),this}});return r}),define("js/views/experiment_group_edit",["js/views/baseview","underscore","underscore.string","gettext"],function(e,t,n){t.str=n;var i=e.extend({tagName:"li",events:{"click .action-close":"removeGroup","change .group-name":"changeName","focus .groups-fields input":"onFocus","blur .groups-fields input":"onBlur"},className:function(){var e=this.model.collection.indexOf(this.model);return"field-group group group-"+e},initialize:function(){this.template=this.loadTemplate("group-edit"),this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.collection,t=e.indexOf(this.model);return this.$el.html(this.template({name:this.model.escape("name"),allocation:this.getAllocation(),index:t,error:this.model.validationError})),this},changeName:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.set({name:this.$(".group-name").val()},{silent:!0}),this},removeGroup:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.collection.remove(this.model),this.remove()},getAllocation:function(){return Math.floor(100/this.model.collection.length)},onFocus:function(){this.$el.closest(".groups-fields").addClass("is-focused")},onBlur:function(){this.$el.closest(".groups-fields").removeClass("is-focused")}});return i}),define("js/views/group_configuration_editor",["js/views/list_item_editor","underscore","jquery","gettext","js/views/experiment_group_edit"],function(e,t,n,i,r){var o=e.extend({tagName:"div",events:{"change .collection-name-input":"setName","change .group-configuration-description-input":"setDescription","click .action-add-group":"createGroup","focus .input-text":"onFocus","blur .input-text":"onBlur",submit:"setAndClose","click .action-cancel":"cancel"},className:function(){var e=this.model.collection.indexOf(this.model);return["collection-edit","group-configuration-edit","group-configuration-edit-"+e].join(" ")},initialize:function(){var t=this.model.get("groups");e.prototype.initialize.call(this),this.template=this.loadTemplate("group-configuration-editor"),this.listenTo(t,"add",this.onAddItem),this.listenTo(t,"reset",this.addAll),this.listenTo(t,"all",this.render)},render:function(){return e.prototype.render.call(this),this.addAll(),this},getTemplateOptions:function(){return{id:this.model.get("id"),uniqueId:t.uniqueId(),name:this.model.escape("name"),description:this.model.escape("description"),usage:this.model.get("usage"),isNew:this.model.isNew()}},getSaveableModel:function(){return this.model},onAddItem:function(e){var t=new r({model:e});return this.$("ol.groups").append(t.render().el),this},addAll:function(){this.model.get("groups").each(this.onAddItem,this)},createGroup:function(e){e&&e.preventDefault&&e.preventDefault();var t=this.model.get("groups");t.add([{name:t.getNextDefaultGroupName(),order:t.nextOrder()}])},setName:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("name",this.$(".collection-name-input").val(),{silent:!0})},setDescription:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("description",this.$(".group-configuration-description-input").val(),{silent:!0})},setValues:function(){return this.setName(),this.setDescription(),t.each(this.$(".groups li"),function(e,t){var i=this.model.get("groups").at(t);i&&i.set({name:n(".group-name",e).val()})},this),this}});return o}),define("js/views/group_configuration_item",["js/views/list_item","js/views/group_configuration_details","js/views/group_configuration_editor","gettext"],function(e,t,n,i){var r=e.extend({events:{"click .delete":"deleteItem"},tagName:"section",baseClassName:"group-configuration",canDelete:!0,itemDisplayName:i("group configuration"),attributes:function(){return{id:this.model.get("id"),tabindex:-1}},createEditView:function(){return new n({model:this.model})},createDetailsView:function(){return new t({model:this.model})}});return r}),define("js/views/group_configurations_list",["js/views/list","js/views/group_configuration_item","gettext"],function(e,t,n){var i=e.extend({tagName:"div",className:"group-configurations-list",newModelOptions:{addDefaultGroups:!0},itemCategoryDisplayName:n("group configuration"),emptyMessage:n("You have not created any group configurations yet."),createItemView:function(e){return new t(e)}});return i}),define("js/views/content_group_editor",["js/views/list_item_editor","underscore"],function(e,t){var n=e.extend({tagName:"div",className:"content-group-edit collection-edit",events:{submit:"setAndClose","click .action-cancel":"cancel"},initialize:function(){e.prototype.initialize.call(this),this.template=this.loadTemplate("content-group-editor")},getTemplateOptions:function(){return{name:this.model.escape("name"),index:this.model.collection.indexOf(this.model),isNew:this.model.isNew(),uniqueId:t.uniqueId()}},setValues:function(){return this.model.set({name:this.$("input").val().trim()}),this},getSaveableModel:function(){return this.model.collection.parents[0]}});return n}),define("js/views/content_group_details",["js/views/baseview"],function(e){var t=e.extend({tagName:"div",className:"content-group-details collection",events:{"click .edit":"editGroup"},editGroup:function(){this.model.set({editing:!0})},initialize:function(){this.template=this.loadTemplate("content-group-details")},render:function(){this.$el.html(this.template(this.model.toJSON()))}});return t}),define("js/views/content_group_item",["js/views/list_item","js/views/content_group_editor","js/views/content_group_details"],function(e,t,n){var i=e.extend({tagName:"section",baseClassName:"content-group",createEditView:function(){return new t({model:this.model})},createDetailsView:function(){return new n({model:this.model})}});return i}),define("js/views/content_group_list",["js/views/list","js/views/content_group_item","gettext"],function(e,t,n){var i=e.extend({tagName:"div",className:"content-group-list",itemCategoryDisplayName:n("content group"),emptyMessage:n("You have not created any content groups yet."),createItemView:function(e){return new t(e)}});return i}),define("js/views/pages/group_configurations",["jquery","underscore","gettext","js/views/pages/base_page","js/views/group_configurations_list","js/views/content_group_list"],function(e,t,n,i,r,o){var s=i.extend({initialize:function(e){i.prototype.initialize.call(this),this.experimentsEnabled=e.experimentsEnabled,this.experimentsEnabled&&(this.experimentGroupConfigurations=e.experimentGroupConfigurations,this.experimentGroupsListView=new r({collection:this.experimentGroupConfigurations})),this.contentGroupConfiguration=e.contentGroupConfiguration,this.cohortGroupsListView=new o({collection:this.contentGroupConfiguration.get("groups")})},renderPage:function(){var t=this.getLocationHash();return this.experimentsEnabled&&this.$(".wrapper-groups.experiment-groups").append(this.experimentGroupsListView.render().el),this.$(".wrapper-groups.content-groups").append(this.cohortGroupsListView.render().el),this.addWindowActions(),t&&this.expandConfiguration(t.replace("#","")),e.Deferred().resolve().promise()},addWindowActions:function(){e(window).on("beforeunload",this.onBeforeUnload.bind(this))},onBeforeUnload:function(){var e=this.contentGroupConfiguration.isDirty()||this.experimentsEnabled&&this.experimentGroupConfigurations.find(function(e){return e.isDirty()});return e?n("You have unsaved changes. Do you really want to leave this page?"):void 0},getLocationHash:function(){return window.location.hash},expandConfiguration:function(e){var t=this.experimentsEnabled&&this.experimentGroupConfigurations.findWhere({id:parseInt(e)});t&&(t.set("showGroups",!0),this.$("#"+e).focus())}});return s}),define("js/factories/group_configurations",["js/collections/group_configuration","js/models/group_configuration","js/views/pages/group_configurations"],function(e,t,n){return function(i,r,o,s,a){var u=new e(r,{parse:!0}),l=new t(o,{parse:!0,canBeEmpty:!0});u.url=s,u.outlineUrl=a,l.urlRoot=s,new n({el:$("#content"),experimentsEnabled:i,experimentGroupConfigurations:u,contentGroupConfiguration:l}).render()}});