(function(){"use strict";var XModule={};XModule.Descriptor=function(){var Descriptor=function(element){this.element=element,this.update=_.bind(this.update,this)};return Descriptor.prototype.onUpdate=function(callback){this.callbacks||(this.callbacks=[]),this.callbacks.push(callback)},Descriptor.prototype.update=function(){var data,callbacks,length;data=this.save(),callbacks=this.callbacks,length=callbacks.length,$.each(callbacks,function(index,callback){callback(data)})},Descriptor.prototype.save=function(){return{}},Descriptor}(),this.XBlockToXModuleShim=function(runtime,element){var module,moduleType=$(element).data("type");if("None"!==moduleType)try{return module=new window[moduleType](element),$(element).hasClass("xmodule_edit")&&$(document).trigger("XModule.loaded.edit",[element,module]),$(element).hasClass("xmodule_display")&&$(document).trigger("XModule.loaded.display",[element,module]),module}catch(error){console.error("Unable to load "+moduleType+": "+error.message)}},this.XModule=XModule}).call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};this.OpenEndedMarkdownEditingDescriptor=function(_super){function OpenEndedMarkdownEditingDescriptor(element){var selection,_this=this;this.toggleCheatsheetVisibility=function(){return OpenEndedMarkdownEditingDescriptor.prototype.toggleCheatsheetVisibility.apply(_this,arguments)},this.toggleCheatsheet=function(){return OpenEndedMarkdownEditingDescriptor.prototype.toggleCheatsheet.apply(_this,arguments)},this.onToolbarButton=function(){return OpenEndedMarkdownEditingDescriptor.prototype.onToolbarButton.apply(_this,arguments)},this.onShowXMLButton=function(){return OpenEndedMarkdownEditingDescriptor.prototype.onShowXMLButton.apply(_this,arguments)},this.element=element,0!==$(".markdown-box",this.element).length?(this.markdown_editor=CodeMirror.fromTextArea($(".markdown-box",element)[0],{lineWrapping:!0,mode:null}),this.setCurrentEditor(this.markdown_editor),selection=this.markdown_editor.getSelection(),""===this.markdown_editor.getValue()&&this.markdown_editor.setValue(OpenEndedMarkdownEditingDescriptor.promptTemplate+"\n"+OpenEndedMarkdownEditingDescriptor.rubricTemplate+"\n"+OpenEndedMarkdownEditingDescriptor.tasksTemplate),this.element.on("click",".xml-tab",this.onShowXMLButton),this.element.on("click",".format-buttons a",this.onToolbarButton),this.element.on("click",".cheatsheet-toggle",this.toggleCheatsheet),$(this.element.find(".xml-box")).hide()):this.createXMLEditor(),this.alertTaskRubricModification()}return __extends(OpenEndedMarkdownEditingDescriptor,_super),OpenEndedMarkdownEditingDescriptor.rubricTemplate="[rubric]\n+ Ideas\n- Difficult for the reader to discern the main idea.  Too brief or too repetitive to establish or maintain a focus.\n- Attempts a main idea.  Sometimes loses focus or ineffectively displays focus.\n- Presents a unifying theme or main idea, but may include minor tangents.  Stays somewhat focused on topic and task.\n- Presents a unifying theme or main idea without going off on tangents.  Stays completely focused on topic and task.\n+ Content\n- Includes little information with few or no details or unrelated details.  Unsuccessful in attempts to explore any facets of the topic.\n- Includes little information and few or no details.  Explores only one or two facets of the topic.\n- Includes sufficient information and supporting details. (Details may not be fully developed; ideas may be listed.)  Explores some facets of the topic.\n- Includes in-depth information and exceptional supporting details that are fully developed.  Explores all facets of the topic.\n+ Organization\n- Ideas organized illogically, transitions weak, and response difficult to follow.\n- Attempts to logically organize ideas.  Attempts to progress in an order that enhances meaning, and demonstrates use of transitions.\n- Ideas organized logically.  Progresses in an order that enhances meaning.  Includes smooth transitions.\n+ Style\n- Contains limited vocabulary, with many words used incorrectly.  Demonstrates problems with sentence patterns.\n- Contains basic vocabulary, with words that are predictable and common.  Contains mostly simple sentences (although there may be an attempt at more varied sentence patterns).\n- Includes vocabulary to make explanations detailed and precise.  Includes varied sentence patterns, including complex sentences.\n+ Voice\n- Demonstrates language and tone that may be inappropriate to task and reader.\n- Demonstrates an attempt to adjust language and tone to task and reader.\n- Demonstrates effective adjustment of language and tone to task and reader.\n[rubric]",OpenEndedMarkdownEditingDescriptor.tasksTemplate="[tasks]\n(Self), ({4-12}AI), ({9-12}Peer)\n[tasks]\n",OpenEndedMarkdownEditingDescriptor.promptTemplate="[prompt]\n\n<h3>Censorship in the Libraries</h3>\n\n<p>'All of us can think of a book that we hope none of our children or any other children have taken off the shelf. But if I have the right to remove that book from the shelf -- that work I abhor -- then you also have exactly the same right and so does everyone else. And then we have no books left on the shelf for any of us.' --Katherine Paterson, Author\n</p>\n\n<p>\nWrite a persuasive essay to a newspaper reflecting your views on censorship in libraries. Do you believe that certain materials, such as books, music, movies, magazines, etc., should be removed from the shelves if they are found offensive? Support your position with convincing arguments from your own experience, observations, and/or reading.\n</p>\n[prompt]\n",OpenEndedMarkdownEditingDescriptor.prototype.createXMLEditor=function(text){return this.xml_editor=CodeMirror.fromTextArea($(".xml-box",this.element)[0],{mode:"xml",lineNumbers:!0,lineWrapping:!0}),text&&this.xml_editor.setValue(text),this.setCurrentEditor(this.xml_editor),$(this.xml_editor.getWrapperElement()).toggleClass("CodeMirror-advanced"),this.xml_editor.refresh()},OpenEndedMarkdownEditingDescriptor.prototype.onShowXMLButton=function(e){return e.preventDefault(),this.cheatsheet&&this.cheatsheet.hasClass("shown")&&(this.cheatsheet.toggleClass("shown"),this.toggleCheatsheetVisibility()),this.confirmConversionToXml()?(this.createXMLEditor(OpenEndedMarkdownEditingDescriptor.markdownToXml(this.markdown_editor.getValue())),this.xml_editor.setCursor(0),$(this.element.find(".editor-bar")).hide()):void 0},OpenEndedMarkdownEditingDescriptor.prototype.alertTaskRubricModification=function(){return alert("Before you edit, please note that if you alter the tasks block or the rubric block of this question after students have submitted responses, it may result in their responses and grades being deleted!  Use caution when altering problems that have already been released to students.")},OpenEndedMarkdownEditingDescriptor.prototype.confirmConversionToXml=function(){return confirm("If you use the Advanced Editor, this problem will be converted to XML and you will not be able to return to the Simple Editor Interface.\n\nProceed to the Advanced Editor and convert this problem to XML?")},OpenEndedMarkdownEditingDescriptor.prototype.onToolbarButton=function(e){var revisedSelection,selection;switch(e.preventDefault(),selection=this.markdown_editor.getSelection(),revisedSelection=null,$(e.currentTarget).attr("class")){case"rubric-button":revisedSelection=OpenEndedMarkdownEditingDescriptor.insertRubric(selection);break;case"prompt-button":revisedSelection=OpenEndedMarkdownEditingDescriptor.insertPrompt(selection);break;case"tasks-button":revisedSelection=OpenEndedMarkdownEditingDescriptor.insertTasks(selection)}return null!==revisedSelection?(this.markdown_editor.replaceSelection(revisedSelection),this.markdown_editor.focus()):void 0},OpenEndedMarkdownEditingDescriptor.prototype.toggleCheatsheet=function(e){var _this=this;return e.preventDefault(),$(this.markdown_editor.getWrapperElement()).find(".simple-editor-open-ended-cheatsheet")[0]||(this.cheatsheet=$($("#simple-editor-open-ended-cheatsheet").html()),$(this.markdown_editor.getWrapperElement()).append(this.cheatsheet)),this.toggleCheatsheetVisibility(),setTimeout(function(){return _this.cheatsheet.toggleClass("shown")},10)},OpenEndedMarkdownEditingDescriptor.prototype.toggleCheatsheetVisibility=function(){return $(".modal-content").toggleClass("cheatsheet-is-shown")},OpenEndedMarkdownEditingDescriptor.prototype.setCurrentEditor=function(editor){return this.current_editor&&$(this.current_editor.getWrapperElement()).hide(),this.current_editor=editor,$(this.current_editor.getWrapperElement()).show(),$(this.current_editor).focus()},OpenEndedMarkdownEditingDescriptor.prototype.save=function(){return this.element.off("click",".xml-tab",this.changeEditor),this.element.off("click",".format-buttons a",this.onToolbarButton),this.element.off("click",".cheatsheet-toggle",this.toggleCheatsheet),this.current_editor===this.markdown_editor?{data:OpenEndedMarkdownEditingDescriptor.markdownToXml(this.markdown_editor.getValue()),metadata:{markdown:this.markdown_editor.getValue()}}:{data:this.xml_editor.getValue(),nullout:["markdown"]}},OpenEndedMarkdownEditingDescriptor.insertRubric=function(selectedText){return OpenEndedMarkdownEditingDescriptor.insertGenericInput(selectedText,"[rubric]","[rubric]",OpenEndedMarkdownEditingDescriptor.rubricTemplate)},OpenEndedMarkdownEditingDescriptor.insertPrompt=function(selectedText){return OpenEndedMarkdownEditingDescriptor.insertGenericInput(selectedText,"[prompt]","[prompt]",OpenEndedMarkdownEditingDescriptor.promptTemplate)},OpenEndedMarkdownEditingDescriptor.insertTasks=function(selectedText){return OpenEndedMarkdownEditingDescriptor.insertGenericInput(selectedText,"[tasks]","[tasks]",OpenEndedMarkdownEditingDescriptor.tasksTemplate)},OpenEndedMarkdownEditingDescriptor.insertGenericInput=function(selectedText,lineStart,lineEnd,template){var new_string;return selectedText.length>0?(new_string=selectedText.replace(/^\s+|\s+$/g,""),new_string.substring(0,lineStart.length)!==lineStart&&(new_string=lineStart+new_string),new_string.substring(new_string.length-lineEnd.length,new_string.length)!==lineEnd&&(new_string+=lineEnd),new_string):template},OpenEndedMarkdownEditingDescriptor.markdownToXml=function(markdown){var toXml;return(toXml=function(markdown){function template(template_html,data){return template_html.replace(/%(\w*)%/g,function(m,key){return data.hasOwnProperty(key)?data[key]:""})}var xml=markdown;return xml=xml.replace(/\[rubric\]\n?([^\]]*)\[\/?rubric\]/gim,function(match,p){for(var groupString="<rubric>\n<rubric>\n",options=p.split("\n"),category_open=!1,i=0;i<options.length;i++){if(options[i].length>0){var value=options[i].replace(/^\s+|\s+$/g,"");"+"==value.charAt(0)?(i>0&&1==category_open&&(groupString+="</category>\n",category_open=!1),groupString+="<category>\n<description>\n",category_open=!0,text=value.substr(1),text=text.replace(/^\s+|\s+$/g,""),groupString+=text,groupString+="\n</description>\n"):"-"==value.charAt(0)&&(groupString+="<option>\n",text=value.substr(1),text=text.replace(/^\s+|\s+$/g,""),groupString+=text,groupString+="\n</option>\n")}i==options.length-1&&1==category_open&&(groupString+="\n</category>\n")}return groupString+="</rubric>\n</rubric>\n"}),xml=xml.replace(/\[tasks\]\n?([^\]]*)\[\/?tasks\]/gim,function(match,p){var open_ended_template=$("#open-ended-template").html();null==open_ended_template&&(open_ended_template="<openended %min_max_string%>%grading_config%</openended>");for(var groupString="",options=p.split(","),i=0;i<options.length;i++)if(options[i].length>0){var value=options[i].replace(/^\s+|\s+$/g,""),lower_option=value.toLowerCase();if(type=lower_option.match(/(peer|self|ai)/gim),null!=type){type=type[0];var min_max=value.match(/\{\n?([^\]]*)\}/gim),min_max_string="";null!=min_max&&(min_max=min_max[0].replace(/^{|}/gim,""),min_max=min_max.split("-"),min=min_max[0],max=min_max[1],min_max_string='min_score_to_attempt="'+min+'" max_score_to_attempt="'+max+'" '),groupString+="<task>\n","self"==type?groupString+="<selfassessment"+min_max_string+"/>":"peer"==type?(config="peer_grading.conf",groupString+=template(open_ended_template,{min_max_string:min_max_string,grading_config:config})):"ai"==type&&(config="ml_grading.conf",groupString+=template(open_ended_template,{min_max_string:min_max_string,grading_config:config})),groupString+="</task>\n"}}return groupString}),xml=xml.replace(/\[prompt\]\n?([^\]]*)\[\/?prompt\]/gim,function(match,p1){var selectString="<prompt>\n"+p1+"\n</prompt>";return selectString}),xml=xml.replace(/\n\n\n/g,"\n"),xml="<combinedopenended>\n"+xml+"\n</combinedopenended>"})(markdown)},OpenEndedMarkdownEditingDescriptor}(XModule.Descriptor)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};this.MetadataOnlyEditingDescriptor=function(_super){function MetadataOnlyEditingDescriptor(element){this.element=element}return __extends(MetadataOnlyEditingDescriptor,_super),MetadataOnlyEditingDescriptor.prototype.save=function(){return{data:null}},MetadataOnlyEditingDescriptor}(XModule.Descriptor)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};this.VerticalDescriptor=function(_super){function VerticalDescriptor(){return VerticalDescriptor.__super__.constructor.apply(this,arguments)}return __extends(VerticalDescriptor,_super),VerticalDescriptor}(XModule.Descriptor)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};this.XMLEditingDescriptor=function(_super){function XMLEditingDescriptor(element){this.element=element,this.edit_box=CodeMirror.fromTextArea($(".edit-box",this.element)[0],{mode:"xml",lineNumbers:!0,lineWrapping:!0})}return __extends(XMLEditingDescriptor,_super),XMLEditingDescriptor.prototype.save=function(){return{data:this.edit_box.getValue()}},XMLEditingDescriptor}(XModule.Descriptor)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};this.MarkdownEditingDescriptor=function(_super){function MarkdownEditingDescriptor(element){var _this=this;this.toggleCheatsheetVisibility=function(){return MarkdownEditingDescriptor.prototype.toggleCheatsheetVisibility.apply(_this,arguments)},this.toggleCheatsheet=function(){return MarkdownEditingDescriptor.prototype.toggleCheatsheet.apply(_this,arguments)},this.onToolbarButton=function(){return MarkdownEditingDescriptor.prototype.onToolbarButton.apply(_this,arguments)},this.onShowXMLButton=function(){return MarkdownEditingDescriptor.prototype.onShowXMLButton.apply(_this,arguments)},this.element=element,0!==$(".markdown-box",this.element).length?(this.markdown_editor=CodeMirror.fromTextArea($(".markdown-box",element)[0],{lineWrapping:!0,mode:null}),this.setCurrentEditor(this.markdown_editor),this.element.on("click",".xml-tab",this.onShowXMLButton),this.element.on("click",".format-buttons a",this.onToolbarButton),this.element.on("click",".cheatsheet-toggle",this.toggleCheatsheet),$(this.element.find(".xml-box")).hide()):this.createXMLEditor()}return __extends(MarkdownEditingDescriptor,_super),MarkdownEditingDescriptor.multipleChoiceTemplate="( ) incorrect\n( ) incorrect\n(x) correct\n",MarkdownEditingDescriptor.checkboxChoiceTemplate="[x] correct\n[ ] incorrect\n[x] correct\n",MarkdownEditingDescriptor.stringInputTemplate="= answer\n",MarkdownEditingDescriptor.numberInputTemplate="= answer +- 0.001%\n",MarkdownEditingDescriptor.selectTemplate="[[incorrect, (correct), incorrect]]\n",MarkdownEditingDescriptor.headerTemplate="Header\n=====\n",MarkdownEditingDescriptor.explanationTemplate="[explanation]\nShort explanation\n[explanation]\n",MarkdownEditingDescriptor.prototype.createXMLEditor=function(text){return this.xml_editor=CodeMirror.fromTextArea($(".xml-box",this.element)[0],{mode:"xml",lineNumbers:!0,lineWrapping:!0}),text&&this.xml_editor.setValue(text),this.setCurrentEditor(this.xml_editor),$(this.xml_editor.getWrapperElement()).toggleClass("CodeMirror-advanced"),this.xml_editor.refresh()},MarkdownEditingDescriptor.prototype.onShowXMLButton=function(e){return e.preventDefault(),this.cheatsheet&&this.cheatsheet.hasClass("shown")&&(this.cheatsheet.toggleClass("shown"),this.toggleCheatsheetVisibility()),this.confirmConversionToXml()?(this.createXMLEditor(MarkdownEditingDescriptor.markdownToXml(this.markdown_editor.getValue())),this.xml_editor.setCursor(0),$(this.element.find(".editor-bar")).hide()):void 0},MarkdownEditingDescriptor.prototype.confirmConversionToXml=function(){return confirm("If you use the Advanced Editor, this problem will be converted to XML and you will not be able to return to the Simple Editor Interface.\n\nProceed to the Advanced Editor and convert this problem to XML?")},MarkdownEditingDescriptor.prototype.onToolbarButton=function(e){var revisedSelection,selection;switch(e.preventDefault(),selection=this.markdown_editor.getSelection(),revisedSelection=null,$(e.currentTarget).attr("class")){case"multiple-choice-button":revisedSelection=MarkdownEditingDescriptor.insertMultipleChoice(selection);break;case"string-button":revisedSelection=MarkdownEditingDescriptor.insertStringInput(selection);break;case"number-button":revisedSelection=MarkdownEditingDescriptor.insertNumberInput(selection);break;case"checks-button":revisedSelection=MarkdownEditingDescriptor.insertCheckboxChoice(selection);break;case"dropdown-button":revisedSelection=MarkdownEditingDescriptor.insertSelect(selection);break;case"header-button":revisedSelection=MarkdownEditingDescriptor.insertHeader(selection);break;case"explanation-button":revisedSelection=MarkdownEditingDescriptor.insertExplanation(selection)}return null!==revisedSelection?(this.markdown_editor.replaceSelection(revisedSelection),this.markdown_editor.focus()):void 0},MarkdownEditingDescriptor.prototype.toggleCheatsheet=function(e){var _this=this;return e.preventDefault(),$(this.markdown_editor.getWrapperElement()).find(".simple-editor-cheatsheet")[0]||(this.cheatsheet=$($("#simple-editor-cheatsheet").html()),$(this.markdown_editor.getWrapperElement()).append(this.cheatsheet)),this.toggleCheatsheetVisibility(),setTimeout(function(){return _this.cheatsheet.toggleClass("shown")},10)},MarkdownEditingDescriptor.prototype.toggleCheatsheetVisibility=function(){return $(".modal-content").toggleClass("cheatsheet-is-shown")},MarkdownEditingDescriptor.prototype.setCurrentEditor=function(editor){return this.current_editor&&$(this.current_editor.getWrapperElement()).hide(),this.current_editor=editor,$(this.current_editor.getWrapperElement()).show(),$(this.current_editor).focus()},MarkdownEditingDescriptor.prototype.save=function(){return this.element.off("click",".xml-tab",this.changeEditor),this.element.off("click",".format-buttons a",this.onToolbarButton),this.element.off("click",".cheatsheet-toggle",this.toggleCheatsheet),this.current_editor===this.markdown_editor?{data:MarkdownEditingDescriptor.markdownToXml(this.markdown_editor.getValue()),metadata:{markdown:this.markdown_editor.getValue()}}:{data:this.xml_editor.getValue(),nullout:["markdown"]}},MarkdownEditingDescriptor.insertMultipleChoice=function(selectedText){return MarkdownEditingDescriptor.insertGenericChoice(selectedText,"(",")",MarkdownEditingDescriptor.multipleChoiceTemplate)},MarkdownEditingDescriptor.insertCheckboxChoice=function(selectedText){return MarkdownEditingDescriptor.insertGenericChoice(selectedText,"[","]",MarkdownEditingDescriptor.checkboxChoiceTemplate)},MarkdownEditingDescriptor.insertGenericChoice=function(selectedText,choiceStart,choiceEnd,template){var cleanSelectedText,line,lines,revisedLines,_i,_len;if(selectedText.length>0){for(cleanSelectedText=selectedText.replace(/\n+/g,"\n").replace(/\n$/,""),lines=cleanSelectedText.split("\n"),revisedLines="",_i=0,_len=lines.length;_len>_i;_i++)line=lines[_i],revisedLines+=choiceStart,/^\s*x\s+(\S)/i.test(line)?(line=line.replace(/^\s*x\s+(\S)/i,"$1"),revisedLines+="x"):revisedLines+=" ",revisedLines+=choiceEnd+" "+line+"\n";return revisedLines}return template},MarkdownEditingDescriptor.insertStringInput=function(selectedText){return MarkdownEditingDescriptor.insertGenericInput(selectedText,"= ","",MarkdownEditingDescriptor.stringInputTemplate)},MarkdownEditingDescriptor.insertNumberInput=function(selectedText){return MarkdownEditingDescriptor.insertGenericInput(selectedText,"= ","",MarkdownEditingDescriptor.numberInputTemplate)},MarkdownEditingDescriptor.insertSelect=function(selectedText){return MarkdownEditingDescriptor.insertGenericInput(selectedText,"[[","]]",MarkdownEditingDescriptor.selectTemplate)},MarkdownEditingDescriptor.insertHeader=function(selectedText){return MarkdownEditingDescriptor.insertGenericInput(selectedText,"","\n====\n",MarkdownEditingDescriptor.headerTemplate)},MarkdownEditingDescriptor.insertExplanation=function(selectedText){return MarkdownEditingDescriptor.insertGenericInput(selectedText,"[explanation]\n","\n[explanation]",MarkdownEditingDescriptor.explanationTemplate)},MarkdownEditingDescriptor.insertGenericInput=function(selectedText,lineStart,lineEnd,template){return selectedText.length>0?lineStart+selectedText+lineEnd:template},MarkdownEditingDescriptor.markdownToXml=function(markdown){var toXml;return(toXml=function(markdown){var i,splits,scriptFlag,xml=markdown;xml=xml.replace(/(^.*?$)(?=\n\=\=+$)/gm,"<h1>$1</h1>"),xml=xml.replace(/\n^\=\=+$/gm,""),xml=xml.replace(/(^\s*\(.{0,3}\).*?$\n*)+/gm,function(match){for(var choices="",shuffle=!1,options=match.split("\n"),i=0;i<options.length;i++)if(options[i].length>0){var value=options[i].split(/^\s*\(.{0,3}\)\s*/)[1],inparens=/^\s*\((.{0,3})\)\s*/.exec(options[i])[1],correct=/x/i.test(inparens),fixed="";/@/.test(inparens)&&(fixed=' fixed="true"'),/!/.test(inparens)&&(shuffle=!0),choices+='    <choice correct="'+correct+'"'+fixed+">"+value+"</choice>\n"}var result="<multiplechoiceresponse>\n";return result+=shuffle?'  <choicegroup type="MultipleChoice" shuffle="true">\n':'  <choicegroup type="MultipleChoice">\n',result+=choices,result+="  </choicegroup>\n",result+="</multiplechoiceresponse>\n\n"}),xml=xml.replace(/(^\s*\[.?\].*?$\n*)+/gm,function(match){var options,value,correct,groupString="<choiceresponse>\n";for(groupString+='  <checkboxgroup direction="vertical">\n',options=match.split("\n"),i=0;i<options.length;i+=1)options[i].length>0&&(value=options[i].split(/^\s*\[.?\]\s*/)[1],correct=/^\s*\[x\]/i.test(options[i]),groupString+='    <choice correct="'+correct+'">'+value+"</choice>\n");return groupString+="  </checkboxgroup>\n",groupString+="</choiceresponse>\n\n"}),xml=xml.replace(/(^\=\s*(.*?$)(\n*or\=\s*(.*?$))*)+/gm,function(match,p){var answersList=p.replace(/^(or)?=\s*/gm,"").split("\n"),processNumericalResponse=function(value){var params,answer,string;return _.contains(["[","("],value[0])&&_.contains(["]",")"],value[value.length-1])?(string='<numericalresponse answer="'+value+'">\n',string+="  <formulaequationinput />\n",string+="</numericalresponse>\n\n"):isNaN(parseFloat(value))?!1:(params=/(.*?)\+\-\s*(.*?$)/.exec(value),params?(answer=params[1].replace(/\s+/g,""),string='<numericalresponse answer="'+answer+'">\n',string+='  <responseparam type="tolerance" default="'+params[2]+'" />\n'):(answer=value.replace(/\s+/g,""),string='<numericalresponse answer="'+answer+'">\n'),string+="  <formulaequationinput />\n",string+="</numericalresponse>\n\n")},processStringResponse=function(values){var string,firstAnswer=values.shift();for(string="|"===firstAnswer[0]?'<stringresponse answer="'+firstAnswer.slice(1).trim()+'" type="ci regexp" >\n':'<stringresponse answer="'+firstAnswer+'" type="ci" >\n',i=0;i<values.length;i+=1)string+="  <additional_answer>"+values[i]+"</additional_answer>\n";return string+='  <textline size="20"/>\n</stringresponse>\n\n'};return processNumericalResponse(answersList[0])||processStringResponse(answersList)}),xml=xml.replace(/\[\[(.+?)\]\]/g,function(match,p){var correct,options,selectString="\n<optionresponse>\n";for(selectString+='  <optioninput options="(',options=p.split(/\,\s*/g),i=0;i<options.length;i+=1)selectString+="'"+options[i].replace(/(?:^|,)\s*\((.*?)\)\s*(?:$|,)/g,"$1")+"'"+(i<options.length-1?",":"");return selectString+=')" correct="',correct=/(?:^|,)\s*\((.*?)\)\s*(?:$|,)/g.exec(p),correct&&(selectString+=correct[1]),selectString+='"></optioninput>\n',selectString+="</optionresponse>\n\n"}),xml=xml.replace(/\[explanation\]\n?([^\]]*)\[\/?explanation\]/gim,function(match,p1){var selectString='<solution>\n<div class="detailed-solution">\nExplanation\n\n'+p1+"\n</div>\n</solution>";return selectString});var line,i,curlabel,split=xml.split("\n"),new_xml=[],prevlabel="",didinput=!1;for(i=0;i<split.length;i++)line=split[i],(match=line.match(/>>(.*)<</))?(curlabel=match[1].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),line=line.replace(/>>|<</g,"")):line.match(/<\w+response/)&&didinput&&curlabel==prevlabel?(curlabel="",didinput=!1):line.match(/<(textline|optioninput|formulaequationinput|choicegroup|checkboxgroup)/)&&""!=curlabel&&void 0!=curlabel&&(line=line.replace(/<(textline|optioninput|formulaequationinput|choicegroup|checkboxgroup)/,'<$1 label="'+curlabel+'"'),didinput=!0,prevlabel=curlabel),new_xml.push(line);for(xml=new_xml.join("\n"),xml=xml.replace(/\[code\]\n?([^\]]*)\[\/?code\]/gim,function(match,p1){var selectString="<pre><code>\n"+p1+"</code></pre>";return selectString}),splits=xml.split(/(\<\/?(?:script|pre).*?\>)/g),scriptFlag=!1,i=0;i<splits.length;i+=1)/\<(script|pre)/.test(splits[i])&&(scriptFlag=!0),scriptFlag||(splits[i]=splits[i].replace(/(^(?!\s*\<|$).*$)/gm,"<p>$1</p>")),/\<\/(script|pre)/.test(splits[i])&&(scriptFlag=!1);return xml=splits.join(""),xml=xml.replace(/\n\n\n/g,"\n"),xml="<problem>\n"+xml+"\n</problem>"})(markdown)},MarkdownEditingDescriptor}(XModule.Descriptor)}.call(this),function(){this.TabsEditingDescriptor=function(){function TabsEditingDescriptor(element){var currentTab,_this=this;this.onSwitchEditor=function(){return TabsEditingDescriptor.prototype.onSwitchEditor.apply(_this,arguments)},this.element=element,this.$tabs=$(".tab",this.element),this.$content=$(".component-tab",this.element),this.element.find(".editor-tabs .tab").each(function(index,value){return $(value).on("click",_this.onSwitchEditor)}),currentTab=this.$tabs.filter(".current"),1!==currentTab.length&&(currentTab=this.$tabs.first()),this.html_id=this.$tabs.closest(".wrapper-comp-editor").data("html_id"),currentTab.trigger("click",[!0,this.html_id])}return TabsEditingDescriptor.isInactiveClass="is-inactive",TabsEditingDescriptor.prototype.onSwitchEditor=function(e,firstTime){var $currentTarget,content_id,isInactiveClass,onSwitchFunction,previousTab;return e.preventDefault(),isInactiveClass=TabsEditingDescriptor.isInactiveClass,$currentTarget=$(e.currentTarget),$currentTarget.hasClass("current")&&firstTime!==!0?void 0:(previousTab=null,this.$tabs.each(function(index,value){return $(value).hasClass("current")?previousTab=$(value).data("tab_name"):void 0}),TabsEditingDescriptor.Model.updateValue(this.html_id,previousTab),onSwitchFunction=TabsEditingDescriptor.Model.modules[this.html_id].tabSwitch[$currentTarget.data("tab_name")],$.isFunction(onSwitchFunction)&&onSwitchFunction(),this.$tabs.removeClass("current"),$currentTarget.addClass("current"),content_id=$currentTarget.attr("href"),this.$content.addClass(isInactiveClass).filter(content_id).removeClass(isInactiveClass))},TabsEditingDescriptor.prototype.save=function(){var current_tab;return this.element.off("click",".editor-tabs .tab",this.onSwitchEditor),current_tab=this.$tabs.filter(".current").data("tab_name"),{data:TabsEditingDescriptor.Model.getValue(this.html_id,current_tab)}},TabsEditingDescriptor.prototype.setMetadataEditor=function(){return TabsEditingDescriptor.setMetadataEditor.apply(TabsEditingDescriptor,arguments)},TabsEditingDescriptor.prototype.getStorage=function(){return TabsEditingDescriptor.getStorage()},TabsEditingDescriptor.prototype.addToStorage=function(){return TabsEditingDescriptor.addToStorage.apply(TabsEditingDescriptor,arguments)},TabsEditingDescriptor.Model={addModelUpdate:function(id,tabName,modelUpdateFunction){return this.initialize(id),this.modules[id].modelUpdate[tabName]=modelUpdateFunction},addOnSwitch:function(id,tabName,onSwitchFunction){return this.initialize(id),this.modules[id].tabSwitch[tabName]=onSwitchFunction},updateValue:function(id,tabName){var modelUpdateFunction;return this.initialize(id),modelUpdateFunction=this.modules[id].modelUpdate[tabName],$.isFunction(modelUpdateFunction)?this.modules[id].value=modelUpdateFunction():void 0},getValue:function(id,tabName){return this.modules[id]?$.isFunction(this.modules[id].modelUpdate[tabName])?this.modules[id].modelUpdate[tabName]():"undefined"==typeof this.modules[id].value?null:this.modules[id].value:null},modules:{},Storage:{},initialize:function(id){return this.modules[id]=this.modules[id]||{},this.modules[id].tabSwitch=this.modules[id].tabSwitch||{},this.modules[id].modelUpdate=this.modules[id].modelUpdate||{}}},TabsEditingDescriptor.setMetadataEditor=function(metadataEditor){return TabsEditingDescriptor.Model.Storage.MetadataEditor=metadataEditor},TabsEditingDescriptor.addToStorage=function(id,data){return TabsEditingDescriptor.Model.Storage[id]=data},TabsEditingDescriptor.getStorage=function(){return TabsEditingDescriptor.Model.Storage},TabsEditingDescriptor}()}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};this.SequenceDescriptor=function(_super){function SequenceDescriptor(){return SequenceDescriptor.__super__.constructor.apply(this,arguments)}return __extends(SequenceDescriptor,_super),SequenceDescriptor}(XModule.Descriptor)}.call(this),function(){this.HTMLEditingDescriptor=function(){function HTMLEditingDescriptor(element){var tiny_mce_css_links,_this=this;this.initInstanceCallback=function(){return HTMLEditingDescriptor.prototype.initInstanceCallback.apply(_this,arguments)},this.saveCodeEditor=function(){return HTMLEditingDescriptor.prototype.saveCodeEditor.apply(_this,arguments)},this.showCodeEditor=function(){return HTMLEditingDescriptor.prototype.showCodeEditor.apply(_this,arguments)},this.saveLink=function(){return HTMLEditingDescriptor.prototype.saveLink.apply(_this,arguments)},this.editLink=function(){return HTMLEditingDescriptor.prototype.editLink.apply(_this,arguments)},this.saveImage=function(){return HTMLEditingDescriptor.prototype.saveImage.apply(_this,arguments)},this.editImage=function(){return HTMLEditingDescriptor.prototype.editImage.apply(_this,arguments)},this.setupTinyMCE=function(){return HTMLEditingDescriptor.prototype.setupTinyMCE.apply(_this,arguments)
},this.element=element,this.base_asset_url=this.element.find("#editor-tab").data("base-asset-url"),this.editor_choice=this.element.find("#editor-tab").data("editor"),void 0===this.base_asset_url&&(this.base_asset_url=null),this.advanced_editor=CodeMirror.fromTextArea($(".edit-box",this.element)[0],{mode:"text/html",lineNumbers:!0,lineWrapping:!0}),"visual"===this.editor_choice&&(this.$advancedEditorWrapper=$(this.advanced_editor.getWrapperElement()),this.$advancedEditorWrapper.addClass("is-inactive"),tiny_mce_css_links=[],$("link[rel=stylesheet][href*='tinymce']").filter("[href*='content']").each(function(){tiny_mce_css_links.push($(this).attr("href"))}),tinyMCE.baseURL=""+baseUrl+"/js/vendor/tinymce/js/tinymce",tinyMCE.suffix=".min",this.tiny_mce_textarea=$(".tiny-mce",this.element).tinymce({script_url:""+baseUrl+"/js/vendor/tinymce/js/tinymce/tinymce.full.min.js",font_formats:_getFonts(),theme:"modern",skin:"studio-tmce4",schema:"html5",convert_urls:!1,content_css:tiny_mce_css_links.join(", "),formats:{code:{inline:"code"}},visual:!1,plugins:"textcolor, link, image, codemirror",codemirror:{path:""+baseUrl+"/js/vendor"},image_advtab:!0,toolbar:"formatselect | fontselect | bold italic underline forecolor wrapAsCode | bullist numlist outdent indent blockquote | link unlink image | code",block_formats:interpolate("%(paragraph)s=p;%(preformatted)s=pre;%(heading1)s=h1;%(heading2)s=h2;%(heading3)s=h3",{paragraph:gettext("Paragraph"),preformatted:gettext("Preformatted"),heading1:gettext("Heading 1"),heading2:gettext("Heading 2"),heading3:gettext("Heading 3")},!0),width:"100%",height:"400px",menubar:!1,statusbar:!1,valid_children:"+body[style]",valid_elements:"*[*]",extended_valid_elements:"*[*]",invalid_elements:"",setup:this.setupTinyMCE,init_instance_callback:this.initInstanceCallback}),tinymce.addI18n("en",{"Add to Dictionary":gettext("Add to Dictionary"),Advanced:gettext("Advanced"),"Align center":gettext("Align center"),"Align left":gettext("Align left"),"Align right":gettext("Align right"),Alignment:gettext("Alignment"),"Alternative source":gettext("Alternative source"),Anchor:gettext("Anchor"),Anchors:gettext("Anchors"),Author:gettext("Author"),"Background color":gettext("Background color"),Blockquote:gettext("Blockquote"),Blocks:gettext("Blocks"),Body:gettext("Body"),Bold:gettext("Bold"),"Border color":gettext("Border color"),Border:gettext("Border"),Bottom:gettext("Bottom"),"Bullet list":gettext("Bullet list"),Cancel:gettext("Cancel"),Caption:gettext("Caption"),"Cell padding":gettext("Cell padding"),"Cell properties":gettext("Cell properties"),"Cell spacing":gettext("Cell spacing"),"Cell type":gettext("Cell type"),Cell:gettext("Cell"),Center:gettext("Center"),Circle:gettext("Circle"),"Clear formatting":gettext("Clear formatting"),Close:gettext("Close"),"Code block":gettext("Code block"),Code:gettext("Code"),Color:gettext("Color"),Cols:gettext("Cols"),"Column group":gettext("Column group"),Column:gettext("Column"),"Constrain proportions":gettext("Constrain proportions"),"Copy row":gettext("Copy row"),Copy:gettext("Copy"),"Could not find the specified string.":gettext("Could not find the specified string."),"Custom color":gettext("Custom color"),"Custom...":gettext("Custom..."),"Cut row":gettext("Cut row"),Cut:gettext("Cut"),"Decrease indent":gettext("Decrease indent"),Default:gettext("Default"),"Delete column":gettext("Delete column"),"Delete row":gettext("Delete row"),"Delete table":gettext("Delete table"),Description:gettext("Description"),Dimensions:gettext("Dimensions"),Disc:gettext("Disc"),Div:gettext("Div"),"Document properties":gettext("Document properties"),"Edit HTML":gettext("Edit HTML"),Edit:gettext("Edit"),Embed:gettext("Embed"),Emoticons:gettext("Emoticons"),Encoding:gettext("Encoding"),File:gettext("File"),"Find and replace":gettext("Find and replace"),"Find next":gettext("Find next"),"Find previous":gettext("Find previous"),Find:gettext("Find"),Finish:gettext("Finish"),"Font Family":gettext("Font Family"),"Font Sizes":gettext("Font Sizes"),Footer:gettext("Footer"),Format:gettext("Format"),Formats:gettext("Formats"),Fullscreen:gettext("Fullscreen"),General:gettext("General"),"H Align":gettext("H Align"),"Header 1":gettext("Header 1"),"Header 2":gettext("Header 2"),"Header 3":gettext("Header 3"),"Header 4":gettext("Header 4"),"Header 5":gettext("Header 5"),"Header 6":gettext("Header 6"),"Header cell":gettext("Header cell"),Header:gettext("Header"),Headers:gettext("Headers"),"Heading 1":gettext("Heading 1"),"Heading 2":gettext("Heading 2"),"Heading 3":gettext("Heading 3"),"Heading 4":gettext("Heading 4"),"Heading 5":gettext("Heading 5"),"Heading 6":gettext("Heading 6"),Headings:gettext("Headings"),Height:gettext("Height"),"Horizontal line":gettext("Horizontal line"),"Horizontal space":gettext("Horizontal space"),"HTML source code":gettext("HTML source code"),"Ignore all":gettext("Ignore all"),Ignore:gettext("Ignore"),"Image description":gettext("Image description"),"Increase indent":gettext("Increase indent"),Inline:gettext("Inline"),"Insert column after":gettext("Insert column after"),"Insert column before":gettext("Insert column before"),"Insert date/time":gettext("Insert date/time"),"Insert image":gettext("Insert image"),"Insert link":gettext("Insert link"),"Insert row after":gettext("Insert row after"),"Insert row before":gettext("Insert row before"),"Insert table":gettext("Insert table"),"Insert template":gettext("Insert template"),"Insert video":gettext("Insert video"),Insert:gettext("Insert"),"Insert/edit image":gettext("Insert/edit image"),"Insert/edit link":gettext("Insert/edit link"),"Insert/edit video":gettext("Insert/edit video"),Italic:gettext("Italic"),Justify:gettext("Justify"),Keywords:gettext("Keywords"),"Left to right":gettext("Left to right"),Left:gettext("Left"),"Lower Alpha":gettext("Lower Alpha"),"Lower Greek":gettext("Lower Greek"),"Lower Roman":gettext("Lower Roman"),"Match case":gettext("Match case"),"Merge cells":gettext("Merge cells"),Middle:gettext("Middle"),Name:gettext("Name"),"New document":gettext("New document"),"New window":gettext("New window"),Next:gettext("Next"),"No color":gettext("No color"),"Nonbreaking space":gettext("Nonbreaking space"),None:gettext("None"),"Numbered list":gettext("Numbered list"),Ok:gettext("Ok"),OK:gettext("OK"),"Page break":gettext("Page break"),Paragraph:gettext("Paragraph"),"Paste as text":gettext("Paste as text"),"Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off.":gettext("Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off."),"Paste row after":gettext("Paste row after"),"Paste row before":gettext("Paste row before"),"Paste your embed code below:":gettext("Paste your embed code below:"),Paste:gettext("Paste"),Poster:gettext("Poster"),Pre:gettext("Pre"),Prev:gettext("Prev"),Preview:gettext("Preview"),Print:gettext("Print"),Redo:gettext("Redo"),"Remove link":gettext("Remove link"),"Replace all":gettext("Replace all"),"Replace all":gettext("Replace all"),"Replace with":gettext("Replace with"),Replace:gettext("Replace"),Replace:gettext("Replace"),"Restore last draft":gettext("Restore last draft"),"Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help":gettext("Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help"),"Right to left":gettext("Right to left"),Right:gettext("Right"),Robots:gettext("Robots"),"Row group":gettext("Row group"),"Row properties":gettext("Row properties"),"Row type":gettext("Row type"),Row:gettext("Row"),Rows:gettext("Rows"),Save:gettext("Save"),Scope:gettext("Scope"),"Select all":gettext("Select all"),"Show blocks":gettext("Show blocks"),"Show invisible characters":gettext("Show invisible characters"),"Source code":gettext("Source code"),Source:gettext("Source"),"Special character":gettext("Special character"),Spellcheck:gettext("Spellcheck"),"Split cell":gettext("Split cell"),Square:gettext("Square"),"Start search":gettext("Start search"),Strikethrough:gettext("Strikethrough"),Style:gettext("Style"),Subscript:gettext("Subscript"),Superscript:gettext("Superscript"),"Table properties":gettext("Table properties"),Table:gettext("Table"),Target:gettext("Target"),Templates:gettext("Templates"),"Text color":gettext("Text color"),"Text to display":gettext("Text to display"),"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?":gettext("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?"),"The URL you entered seems to be an external link. Do you want to add the required http:// prefix?":gettext("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?"),Title:gettext("Title"),Tools:gettext("Tools"),Top:gettext("Top"),Underline:gettext("Underline"),Undo:gettext("Undo"),"Upper Alpha":gettext("Upper Alpha"),"Upper Roman":gettext("Upper Roman"),Url:gettext("Url"),"V Align":gettext("V Align"),"Vertical space":gettext("Vertical space"),View:gettext("View"),"Visual aids":gettext("Visual aids"),"Whole words":gettext("Whole words"),Width:gettext("Width"),"Words: {0}":gettext("Words: {0}"),"You have unsaved changes are you sure you want to navigate away?":gettext("You have unsaved changes are you sure you want to navigate away?"),"Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.":gettext("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.")}))}var CUSTOM_FONTS,STANDARD_FONTS,_getFonts;return CUSTOM_FONTS="Default='Open Sans', Verdana, Arial, Helvetica, sans-serif;",STANDARD_FONTS="Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats",_getFonts=function(){return CUSTOM_FONTS+STANDARD_FONTS},HTMLEditingDescriptor.prototype.setupTinyMCE=function(ed){return ed.addButton("wrapAsCode",{title:"Code block",image:""+baseUrl+"/images/ico-tinymce-code.png",onclick:function(){return ed.formatter.toggle("code")}}),this.visualEditor=ed,ed.on("SaveImage",this.saveImage),ed.on("EditImage",this.editImage),ed.on("SaveLink",this.saveLink),ed.on("EditLink",this.editLink),ed.on("ShowCodeEditor",this.showCodeEditor),ed.on("SaveCodeEditor",this.saveCodeEditor)},HTMLEditingDescriptor.prototype.editImage=function(data){return data.src?data.src=rewriteStaticLinks(data.src,this.base_asset_url,"/static/"):void 0},HTMLEditingDescriptor.prototype.saveImage=function(data){return data.src?data.src=rewriteStaticLinks(data.src,"/static/",this.base_asset_url):void 0},HTMLEditingDescriptor.prototype.editLink=function(data){return data.href?data.href=rewriteStaticLinks(data.href,this.base_asset_url,"/static/"):void 0},HTMLEditingDescriptor.prototype.saveLink=function(data){return data.href?data.href=rewriteStaticLinks(data.href,"/static/",this.base_asset_url):void 0},HTMLEditingDescriptor.prototype.showCodeEditor=function(source){var content;return content=rewriteStaticLinks(source.content,this.base_asset_url,"/static/"),source.content=content},HTMLEditingDescriptor.prototype.saveCodeEditor=function(source){var content;return content=rewriteStaticLinks(source.content,"/static/",this.base_asset_url),source.content=content},HTMLEditingDescriptor.prototype.initInstanceCallback=function(visualEditor){return visualEditor.setContent(rewriteStaticLinks(visualEditor.getContent({no_events:1}),"/static/",this.base_asset_url)),this.starting_content=visualEditor.getContent({format:"raw",no_events:1}),visualEditor.focus()},HTMLEditingDescriptor.prototype.getVisualEditor=function(){return this.visualEditor},HTMLEditingDescriptor.prototype.save=function(){var raw_content,text,visualEditor;return text=void 0,"visual"===this.editor_choice&&(visualEditor=this.getVisualEditor(),raw_content=visualEditor.getContent({format:"raw",no_events:1}),this.starting_content!==raw_content&&(text=rewriteStaticLinks(visualEditor.getContent({no_events:1}),this.base_asset_url,"/static/"))),void 0===text&&(text=this.advanced_editor.getValue()),{data:text}},HTMLEditingDescriptor}()}.call(this);