(function(){var CourseInfo,PendingInstructorTasks;PendingInstructorTasks=function(){return window.InstructorDashboard.util.PendingInstructorTasks},CourseInfo=function(){function CourseInfo($section){var _this=this;this.$section=$section,this.$section.data("wrapper",this),this.instructor_tasks=new(PendingInstructorTasks())(this.$section),this.$course_errors_wrapper=this.$section.find(".course-errors-wrapper"),this.$course_errors_wrapper.length&&(this.$course_error_toggle=this.$course_errors_wrapper.find(".toggle-wrapper"),this.$course_error_toggle_text=this.$course_error_toggle.find("h2"),this.$course_error_visibility_wrapper=this.$course_errors_wrapper.find(".course-errors-visibility-wrapper"),this.$course_errors=this.$course_errors_wrapper.find(".course-error"),this.$course_error_toggle_text.text(this.$course_error_toggle_text.text()+(" ("+this.$course_errors.length+")")),this.$course_error_toggle.click(function(e){return e.preventDefault(),_this.$course_errors_wrapper.hasClass("open")?_this.$course_errors_wrapper.removeClass("open"):_this.$course_errors_wrapper.addClass("open")}))}return CourseInfo.prototype.onClickTitle=function(){return this.instructor_tasks.task_poller.start()},CourseInfo.prototype.onExit=function(){return this.instructor_tasks.task_poller.stop()},CourseInfo}(),_.defaults(window,{InstructorDashboard:{}}),_.defaults(window.InstructorDashboard,{sections:{}}),_.defaults(window.InstructorDashboard.sections,{CourseInfo:CourseInfo})}).call(this),function(){var DataDownload,PendingInstructorTasks,ReportDownloads,std_ajax_err;std_ajax_err=function(){return window.InstructorDashboard.util.std_ajax_err.apply(this,arguments)},PendingInstructorTasks=function(){return window.InstructorDashboard.util.PendingInstructorTasks},DataDownload=function(){function DataDownload($section){var _this=this;this.$section=$section,this.$section.data("wrapper",this),this.$list_studs_btn=this.$section.find("input[name='list-profiles']'"),this.$list_studs_csv_btn=this.$section.find("input[name='list-profiles-csv']'"),this.$list_anon_btn=this.$section.find("input[name='list-anon-ids']'"),this.$grade_config_btn=this.$section.find("input[name='dump-gradeconf']'"),this.$calculate_grades_csv_btn=this.$section.find("input[name='calculate-grades-csv']'"),this.$download=this.$section.find(".data-download-container"),this.$download_display_text=this.$download.find(".data-display-text"),this.$download_request_response_error=this.$download.find(".request-response-error"),this.$reports=this.$section.find(".reports-download-container"),this.$download_display_table=this.$reports.find(".data-display-table"),this.$reports_request_response=this.$reports.find(".request-response"),this.$reports_request_response_error=this.$reports.find(".request-response-error"),this.report_downloads=new ReportDownloads(this.$section),this.instructor_tasks=new(PendingInstructorTasks())(this.$section),this.clear_display(),this.$list_anon_btn.click(function(){var url;return url=_this.$list_anon_btn.data("endpoint"),location.href=url}),this.$list_studs_csv_btn.click(function(){var url;return _this.clear_display(),url=_this.$list_studs_csv_btn.data("endpoint"),url+="/csv",$.ajax({dataType:"json",url:url,error:function(){return _this.$reports_request_response_error.text(gettext("Error generating student profile information. Please try again.")),$(".msg-error").css({display:"block"})},success:function(data){return _this.$reports_request_response.text(data.status),$(".msg-confirm").css({display:"block"})}})}),this.$list_studs_btn.click(function(){var url;return url=_this.$list_studs_btn.data("endpoint"),_this.clear_display(),_this.$download_display_table.text(gettext("Loading")),$.ajax({dataType:"json",url:url,error:function(){return _this.clear_display(),_this.$download_request_response_error.text(gettext("Error getting student list."))},success:function(data){var $table_placeholder,columns,feature,grid,grid_data,options;return _this.clear_display(),options={enableCellNavigation:!0,enableColumnReorder:!1,forceFitColumns:!0,rowHeight:35},columns=function(){var _i,_len,_ref,_results;for(_ref=data.queried_features,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)feature=_ref[_i],_results.push({id:feature,field:feature,name:data.feature_names[feature]});return _results}(),grid_data=data.students,$table_placeholder=$("<div/>",{"class":"slickgrid"}),_this.$download_display_table.append($table_placeholder),grid=new Slick.Grid($table_placeholder,grid_data,columns,options)}})}),this.$grade_config_btn.click(function(){var url;return url=_this.$grade_config_btn.data("endpoint"),$.ajax({dataType:"json",url:url,error:function(){return _this.clear_display(),_this.$download_request_response_error.text(gettext("Error retrieving grading configuration."))},success:function(data){return _this.clear_display(),_this.$download_display_text.html(data.grading_config_summary)}})}),this.$calculate_grades_csv_btn.click(function(){var url;return _this.clear_display(),url=_this.$calculate_grades_csv_btn.data("endpoint"),$.ajax({dataType:"json",url:url,error:function(){return _this.$reports_request_response_error.text(gettext("Error generating grades. Please try again.")),$(".msg-error").css({display:"block"})},success:function(data){return _this.$reports_request_response.text(data.status),$(".msg-confirm").css({display:"block"})}})})}return DataDownload.prototype.onClickTitle=function(){return this.clear_display(),this.instructor_tasks.task_poller.start(),this.report_downloads.downloads_poller.start()},DataDownload.prototype.onExit=function(){return this.instructor_tasks.task_poller.stop(),this.report_downloads.downloads_poller.stop()},DataDownload.prototype.clear_display=function(){return this.$download_display_text.empty(),this.$download_display_table.empty(),this.$download_request_response_error.empty(),this.$reports_request_response.empty(),this.$reports_request_response_error.empty(),$(".msg-confirm").css({display:"none"}),$(".msg-error").css({display:"none"})},DataDownload}(),ReportDownloads=function(){function ReportDownloads($section){var POLL_INTERVAL,_this=this;this.$section=$section,this.$report_downloads_table=this.$section.find(".report-downloads-table"),POLL_INTERVAL=2e4,this.downloads_poller=new window.InstructorDashboard.util.IntervalManager(POLL_INTERVAL,function(){return _this.reload_report_downloads()})}return ReportDownloads.prototype.reload_report_downloads=function(){var endpoint,_this=this;return endpoint=this.$report_downloads_table.data("endpoint"),$.ajax({dataType:"json",url:endpoint,success:function(data){return data.downloads.length?_this.create_report_downloads_table(data.downloads):console.log("No reports ready for download")},error:function(){return console.error("Error finding report downloads")}})},ReportDownloads.prototype.create_report_downloads_table=function(report_downloads_data){var $table_placeholder,columns,grid,options;return this.$report_downloads_table.empty(),options={enableCellNavigation:!0,enableColumnReorder:!1,rowHeight:30,forceFitColumns:!0},columns=[{id:"link",field:"link",name:gettext("File Name"),toolTip:gettext("Links are generated on demand and expire within 5 minutes due to the sensitive nature of student information."),sortable:!1,minWidth:150,cssClass:"file-download-link",formatter:function(row,cell,value,columnDef,dataContext){return'<a href="'+dataContext.url+'">'+dataContext.name+"</a>"}}],$table_placeholder=$("<div/>",{"class":"slickgrid"}),this.$report_downloads_table.append($table_placeholder),grid=new Slick.Grid($table_placeholder,report_downloads_data,columns,options),grid.autosizeColumns()},ReportDownloads}(),_.defaults(window,{InstructorDashboard:{}}),_.defaults(window.InstructorDashboard,{sections:{}}),_.defaults(window.InstructorDashboard.sections,{DataDownload:DataDownload})}.call(this),function(){var ECommerce;ECommerce=function(){function ECommerce($section){var _this=this;this.$section=$section,this.$section.data("wrapper",this),this.$list_sale_csv_btn=this.$section.find("input[name='list-sale-csv']'"),this.$list_order_sale_csv_btn=this.$section.find("input[name='list-order-sale-csv']'"),this.$download_company_name=this.$section.find("input[name='download_company_name']'"),this.$active_company_name=this.$section.find("input[name='active_company_name']'"),this.$spent_company_name=this.$section.find('input[name="spent_company_name"]'),this.$download_coupon_codes=this.$section.find('input[name="download-coupon-codes-csv"]'),this.$download_registration_codes_form=this.$section.find("form#download_registration_codes"),this.$active_registration_codes_form=this.$section.find("form#active_registration_codes"),this.$spent_registration_codes_form=this.$section.find("form#spent_registration_codes"),this.$error_msg=this.$section.find("#error-msg"),this.$list_sale_csv_btn.click(function(){var url;return url=_this.$list_sale_csv_btn.data("endpoint"),url+="/csv",location.href=url}),this.$list_order_sale_csv_btn.click(function(){var url;return url=_this.$list_order_sale_csv_btn.data("endpoint"),location.href=url}),this.$download_coupon_codes.click(function(){var url;return url=_this.$download_coupon_codes.data("endpoint"),location.href=url}),this.$download_registration_codes_form.submit(function(){return _this.$error_msg.attr("style","display: none"),!0}),this.$active_registration_codes_form.submit(function(){return _this.$error_msg.attr("style","display: none"),!0}),this.$spent_registration_codes_form.submit(function(){return _this.$error_msg.attr("style","display: none"),!0})}var isInt;return ECommerce.prototype.onClickTitle=function(){return this.clear_display()},ECommerce.prototype.onClickTitle=function(){return this.clear_display()},ECommerce.prototype.onExit=function(){return this.clear_display()},ECommerce.prototype.clear_display=function(){return this.$error_msg.attr("style","display: none"),this.$download_company_name.val(""),this.$active_company_name.val(""),this.$spent_company_name.val("")},isInt=function(n){return n%1===0},ECommerce}(),_.defaults(window,{InstructorDashboard:{}}),_.defaults(window.InstructorDashboard,{sections:{}}),_.defaults(window.InstructorDashboard.sections,{ECommerce:ECommerce})}.call(this),function(){var Extensions,plantTimeout,std_ajax_err;plantTimeout=function(){return window.InstructorDashboard.util.plantTimeout.apply(this,arguments)},std_ajax_err=function(){return window.InstructorDashboard.util.std_ajax_err.apply(this,arguments)},Extensions=function(){function Extensions($section){var $grid_display,_this=this;this.$section=$section,this.$section.data("wrapper",this),this.$change_due_date=this.$section.find("input[name='change-due-date']"),this.$reset_due_date=this.$section.find("input[name='reset-due-date']"),this.$show_unit_extensions=this.$section.find("input[name='show-unit-extensions']"),this.$show_student_extensions=this.$section.find("input[name='show-student-extensions']"),this.$section.find(".request-response").hide(),this.$section.find(".request-response-error").hide(),$grid_display=this.$section.find(".data-display"),this.$grid_text=$grid_display.find(".data-display-text"),this.$grid_table=$grid_display.find(".data-display-table"),this.$change_due_date.click(function(){var send_data;return _this.clear_display(),_this.$student_input=_this.$section.find("#set-extension input[name='student']"),_this.$url_input=_this.$section.find("#set-extension select[name='url']"),_this.$due_datetime_input=_this.$section.find("#set-extension input[name='due_datetime']"),send_data={student:_this.$student_input.val(),url:_this.$url_input.val(),due_datetime:_this.$due_datetime_input.val()},$.ajax({dataType:"json",url:_this.$change_due_date.data("endpoint"),data:send_data,success:function(data){return _this.display_response("set-extension",data)},error:function(xhr){return _this.fail_with_error("set-extension","Error changing due date",xhr)}})}),this.$reset_due_date.click(function(){var send_data;return _this.clear_display(),_this.$student_input=_this.$section.find("#reset-extension input[name='student']"),_this.$url_input=_this.$section.find("#reset-extension select[name='url']"),send_data={student:_this.$student_input.val(),url:_this.$url_input.val()},$.ajax({dataType:"json",url:_this.$reset_due_date.data("endpoint"),data:send_data,success:function(data){return _this.display_response("reset-extension",data)},error:function(xhr){return _this.fail_with_error("reset-extension","Error reseting due date",xhr)}})}),this.$show_unit_extensions.click(function(){var send_data,url;return _this.clear_display(),_this.$grid_table.text("Loading"),_this.$url_input=_this.$section.find("#view-granted-extensions select[name='url']"),url=_this.$show_unit_extensions.data("endpoint"),send_data={url:_this.$url_input.val()},$.ajax({dataType:"json",url:url,data:send_data,error:function(xhr){return _this.fail_with_error("view-granted-extensions","Error getting due dates",xhr)},success:function(data){return _this.display_grid(data)}})}),this.$show_student_extensions.click(function(){var send_data,url;return _this.clear_display(),_this.$grid_table.text("Loading"),url=_this.$show_student_extensions.data("endpoint"),_this.$student_input=_this.$section.find("#view-granted-extensions input[name='student']"),send_data={student:_this.$student_input.val()},$.ajax({dataType:"json",url:url,data:send_data,error:function(xhr){return _this.fail_with_error("view-granted-extensions","Error getting due dates",xhr)},success:function(data){return _this.display_grid(data)}})})}return Extensions.prototype.onClickTitle=function(){},Extensions.prototype.fail_with_error=function(id,msg,xhr){var $task_error,$task_response,data;return $task_error=this.$section.find("#"+id+" .request-response-error"),$task_response=this.$section.find("#"+id+" .request-response"),this.clear_display(),data=$.parseJSON(xhr.responseText),msg+=": "+data.error,console.warn(msg),$task_response.empty(),$task_error.empty(),$task_error.text(msg),$task_error.show()},Extensions.prototype.display_response=function(id,data){var $task_error,$task_response;return $task_error=this.$section.find("#"+id+" .request-response-error"),$task_response=this.$section.find("#"+id+" .request-response"),$task_error.empty().hide(),$task_response.empty().text(data),$task_response.show()},Extensions.prototype.display_grid=function(data){var $table_placeholder,col,columns,grid,grid_data,options;return this.clear_display(),this.$grid_text.text(data.title),options={enableCellNavigation:!0,enableColumnReorder:!1,forceFitColumns:!0},columns=function(){var _i,_len,_ref,_results;for(_ref=data.header,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)col=_ref[_i],_results.push({id:col,field:col,name:col});return _results}(),grid_data=data.data,$table_placeholder=$("<div/>",{"class":"slickgrid",style:"min-height: 400px"}),this.$grid_table.append($table_placeholder),grid=new Slick.Grid($table_placeholder,grid_data,columns,options)},Extensions.prototype.clear_display=function(){return this.$grid_text.empty(),this.$grid_table.empty(),this.$section.find(".request-response-error").empty().hide(),this.$section.find(".request-response").empty().hide()},Extensions}(),"undefined"!=typeof _&&null!==_&&(_.defaults(window,{InstructorDashboard:{}}),_.defaults(window.InstructorDashboard,{sections:{}}),_.defaults(window.InstructorDashboard.sections,{Extensions:Extensions}))}.call(this),function(){var GradeDistributionDisplay,InstructorAnalytics,ProfileDistributionWidget,plantTimeout,std_ajax_err;plantTimeout=function(){return window.InstructorDashboard.util.plantTimeout.apply(this,arguments)},std_ajax_err=function(){return window.InstructorDashboard.util.std_ajax_err.apply(this,arguments)},ProfileDistributionWidget=function(){function ProfileDistributionWidget(_arg){var template_html,template_params;this.$container=_arg.$container,this.feature=_arg.feature,this.title=_arg.title,this.endpoint=_arg.endpoint,template_params={title:this.title,feature:this.feature,endpoint:this.endpoint},template_html=$("#profile-distribution-widget-template").text(),this.$container.html(Mustache.render(template_html,template_params))}return ProfileDistributionWidget.prototype.reset_display=function(){return this.$container.find(".display-errors").empty(),this.$container.find(".display-text").empty(),this.$container.find(".display-graph").empty(),this.$container.find(".display-table").empty()},ProfileDistributionWidget.prototype.show_error=function(msg){return this.$container.find(".display-errors").text(msg)},ProfileDistributionWidget.prototype.load=function(){var _this=this;return this.reset_display(),this.get_profile_distributions(this.feature,{error:std_ajax_err(function(){}),success:function(data){var columns,feature_res,graph_data,graph_placeholder,grid,grid_data,options,table_placeholder;return feature_res=data.feature_results,"EASY_CHOICE"===feature_res.type?(options={enableCellNavigation:!0,enableColumnReorder:!1,forceFitColumns:!0},columns=[{id:_this.feature,field:_this.feature,name:data.feature_display_names[_this.feature]},{id:"count",field:"count",name:"Count"}],grid_data=_.map(feature_res.data,function(value,key){var datapoint;return datapoint={},datapoint[_this.feature]=feature_res.choices_display_names[key],datapoint.count=value,datapoint}),table_placeholder=$("<div/>",{"class":"slickgrid"}),_this.$container.find(".display-table").append(table_placeholder),grid=new Slick.Grid(table_placeholder,grid_data,columns,options)):"year_of_birth"===feature_res.feature?(graph_placeholder=$("<div/>",{"class":"graph-placeholder"}),_this.$container.find(".display-graph").append(graph_placeholder),graph_data=_.map(feature_res.data,function(value,key){return[parseInt(key),value]}),$.plot(graph_placeholder,[{data:graph_data}])):(console.warn("unable to show distribution "+feature_res.type),_this.show_error(gettext("Unavailable metric display.")))}})},ProfileDistributionWidget.prototype.get_profile_distributions=function(feature,handler){var settings;return settings={dataType:"json",url:this.endpoint,data:{feature:feature}},"function"==typeof handler?_.extend(settings,{success:handler}):_.extend(settings,handler),$.ajax(settings)},ProfileDistributionWidget}(),GradeDistributionDisplay=function(){function GradeDistributionDisplay(_arg){var template_html,template_params;this.$container=_arg.$container,this.endpoint=_arg.endpoint,template_params={},template_html=$("#grade-distributions-widget-template").text(),this.$container.html(Mustache.render(template_html,template_params)),this.$problem_selector=this.$container.find(".problem-selector")}return GradeDistributionDisplay.prototype.reset_display=function(){return this.$container.find(".display-errors").empty(),this.$container.find(".display-text").empty(),this.$container.find(".display-graph").empty()},GradeDistributionDisplay.prototype.show_error=function(msg){return this.$container.find(".display-errors").text(msg)},GradeDistributionDisplay.prototype.load=function(){var _this=this;return this.get_grade_distributions({error:std_ajax_err(function(){return _this.show_error(gettext("Error fetching grade distributions."))}),success:function(data){var block_id,full_time_updated,grade_info,label,module_id,time_updated,_i,_len,_ref,_ref1;for(time_updated=gettext("Last Updated: <%= timestamp %>"),full_time_updated=_.template(time_updated,{timestamp:data.time}),_this.$container.find(".last-updated").text(full_time_updated),_this.$problem_selector.empty(),_ref=data.data,_i=0,_len=_ref.length;_len>_i;_i++)_ref1=_ref[_i],module_id=_ref1.module_id,block_id=_ref1.block_id,grade_info=_ref1.grade_info,label=block_id,null==label&&(label=module_id),_this.$problem_selector.append($("<option/>",{text:label,data:{module_id:module_id,grade_info:grade_info}}));return _this.$problem_selector.change(function(){var $opt;return $opt=_this.$problem_selector.children("option:selected"),$opt.length>0?(_this.reset_display(),_this.render_distribution({module_id:$opt.data("module_id"),grade_info:$opt.data("grade_info")})):void 0}),_this.$problem_selector.change()}})},GradeDistributionDisplay.prototype.render_distribution=function(_arg){var $display_graph,full_msg,grade_info,graph_data,graph_placeholder,module_id,msg,total_students;return module_id=_arg.module_id,grade_info=_arg.grade_info,$display_graph=this.$container.find(".display-graph"),graph_data=grade_info.map(function(_arg1){var grade,max_grade,num_students;return grade=_arg1.grade,max_grade=_arg1.max_grade,num_students=_arg1.num_students,[grade,num_students]}),total_students=_.reduce([0].concat(grade_info),function(accum,_arg1){var grade,max_grade,num_students;return grade=_arg1.grade,max_grade=_arg1.max_grade,num_students=_arg1.num_students,accum+num_students}),msg=gettext("<%= num_students %> students scored."),full_msg=_.template(msg,{num_students:total_students}),this.$container.find(".display-text").text(full_msg),graph_placeholder=$("<div/>",{"class":"graph-placeholder"}),$display_graph.append(graph_placeholder),graph_data=graph_data,$.plot(graph_placeholder,[{data:graph_data,bars:{show:!0},color:"#1d9dd9"}])},GradeDistributionDisplay.prototype.get_grade_distributions=function(handler){var settings;return settings={dataType:"json",url:this.endpoint,data:{aname:"ProblemGradeDistribution"}},"function"==typeof handler?_.extend(settings,{success:handler}):_.extend(settings,handler),$.ajax(settings)},GradeDistributionDisplay}(),InstructorAnalytics=function(){function InstructorAnalytics($section){this.$section=$section,this.$section.data("wrapper",this),this.$pd_containers=this.$section.find(".profile-distribution-widget-container"),this.$gd_containers=this.$section.find(".grade-distributions-widget-container"),this.pdws=_.map(this.$pd_containers,function(container){return new ProfileDistributionWidget({$container:$(container),feature:$(container).data("feature"),title:$(container).data("title"),endpoint:$(container).data("endpoint")})}),this.gdws=_.map(this.$gd_containers,function(container){return new GradeDistributionDisplay({$container:$(container),endpoint:$(container).data("endpoint")})})}return InstructorAnalytics.prototype.refresh=function(){var gdw,pdw,_i,_j,_len,_len1,_ref,_ref1,_results;for(_ref=this.pdws,_i=0,_len=_ref.length;_len>_i;_i++)pdw=_ref[_i],pdw.load();for(_ref1=this.gdws,_results=[],_j=0,_len1=_ref1.length;_len1>_j;_j++)gdw=_ref1[_j],_results.push(gdw.load());return _results},InstructorAnalytics.prototype.onClickTitle=function(){return this.refresh()},InstructorAnalytics}(),_.defaults(window,{InstructorDashboard:{}}),_.defaults(window.InstructorDashboard,{sections:{}}),_.defaults(window.InstructorDashboard.sections,{InstructorAnalytics:InstructorAnalytics})}.call(this),function(){var $active_section,CSS_ACTIVE_SECTION,CSS_IDASH_SECTION,CSS_INSTRUCTOR_CONTENT,CSS_INSTRUCTOR_NAV,HASH_LINK_PREFIX,SafeWaiter,plantTimeout,sections_have_loaded,setup_instructor_dashboard,setup_instructor_dashboard_sections,std_ajax_err;plantTimeout=function(){return window.InstructorDashboard.util.plantTimeout.apply(this,arguments)},std_ajax_err=function(){return window.InstructorDashboard.util.std_ajax_err.apply(this,arguments)},CSS_INSTRUCTOR_CONTENT="instructor-dashboard-content-2",CSS_ACTIVE_SECTION="active-section",CSS_IDASH_SECTION="idash-section",CSS_INSTRUCTOR_NAV="instructor-nav",HASH_LINK_PREFIX="#view-",$active_section=null,SafeWaiter=function(){function SafeWaiter(){this.after_handlers=[],this.waitFor_handlers=[],this.fired=!1}return SafeWaiter.prototype.after=function(f){return this.fired?f():this.after_handlers.push(f)},SafeWaiter.prototype.waitFor=function(f){var _this=this;if(!this.fired)return this.waitFor_handlers.push(f),function(){return _this.waitFor_handlers=_this.waitFor_handlers.filter(function(g){return g!==f}),0===_this.waitFor_handlers.length&&(_this.fired=!0,_this.after_handlers.map(function(cb){return plantTimeout(0,cb)})),f.apply(_this,arguments)}},SafeWaiter}(),sections_have_loaded=new SafeWaiter,$(function(){var instructor_dashboard_content;return instructor_dashboard_content=$("."+CSS_INSTRUCTOR_CONTENT),instructor_dashboard_content.length>0?(setup_instructor_dashboard(instructor_dashboard_content),setup_instructor_dashboard_sections(instructor_dashboard_content)):void 0}),setup_instructor_dashboard=function(idash_content){var $links,click_first_link,link,rmatch,section_name;return $links=idash_content.find("."+CSS_INSTRUCTOR_NAV).find("a"),$links.each(function(i,link){return $(link).click(function(e){var $section,section_name,_ref;return e.preventDefault(),idash_content.find("."+CSS_INSTRUCTOR_NAV+" li").children().removeClass(CSS_ACTIVE_SECTION),idash_content.find("."+CSS_IDASH_SECTION).removeClass(CSS_ACTIVE_SECTION),section_name=$(this).data("section"),$section=idash_content.find("#"+section_name),$(this).addClass(CSS_ACTIVE_SECTION),$section.addClass(CSS_ACTIVE_SECTION),analytics.pageview("instructor_section:"+section_name),location.hash=""+HASH_LINK_PREFIX+section_name,sections_have_loaded.after(function(){return $section.data("wrapper").onClickTitle()}),$section.is($active_section)||null!=$active_section&&null!=(_ref=$active_section.data("wrapper"))&&"function"==typeof _ref.onExit&&_ref.onExit(),$active_section=$section})}),click_first_link=function(){var link;return link=$links.eq(0),link.click()},new RegExp("^"+HASH_LINK_PREFIX).test(location.hash)?(rmatch=new RegExp("^"+HASH_LINK_PREFIX+"(.*)").exec(location.hash),section_name=rmatch[1],link=$links.filter("[data-section='"+section_name+"']"),1===link.length?link.click():click_first_link()):click_first_link()},setup_instructor_dashboard_sections=function(idash_content){var sections_to_initialize;return sections_to_initialize=[{constructor:window.InstructorDashboard.sections.CourseInfo,$element:idash_content.find("."+CSS_IDASH_SECTION+"#course_info")},{constructor:window.InstructorDashboard.sections.DataDownload,$element:idash_content.find("."+CSS_IDASH_SECTION+"#data_download")},{constructor:window.InstructorDashboard.sections.ECommerce,$element:idash_content.find("."+CSS_IDASH_SECTION+"#e-commerce")},{constructor:window.InstructorDashboard.sections.Membership,$element:idash_content.find("."+CSS_IDASH_SECTION+"#membership")},{constructor:window.InstructorDashboard.sections.StudentAdmin,$element:idash_content.find("."+CSS_IDASH_SECTION+"#student_admin")},{constructor:window.InstructorDashboard.sections.Extensions,$element:idash_content.find("."+CSS_IDASH_SECTION+"#extensions")},{constructor:window.InstructorDashboard.sections.Email,$element:idash_content.find("."+CSS_IDASH_SECTION+"#send_email")},{constructor:window.InstructorDashboard.sections.InstructorAnalytics,$element:idash_content.find("."+CSS_IDASH_SECTION+"#instructor_analytics")},{constructor:window.InstructorDashboard.sections.Metrics,$element:idash_content.find("."+CSS_IDASH_SECTION+"#metrics")}],sections_to_initialize.map(function(_arg){var $element,constructor;return constructor=_arg.constructor,$element=_arg.$element,plantTimeout(0,sections_have_loaded.waitFor(function(){return new constructor($element)}))})}}.call(this),function(){var AuthList,AuthListWidget,BatchEnrollment,BetaTesterBulkAddition,MemberListWidget,Membership,emailStudents,plantTimeout,std_ajax_err,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};plantTimeout=function(){return window.InstructorDashboard.util.plantTimeout.apply(this,arguments)},std_ajax_err=function(){return window.InstructorDashboard.util.std_ajax_err.apply(this,arguments)},emailStudents=!1,MemberListWidget=function(){function MemberListWidget($container,params){var template_html,_this=this;this.$container=$container,null==params&&(params={}),params=_.defaults(params,{title:"Member List",info:"Use this list to manage members.",labels:["field1","field2","field3"],add_placeholder:"Enter name",add_btn_label:"Add Member",add_handler:function(){}}),template_html=$("#member-list-widget-template").html(),this.$container.html(Mustache.render(template_html,params)),this.$('input[type="button"].add').click(function(){return"function"==typeof params.add_handler?params.add_handler(_this.$(".add-field").val()):void 0})}return MemberListWidget.prototype.clear_input=function(){return this.$(".add-field").val("")},MemberListWidget.prototype.clear_rows=function(){return this.$("table tbody").empty()},MemberListWidget.prototype.add_row=function(row_array){var $tbody,$td,$tr,item,_i,_len;for($tbody=this.$("table tbody"),$tr=$("<tr>"),_i=0,_len=row_array.length;_len>_i;_i++)item=row_array[_i],$td=$("<td>"),item instanceof jQuery?$td.append(item):$td.text(item),$tr.append($td);return $tbody.append($tr)},MemberListWidget.prototype.$=function(selector){var s;return null!=this.debug?(s=this.$container.find(selector),1!==(null!=s?s.length:void 0)&&console.warn("local selector '"+selector+"' found ("+s.length+") results"),s):this.$container.find(selector)},MemberListWidget}(),AuthListWidget=function(_super){function AuthListWidget($container,rolename,$error_section){var _this=this;if(this.rolename=rolename,this.$error_section=$error_section,AuthListWidget.__super__.constructor.call(this,$container,{title:$container.data("display-name"),info:$container.data("info-text"),labels:[gettext("Username"),gettext("Email"),gettext("Revoke access")],add_placeholder:gettext("Enter username or email"),add_btn_label:$container.data("add-button-label"),add_handler:function(input){return _this.add_handler(input)}}),this.debug=!0,this.list_endpoint=$container.data("list-endpoint"),this.modify_endpoint=$container.data("modify-endpoint"),null==this.rolename)throw"AuthListWidget missing @rolename";this.reload_list()}return __extends(AuthListWidget,_super),AuthListWidget.prototype.re_view=function(){return this.clear_errors(),this.clear_input(),this.reload_list()},AuthListWidget.prototype.add_handler=function(input){var _this=this;return null!=input&&""!==input?this.modify_member_access(input,"allow",function(error){return null!==error?_this.show_errors(error):(_this.clear_errors(),_this.clear_input(),_this.reload_list())}):this.show_errors(gettext("Please enter a username or email."))},AuthListWidget.prototype.reload_list=function(){var _this=this;return this.get_member_list(function(error,member_list){return null!==error?_this.show_errors(error):(_this.clear_rows(),_.each(member_list,function(member){var $revoke_btn,label_trans;return label_trans=gettext("Revoke access"),$revoke_btn=$(_.template('<div class="revoke"><i class="icon fa fa-times-circle"></i> <%= label %></div>',{label:label_trans}),{"class":"revoke"}),$revoke_btn.click(function(){return _this.modify_member_access(member.email,"revoke",function(error){return null!==error?_this.show_errors(error):(_this.clear_errors(),_this.reload_list())})}),_this.add_row([member.username,member.email,$revoke_btn])}))})},AuthListWidget.prototype.clear_errors=function(){var _ref;return null!=(_ref=this.$error_section)?_ref.text(""):void 0},AuthListWidget.prototype.show_errors=function(msg){var _ref;return null!=(_ref=this.$error_section)?_ref.text(msg):void 0},AuthListWidget.prototype.get_member_list=function(cb){var _this=this;return $.ajax({dataType:"json",url:this.list_endpoint,data:{rolename:this.rolename},success:function(data){return"function"==typeof cb?cb(null,data[_this.rolename]):void 0},error:std_ajax_err(function(){})})},AuthListWidget.prototype.modify_member_access=function(unique_student_identifier,action,cb){var _this=this;return $.ajax({dataType:"json",url:this.modify_endpoint,data:{unique_student_identifier:unique_student_identifier,rolename:this.rolename,action:action},success:function(data){return _this.member_response(data)},error:std_ajax_err(function(){return"function"==typeof cb?cb(gettext("Error changing user's permissions.")):void 0})})},AuthListWidget.prototype.member_response=function(data){var msg;return this.clear_errors(),this.clear_input(),data.userDoesNotExist?(msg=gettext("Could not find a user with username or email address '<%= identifier %>'."),this.show_errors(_.template(msg,{identifier:data.unique_student_identifier}))):data.inactiveUser?(msg=gettext("Error: User '<%= username %>' has not yet activated their account. Users must create and activate their accounts before they can be assigned a role."),this.show_errors(_.template(msg,{username:data.unique_student_identifier}))):data.removingSelfAsInstructor?this.show_errors(gettext("Error: You cannot remove yourself from the Instructor group!")):this.reload_list()
},AuthListWidget}(MemberListWidget),this.AutoEnrollmentViaCsv=function(){function AutoEnrollmentViaCsv($container){var _this=this;this.$container=$container,this.$student_enrollment_form=this.$container.find("form#student-auto-enroll-form"),this.$enrollment_signup_button=this.$container.find("[name='enrollment_signup_button']"),this.$students_list_file=this.$container.find("input[name='students_list']"),this.$csrf_token=this.$container.find("input[name='csrfmiddlewaretoken']"),this.$results=this.$container.find("div.results"),this.$browse_button=this.$container.find("#browseBtn"),this.$browse_file=this.$container.find("#browseFile"),this.processing=!1,this.$browse_button.on("change",function(event){return 1===event.currentTarget.files.length?_this.$browse_file.val(event.currentTarget.value.substring(event.currentTarget.value.lastIndexOf("\\")+1)):void 0}),this.$enrollment_signup_button.click(function(){return _this.$student_enrollment_form.submit(function(event){var data;return _this.processing?!1:(_this.processing=!0,event.preventDefault(),data=new FormData(event.currentTarget),$.ajax({dataType:"json",type:"POST",url:event.currentTarget.action,data:data,processData:!1,contentType:!1,success:function(data){return _this.processing=!1,_this.display_response(data)}}),!1)})})}return AutoEnrollmentViaCsv.prototype.display_response=function(data_from_server){var error,errors,general_error,render_response,result_from_server_is_success,warning,warnings,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2,_this=this;if(this.$results.empty(),errors=[],warnings=[],result_from_server_is_success=!0,data_from_server.general_errors.length)for(result_from_server_is_success=!1,_ref=data_from_server.general_errors,_i=0,_len=_ref.length;_len>_i;_i++)general_error=_ref[_i],general_error.is_general_error=!0,errors.push(general_error);if(data_from_server.row_errors.length)for(result_from_server_is_success=!1,_ref1=data_from_server.row_errors,_j=0,_len1=_ref1.length;_len1>_j;_j++)error=_ref1[_j],error.is_general_error=!1,errors.push(error);if(data_from_server.warnings.length)for(result_from_server_is_success=!1,_ref2=data_from_server.warnings,_k=0,_len2=_ref2.length;_len2>_k;_k++)warning=_ref2[_k],warning.is_general_error=!1,warnings.push(warning);return render_response=function(title,message,type,student_results){var details,response_message,student_result,_l,_len3;for(details=[],_l=0,_len3=student_results.length;_len3>_l;_l++)student_result=student_results[_l],student_result.is_general_error?details.push(student_result.response):(response_message=student_result.username+"  ("+student_result.email+"):     ("+student_result.response+")",details.push(response_message));return _this.$results.append(_this.render_notification_view(type,title,message,details))},errors.length&&render_response(gettext("Errors"),gettext("The following errors were generated:"),"error",errors),warnings.length&&render_response(gettext("Warnings"),gettext("The following warnings were generated:"),"warning",warnings),result_from_server_is_success?render_response(gettext("Success"),gettext("All accounts were created successfully."),"confirmation",[]):void 0},AutoEnrollmentViaCsv.prototype.render_notification_view=function(type,title,message,details){var notification_model,view;return notification_model=new NotificationModel,notification_model.set({type:type,title:title,message:message,details:details}),view=new NotificationView({model:notification_model}),view.render(),view.$el.html()},AutoEnrollmentViaCsv}(),BetaTesterBulkAddition=function(){function BetaTesterBulkAddition($container){var _this=this;this.$container=$container,this.$identifier_input=this.$container.find("textarea[name='student-ids-for-beta']"),this.$btn_beta_testers=this.$container.find("input[name='beta-testers']"),this.$checkbox_autoenroll=this.$container.find("input[name='auto-enroll']"),this.$checkbox_emailstudents=this.$container.find("input[name='email-students-beta']"),this.$task_response=this.$container.find(".request-response"),this.$request_response_error=this.$container.find(".request-response-error"),this.$btn_beta_testers.click(function(event){var autoEnroll,send_data;return emailStudents=_this.$checkbox_emailstudents.is(":checked"),autoEnroll=_this.$checkbox_autoenroll.is(":checked"),send_data={action:$(event.target).data("action"),identifiers:_this.$identifier_input.val(),email_students:emailStudents,auto_enroll:autoEnroll},$.ajax({dataType:"json",type:"POST",url:_this.$btn_beta_testers.data("endpoint"),data:send_data,success:function(data){return _this.display_response(data)},error:std_ajax_err(function(){return _this.fail_with_error(gettext("Error adding/removing users as beta testers."))})})})}return BetaTesterBulkAddition.prototype.clear_input=function(){return this.$identifier_input.val(""),this.$checkbox_emailstudents.attr("checked",!0),this.$checkbox_autoenroll.attr("checked",!0)},BetaTesterBulkAddition.prototype.fail_with_error=function(msg){return console.warn(msg),this.clear_input(),this.$task_response.empty(),this.$request_response_error.empty(),this.$request_response_error.text(msg)},BetaTesterBulkAddition.prototype.display_response=function(data_from_server){var errors,no_users,render_list,sr,student_results,successes,_i,_len,_ref,_this=this;for(this.clear_input(),this.$task_response.empty(),this.$request_response_error.empty(),errors=[],successes=[],no_users=[],_ref=data_from_server.results,_i=0,_len=_ref.length;_len>_i;_i++)student_results=_ref[_i],student_results.userDoesNotExist?no_users.push(student_results):student_results.error?errors.push(student_results):successes.push(student_results);return render_list=function(label,ids){var identifier,ids_list,task_res_section,_j,_len1;for(task_res_section=$("<div/>",{"class":"request-res-section"}),task_res_section.append($("<h3/>",{text:label})),ids_list=$("<ul/>"),task_res_section.append(ids_list),_j=0,_len1=ids.length;_len1>_j;_j++)identifier=ids[_j],ids_list.append($("<li/>",{text:identifier}));return _this.$task_response.append(task_res_section)},successes.length&&"add"===data_from_server.action&&render_list(gettext("These users were successfully added as beta testers:"),function(){var _j,_len1,_results;for(_results=[],_j=0,_len1=successes.length;_len1>_j;_j++)sr=successes[_j],_results.push(sr.identifier);return _results}()),successes.length&&"remove"===data_from_server.action&&render_list(gettext("These users were successfully removed as beta testers:"),function(){var _j,_len1,_results;for(_results=[],_j=0,_len1=successes.length;_len1>_j;_j++)sr=successes[_j],_results.push(sr.identifier);return _results}()),errors.length&&"add"===data_from_server.action&&render_list(gettext("These users were not added as beta testers:"),function(){var _j,_len1,_results;for(_results=[],_j=0,_len1=errors.length;_len1>_j;_j++)sr=errors[_j],_results.push(sr.identifier);return _results}()),errors.length&&"remove"===data_from_server.action&&render_list(gettext("These users were not removed as beta testers:"),function(){var _j,_len1,_results;for(_results=[],_j=0,_len1=errors.length;_len1>_j;_j++)sr=errors[_j],_results.push(sr.identifier);return _results}()),no_users.length?(no_users.push($(gettext("Users must create and activate their account before they can be promoted to beta tester."))),render_list(gettext("Could not find users associated with the following identifiers:"),function(){var _j,_len1,_results;for(_results=[],_j=0,_len1=no_users.length;_len1>_j;_j++)sr=no_users[_j],_results.push(sr.identifier);return _results}())):void 0},BetaTesterBulkAddition}(),BatchEnrollment=function(){function BatchEnrollment($container){var _this=this;this.$container=$container,this.$identifier_input=this.$container.find("textarea[name='student-ids']"),this.$enrollment_button=this.$container.find(".enrollment-button"),this.$checkbox_autoenroll=this.$container.find("input[name='auto-enroll']"),this.$checkbox_emailstudents=this.$container.find("input[name='email-students']"),this.$task_response=this.$container.find(".request-response"),this.$request_response_error=this.$container.find(".request-response-error"),this.$enrollment_button.click(function(event){var send_data;return emailStudents=_this.$checkbox_emailstudents.is(":checked"),send_data={action:$(event.target).data("action"),identifiers:_this.$identifier_input.val(),auto_enroll:_this.$checkbox_autoenroll.is(":checked"),email_students:emailStudents},$.ajax({dataType:"json",type:"POST",url:$(event.target).data("endpoint"),data:send_data,success:function(data){return _this.display_response(data)},error:std_ajax_err(function(){return _this.fail_with_error(gettext("Error enrolling/unenrolling users."))})})})}return BatchEnrollment.prototype.clear_input=function(){return this.$identifier_input.val(""),this.$checkbox_emailstudents.attr("checked",!0),this.$checkbox_autoenroll.attr("checked",!0)},BatchEnrollment.prototype.fail_with_error=function(msg){return console.warn(msg),this.clear_input(),this.$task_response.empty(),this.$request_response_error.empty(),this.$request_response_error.text(msg)},BatchEnrollment.prototype.display_response=function(data_from_server){var allowed,autoenrolled,enrolled,errors,errors_label,invalid_identifier,notenrolled,notunenrolled,render_list,sr,student_results,_i,_j,_len,_len1,_ref,_this=this;for(this.clear_input(),this.$task_response.empty(),this.$request_response_error.empty(),invalid_identifier=[],errors=[],enrolled=[],allowed=[],autoenrolled=[],notenrolled=[],notunenrolled=[],_ref=data_from_server.results,_i=0,_len=_ref.length;_len>_i;_i++)student_results=_ref[_i],student_results.invalidIdentifier?invalid_identifier.push(student_results):student_results.error?errors.push(student_results):student_results.after.enrollment?enrolled.push(student_results):student_results.after.allowed?student_results.after.auto_enroll?autoenrolled.push(student_results):allowed.push(student_results):"unenroll"!==data_from_server.action||student_results.before.enrollment||student_results.before.allowed?student_results.after.enrollment?(console.warn("student results not reported to user"),console.warn(student_results)):notenrolled.push(student_results):notunenrolled.push(student_results);if(render_list=function(label,ids){var identifier,ids_list,task_res_section,_j,_len1;for(task_res_section=$("<div/>",{"class":"request-res-section"}),task_res_section.append($("<h3/>",{text:label})),ids_list=$("<ul/>"),task_res_section.append(ids_list),_j=0,_len1=ids.length;_len1>_j;_j++)identifier=ids[_j],ids_list.append($("<li/>",{text:identifier}));return _this.$task_response.append(task_res_section)},invalid_identifier.length&&render_list(gettext("The following email addresses and/or usernames are invalid:"),function(){var _j,_len1,_results;for(_results=[],_j=0,_len1=invalid_identifier.length;_len1>_j;_j++)sr=invalid_identifier[_j],_results.push(sr.identifier);return _results}()),errors.length)for(errors_label=function(){return"enroll"===data_from_server.action?"There was an error enrolling:":"unenroll"===data_from_server.action?"There was an error unenrolling:":(console.warn("unknown action from server '"+data_from_server.action+"'"),"There was an error processing:")}(),_j=0,_len1=errors.length;_len1>_j;_j++)student_results=errors[_j],render_list(errors_label,function(){var _k,_len2,_results;for(_results=[],_k=0,_len2=errors.length;_len2>_k;_k++)sr=errors[_k],_results.push(sr.identifier);return _results}());return enrolled.length&&emailStudents&&render_list(gettext("Successfully enrolled and sent email to the following users:"),function(){var _k,_len2,_results;for(_results=[],_k=0,_len2=enrolled.length;_len2>_k;_k++)sr=enrolled[_k],_results.push(sr.identifier);return _results}()),enrolled.length&&!emailStudents&&render_list(gettext("Successfully enrolled the following users:"),function(){var _k,_len2,_results;for(_results=[],_k=0,_len2=enrolled.length;_len2>_k;_k++)sr=enrolled[_k],_results.push(sr.identifier);return _results}()),allowed.length&&emailStudents&&render_list(gettext("Successfully sent enrollment emails to the following users. They will be allowed to enroll once they register:"),function(){var _k,_len2,_results;for(_results=[],_k=0,_len2=allowed.length;_len2>_k;_k++)sr=allowed[_k],_results.push(sr.identifier);return _results}()),allowed.length&&!emailStudents&&render_list(gettext("These users will be allowed to enroll once they register:"),function(){var _k,_len2,_results;for(_results=[],_k=0,_len2=allowed.length;_len2>_k;_k++)sr=allowed[_k],_results.push(sr.identifier);return _results}()),autoenrolled.length&&emailStudents&&render_list(gettext("Successfully sent enrollment emails to the following users. They will be enrolled once they register:"),function(){var _k,_len2,_results;for(_results=[],_k=0,_len2=autoenrolled.length;_len2>_k;_k++)sr=autoenrolled[_k],_results.push(sr.identifier);return _results}()),autoenrolled.length&&!emailStudents&&render_list(gettext("These users will be enrolled once they register:"),function(){var _k,_len2,_results;for(_results=[],_k=0,_len2=autoenrolled.length;_len2>_k;_k++)sr=autoenrolled[_k],_results.push(sr.identifier);return _results}()),notenrolled.length&&emailStudents&&render_list(gettext("Emails successfully sent. The following users are no longer enrolled in the course:"),function(){var _k,_len2,_results;for(_results=[],_k=0,_len2=notenrolled.length;_len2>_k;_k++)sr=notenrolled[_k],_results.push(sr.identifier);return _results}()),notenrolled.length&&!emailStudents&&render_list(gettext("The following users are no longer enrolled in the course:"),function(){var _k,_len2,_results;for(_results=[],_k=0,_len2=notenrolled.length;_len2>_k;_k++)sr=notenrolled[_k],_results.push(sr.identifier);return _results}()),notunenrolled.length?render_list(gettext("These users were not affiliated with the course so could not be unenrolled:"),function(){var _k,_len2,_results;for(_results=[],_k=0,_len2=notunenrolled.length;_len2>_k;_k++)sr=notunenrolled[_k],_results.push(sr.identifier);return _results}()):void 0},BatchEnrollment}(),AuthList=function(){function AuthList($container,rolename){var _this=this;this.$container=$container,this.rolename=rolename,this.$display_table=this.$container.find(".auth-list-table"),this.$request_response_error=this.$container.find(".request-response-error"),this.$add_section=this.$container.find(".auth-list-add"),this.$allow_field=this.$add_section.find("input[name='email']"),this.$allow_button=this.$add_section.find("input[name='allow']"),this.$allow_button.click(function(){return _this.access_change(_this.$allow_field.val(),"allow",function(){return _this.reload_auth_list()}),_this.$allow_field.val("")}),this.reload_auth_list()}return AuthList.prototype.reload_auth_list=function(){var load_auth_list,_this=this;return load_auth_list=function(data){var $table_placeholder,WHICH_CELL_IS_REVOKE,columns,grid,options,table_data;return _this.$request_response_error.empty(),_this.$display_table.empty(),options={enableCellNavigation:!0,enableColumnReorder:!1,forceFitColumns:!0},WHICH_CELL_IS_REVOKE=3,columns=[{id:"username",field:"username",name:"Username"},{id:"email",field:"email",name:"Email"},{id:"first_name",field:"first_name",name:"First Name"},{id:"revoke",field:"revoke",name:"Revoke",formatter:function(){return"<span class='revoke-link'>Revoke Access</span>"}}],table_data=data[_this.rolename],$table_placeholder=$("<div/>",{"class":"slickgrid"}),_this.$display_table.append($table_placeholder),grid=new Slick.Grid($table_placeholder,table_data,columns,options),grid.onClick.subscribe(function(e,args){var item;return item=args.grid.getDataItem(args.row),args.cell===WHICH_CELL_IS_REVOKE?_this.access_change(item.email,"revoke",function(){return _this.reload_auth_list()}):void 0})},$.ajax({dataType:"json",url:this.$display_table.data("endpoint"),data:{rolename:this.rolename},success:load_auth_list,error:std_ajax_err(function(){return _this.$request_response_error.text("Error fetching list for '"+_this.rolename+"'")})})},AuthList.prototype.refresh=function(){return this.$display_table.empty(),this.reload_auth_list()},AuthList.prototype.access_change=function(email,action,cb){var _this=this;return $.ajax({dataType:"json",url:this.$add_section.data("endpoint"),data:{email:email,rolename:this.rolename,action:action},success:function(data){return"function"==typeof cb?cb(data):void 0},error:std_ajax_err(function(){return _this.$request_response_error.text(gettext("Error changing user's permissions."))})})},AuthList}(),Membership=function(){function Membership($section){var auth_list,_i,_len,_ref,_this=this;for(this.$section=$section,this.$section.data("wrapper",this),plantTimeout(0,function(){return new BatchEnrollment(_this.$section.find(".batch-enrollment"))}),plantTimeout(0,function(){return new AutoEnrollmentViaCsv(_this.$section.find(".auto_enroll_csv"))}),plantTimeout(0,function(){return new BetaTesterBulkAddition(_this.$section.find(".batch-beta-testers"))}),this.$list_selector=this.$section.find("select#member-lists-selector"),this.$auth_list_containers=this.$section.find(".auth-list-container"),this.$auth_list_errors=this.$section.find(".member-lists-management .request-response-error"),this.auth_lists=_.map(this.$auth_list_containers,function(auth_list_container){var rolename;return rolename=$(auth_list_container).data("rolename"),new AuthListWidget($(auth_list_container),rolename,_this.$auth_list_errors)}),this.$list_selector.empty(),_ref=this.auth_lists,_i=0,_len=_ref.length;_len>_i;_i++)auth_list=_ref[_i],this.$list_selector.append($("<option/>",{text:auth_list.$container.data("display-name"),data:{auth_list:auth_list}}));0===this.auth_lists.length&&this.$list_selector.hide(),this.$list_selector.change(function(){var $opt,_j,_len1,_ref1;if($opt=_this.$list_selector.children("option:selected"),$opt.length>0){for(_ref1=_this.auth_lists,_j=0,_len1=_ref1.length;_len1>_j;_j++)auth_list=_ref1[_j],auth_list.$container.removeClass("active");return auth_list=$opt.data("auth_list"),auth_list.$container.addClass("active"),auth_list.re_view()}}),this.$list_selector.change()}return Membership.prototype.onClickTitle=function(){},Membership}(),_.defaults(window,{InstructorDashboard:{}}),_.defaults(window.InstructorDashboard,{sections:{}}),_.defaults(window.InstructorDashboard.sections,{Membership:Membership})}.call(this),function(){var Metrics,plantTimeout,std_ajax_err;plantTimeout=function(){return window.InstructorDashboard.util.plantTimeout.apply(this,arguments)},std_ajax_err=function(){return window.InstructorDashboard.util.std_ajax_err.apply(this,arguments)},Metrics=function(){function Metrics($section){this.$section=$section,this.$section.data("wrapper",this)}return Metrics.prototype.onClickTitle=function(){},Metrics}(),"undefined"!=typeof _&&null!==_&&(_.defaults(window,{InstructorDashboard:{}}),_.defaults(window.InstructorDashboard,{sections:{}}),_.defaults(window.InstructorDashboard.sections,{Metrics:Metrics}))}.call(this),function(){var Email,KeywordValidator,PendingInstructorTasks,SendEmail,create_email_content_table,create_email_message_views,create_task_list_table,plantTimeout,std_ajax_err;plantTimeout=function(){return window.InstructorDashboard.util.plantTimeout.apply(this,arguments)},std_ajax_err=function(){return window.InstructorDashboard.util.std_ajax_err.apply(this,arguments)},PendingInstructorTasks=function(){return window.InstructorDashboard.util.PendingInstructorTasks},create_task_list_table=function(){return window.InstructorDashboard.util.create_task_list_table.apply(this,arguments)},create_email_content_table=function(){return window.InstructorDashboard.util.create_email_content_table.apply(this,arguments)},create_email_message_views=function(){return window.InstructorDashboard.util.create_email_message_views.apply(this,arguments)},KeywordValidator=function(){return window.InstructorDashboard.util.KeywordValidator},SendEmail=function(){function SendEmail($container){var _this=this;this.$container=$container,this.$emailEditor=XBlock.initializeBlock($(".xblock-studio_view")),this.$send_to=this.$container.find("select[name='send_to']'"),this.$subject=this.$container.find("input[name='subject']'"),this.$btn_send=this.$container.find("input[name='send']'"),this.$task_response=this.$container.find(".request-response"),this.$request_response_error=this.$container.find(".request-response-error"),this.$content_request_response_error=this.$container.find(".content-request-response-error"),this.$history_request_response_error=this.$container.find(".history-request-response-error"),this.$btn_task_history_email=this.$container.find("input[name='task-history-email']'"),this.$btn_task_history_email_content=this.$container.find("input[name='task-history-email-content']'"),this.$table_task_history_email=this.$container.find(".task-history-email-table"),this.$table_email_content_history=this.$container.find(".content-history-email-table"),this.$email_content_table_inner=this.$container.find(".content-history-table-inner"),this.$email_messages_wrapper=this.$container.find(".email-messages-wrapper"),this.$btn_send.click(function(){var confirm_message,full_confirm_message,message,send_data,send_to,subject,success_message,validation;return""===_this.$subject.val()?alert(gettext("Your message must have a subject.")):""===_this.$emailEditor.save().data?alert(gettext("Your message cannot be blank.")):(validation=KeywordValidator().validate_string(_this.$emailEditor.save().data),validation.is_valid?(success_message=gettext("Your email was successfully queued for sending."),send_to=_this.$send_to.val().toLowerCase(),"myself"===send_to?confirm_message=gettext("You are about to send an email titled '<%= subject %>' to yourself. Is this OK?"):"staff"===send_to?confirm_message=gettext("You are about to send an email titled '<%= subject %>' to everyone who is staff or instructor on this course. Is this OK?"):(confirm_message=gettext("You are about to send an email titled '<%= subject %>' to ALL (everyone who is enrolled in this course as student, staff, or instructor). Is this OK?"),success_message=gettext("Your email was successfully queued for sending. Please note that for large classes, it may take up to an hour (or more, if other courses are simultaneously sending email) to send all emails.")),subject=_this.$subject.val(),full_confirm_message=_.template(confirm_message,{subject:subject}),confirm(full_confirm_message)?(send_data={action:"send",send_to:_this.$send_to.val(),subject:_this.$subject.val(),message:_this.$emailEditor.save().data},$.ajax({type:"POST",dataType:"json",url:_this.$btn_send.data("endpoint"),data:send_data,success:function(){return _this.display_response(success_message)},error:std_ajax_err(function(){return _this.fail_with_error(gettext("Error sending email."))})})):(_this.$task_response.empty(),_this.$request_response_error.empty())):(message=gettext("There are invalid keywords in your email. Please check the following keywords and try again:"),message+="\n"+validation.invalid_keywords.join("\n"),void alert(message)))}),this.$btn_task_history_email.click(function(){var url;return url=_this.$btn_task_history_email.data("endpoint"),$.ajax({dataType:"json",url:url,success:function(data){return data.tasks.length?create_task_list_table(_this.$table_task_history_email,data.tasks):(_this.$history_request_response_error.text(gettext("There is no email history for this course.")),_this.$history_request_response_error.css({display:"block"}))},error:std_ajax_err(function(){return _this.$history_request_response_error.text(gettext("There was an error obtaining email task history for this course."))})})}),this.$btn_task_history_email_content.click(function(){var url;return url=_this.$btn_task_history_email_content.data("endpoint"),$.ajax({dataType:"json",url:url,success:function(data){return data.emails.length?(create_email_content_table(_this.$table_email_content_history,_this.$email_content_table_inner,data.emails),create_email_message_views(_this.$email_messages_wrapper,data.emails)):(_this.$content_request_response_error.text(gettext("There is no email history for this course.")),_this.$content_request_response_error.css({display:"block"}))},error:std_ajax_err(function(){return _this.$content_request_response_error.text(gettext("There was an error obtaining email content history for this course."))})})})}return SendEmail.prototype.fail_with_error=function(msg){return console.warn(msg),this.$task_response.empty(),this.$request_response_error.empty(),this.$request_response_error.text(msg),$(".msg-confirm").css({display:"none"})},SendEmail.prototype.display_response=function(data_from_server){return this.$task_response.empty(),this.$request_response_error.empty(),this.$task_response.text(data_from_server),$(".msg-confirm").css({display:"block"})},SendEmail}(),Email=function(){function Email($section){var _this=this;this.$section=$section,this.$section.data("wrapper",this),plantTimeout(0,function(){return new SendEmail(_this.$section.find(".send-email"))}),this.instructor_tasks=new(PendingInstructorTasks())(this.$section)}return Email.prototype.onClickTitle=function(){return this.instructor_tasks.task_poller.start()},Email.prototype.onExit=function(){return this.instructor_tasks.task_poller.stop()},Email}(),_.defaults(window,{InstructorDashboard:{}}),_.defaults(window.InstructorDashboard,{sections:{}}),_.defaults(window.InstructorDashboard.sections,{Email:Email})}.call(this),function(){var PendingInstructorTasks,StudentAdmin,create_task_list_table,find_and_assert,std_ajax_err;std_ajax_err=function(){return window.InstructorDashboard.util.std_ajax_err.apply(this,arguments)},create_task_list_table=function(){return window.InstructorDashboard.util.create_task_list_table.apply(this,arguments)},PendingInstructorTasks=function(){return window.InstructorDashboard.util.PendingInstructorTasks},find_and_assert=function($root,selector){var item;if(item=$root.find(selector),1!==item.length)throw console.error("element selection failed for '"+selector+"' resulted in length "+item.length),"Failed Element Selection";return item},StudentAdmin=function(){function StudentAdmin($section){var _this=this;this.$section=$section,this.$section.data("wrapper",this),this.$field_student_select_progress=find_and_assert(this.$section,"input[name='student-select-progress']"),this.$field_student_select_grade=find_and_assert(this.$section,"input[name='student-select-grade']"),this.$progress_link=find_and_assert(this.$section,"a.progress-link"),this.$field_problem_select_single=find_and_assert(this.$section,"input[name='problem-select-single']"),this.$btn_reset_attempts_single=find_and_assert(this.$section,"input[name='reset-attempts-single']"),this.$btn_delete_state_single=this.$section.find("input[name='delete-state-single']"),this.$btn_rescore_problem_single=this.$section.find("input[name='rescore-problem-single']"),this.$btn_task_history_single=this.$section.find("input[name='task-history-single']"),this.$table_task_history_single=this.$section.find(".task-history-single-table"),this.$field_problem_select_all=this.$section.find("input[name='problem-select-all']"),this.$btn_reset_attempts_all=this.$section.find("input[name='reset-attempts-all']"),this.$btn_rescore_problem_all=this.$section.find("input[name='rescore-problem-all']"),this.$btn_task_history_all=this.$section.find("input[name='task-history-all']"),this.$table_task_history_all=this.$section.find(".task-history-all-table"),this.instructor_tasks=new(PendingInstructorTasks())(this.$section),this.$request_response_error_progress=find_and_assert(this.$section,".student-specific-container .request-response-error"),this.$request_response_error_grade=find_and_assert(this.$section,".student-grade-container .request-response-error"),this.$request_response_error_all=this.$section.find(".course-specific-container .request-response-error"),this.$progress_link.click(function(e){var error_message,full_error_message,unique_student_identifier;return e.preventDefault(),(unique_student_identifier=_this.$field_student_select_progress.val())?(error_message=gettext("Error getting student progress url for '<%= student_id %>'. Make sure that the student identifier is spelled correctly."),full_error_message=_.template(error_message,{student_id:unique_student_identifier}),$.ajax({dataType:"json",url:_this.$progress_link.data("endpoint"),data:{unique_student_identifier:unique_student_identifier},success:_this.clear_errors_then(function(data){return window.location=data.progress_url}),error:std_ajax_err(function(){return _this.$request_response_error_progress.text(full_error_message)})})):_this.$request_response_error_progress.text(gettext("Please enter a student email address or username."))}),this.$btn_reset_attempts_single.click(function(){var error_message,full_error_message,full_success_message,problem_to_reset,send_data,success_message,unique_student_identifier;return unique_student_identifier=_this.$field_student_select_grade.val(),problem_to_reset=_this.$field_problem_select_single.val(),unique_student_identifier?problem_to_reset?(send_data={unique_student_identifier:unique_student_identifier,problem_to_reset:problem_to_reset,delete_module:!1},success_message=gettext("Success! Problem attempts reset for problem '<%= problem_id %>' and student '<%= student_id %>'."),error_message=gettext("Error resetting problem attempts for problem '<%= problem_id %>' and student '<%= student_id %>'. Make sure that the problem and student identifiers are complete and correct."),full_success_message=_.template(success_message,{problem_id:problem_to_reset,student_id:unique_student_identifier}),full_error_message=_.template(error_message,{problem_id:problem_to_reset,student_id:unique_student_identifier}),$.ajax({dataType:"json",url:_this.$btn_reset_attempts_single.data("endpoint"),data:send_data,success:_this.clear_errors_then(function(){return alert(full_success_message)}),error:std_ajax_err(function(){return _this.$request_response_error_grade.text(full_error_message)})})):_this.$request_response_error_grade.text(gettext("Please enter a problem location.")):_this.$request_response_error_grade.text(gettext("Please enter a student email address or username."))}),this.$btn_delete_state_single.click(function(){var confirm_message,error_message,full_confirm_message,full_error_message,problem_to_reset,send_data,unique_student_identifier;return unique_student_identifier=_this.$field_student_select_grade.val(),problem_to_reset=_this.$field_problem_select_single.val(),unique_student_identifier?problem_to_reset?(confirm_message=gettext("Delete student '<%= student_id %>'s state on problem '<%= problem_id %>'?"),full_confirm_message=_.template(confirm_message,{student_id:unique_student_identifier,problem_id:problem_to_reset}),window.confirm(full_confirm_message)?(send_data={unique_student_identifier:unique_student_identifier,problem_to_reset:problem_to_reset,delete_module:!0},error_message=gettext("Error deleting student '<%= student_id %>'s state on problem '<%= problem_id %>'. Make sure that the problem and student identifiers are complete and correct."),full_error_message=_.template(error_message,{student_id:unique_student_identifier,problem_id:problem_to_reset}),$.ajax({dataType:"json",url:_this.$btn_delete_state_single.data("endpoint"),data:send_data,success:_this.clear_errors_then(function(){return alert(gettext("Module state successfully deleted."))}),error:std_ajax_err(function(){return _this.$request_response_error_grade.text(full_error_message)})})):_this.clear_errors()):_this.$request_response_error_grade.text(gettext("Please enter a problem location.")):_this.$request_response_error_grade.text(gettext("Please enter a student email address or username."))}),this.$btn_rescore_problem_single.click(function(){var error_message,full_error_message,full_success_message,problem_to_reset,send_data,success_message,unique_student_identifier;return unique_student_identifier=_this.$field_student_select_grade.val(),problem_to_reset=_this.$field_problem_select_single.val(),unique_student_identifier?problem_to_reset?(send_data={unique_student_identifier:unique_student_identifier,problem_to_reset:problem_to_reset},success_message=gettext("Started rescore problem task for problem '<%= problem_id %>' and student '<%= student_id %>'. Click the 'Show Background Task History for Student' button to see the status of the task."),full_success_message=_.template(success_message,{student_id:unique_student_identifier,problem_id:problem_to_reset}),error_message=gettext("Error starting a task to rescore problem '<%= problem_id %>' for student '<%= student_id %>'. Make sure that the the problem and student identifiers are complete and correct."),full_error_message=_.template(error_message,{student_id:unique_student_identifier,problem_id:problem_to_reset}),$.ajax({dataType:"json",url:_this.$btn_rescore_problem_single.data("endpoint"),data:send_data,success:_this.clear_errors_then(function(){return alert(full_success_message)
}),error:std_ajax_err(function(){return _this.$request_response_error_grade.text(full_error_message)})})):_this.$request_response_error_grade.text(gettext("Please enter a problem location.")):_this.$request_response_error_grade.text(gettext("Please enter a student email address or username."))}),this.$btn_task_history_single.click(function(){var error_message,full_error_message,problem_to_reset,send_data,unique_student_identifier;return unique_student_identifier=_this.$field_student_select_grade.val(),problem_to_reset=_this.$field_problem_select_single.val(),unique_student_identifier?problem_to_reset?(send_data={unique_student_identifier:unique_student_identifier,problem_location_str:problem_to_reset},error_message=gettext("Error getting task history for problem '<%= problem_id %>' and student '<%= student_id %>'. Make sure that the problem and student identifiers are complete and correct."),full_error_message=_.template(error_message,{student_id:unique_student_identifier,problem_id:problem_to_reset}),$.ajax({dataType:"json",url:_this.$btn_task_history_single.data("endpoint"),data:send_data,success:_this.clear_errors_then(function(data){return create_task_list_table(_this.$table_task_history_single,data.tasks)}),error:std_ajax_err(function(){return _this.$request_response_error_grade.text(full_error_message)})})):_this.$request_response_error_grade.text(gettext("Please enter a problem location.")):_this.$request_response_error_grade.text(gettext("Please enter a student email address or username."))}),this.$btn_reset_attempts_all.click(function(){var confirm_message,error_message,full_confirm_message,full_error_message,full_success_message,problem_to_reset,send_data,success_message;return(problem_to_reset=_this.$field_problem_select_all.val())?(confirm_message=gettext("Reset attempts for all students on problem '<%= problem_id %>'?"),full_confirm_message=_.template(confirm_message,{problem_id:problem_to_reset}),window.confirm(full_confirm_message)?(send_data={all_students:!0,problem_to_reset:problem_to_reset},success_message=gettext("Successfully started task to reset attempts for problem '<%= problem_id %>'. Click the 'Show Background Task History for Problem' button to see the status of the task."),full_success_message=_.template(success_message,{problem_id:problem_to_reset}),error_message=gettext("Error starting a task to reset attempts for all students on problem '<%= problem_id %>'. Make sure that the problem identifier is complete and correct."),full_error_message=_.template(error_message,{problem_id:problem_to_reset}),$.ajax({dataType:"json",url:_this.$btn_reset_attempts_all.data("endpoint"),data:send_data,success:_this.clear_errors_then(function(){return alert(full_success_message)}),error:std_ajax_err(function(){return _this.$request_response_error_all.text(full_error_message)})})):_this.clear_errors()):_this.$request_response_error_all.text(gettext("Please enter a problem location."))}),this.$btn_rescore_problem_all.click(function(){var confirm_message,error_message,full_confirm_message,full_error_message,full_success_message,problem_to_reset,send_data,success_message;return(problem_to_reset=_this.$field_problem_select_all.val())?(confirm_message=gettext("Rescore problem '<%= problem_id %>' for all students?"),full_confirm_message=_.template(confirm_message,{problem_id:problem_to_reset}),window.confirm(full_confirm_message)?(send_data={all_students:!0,problem_to_reset:problem_to_reset},success_message=gettext("Successfully started task to rescore problem '<%= problem_id %>' for all students. Click the 'Show Background Task History for Problem' button to see the status of the task."),full_success_message=_.template(success_message,{problem_id:problem_to_reset}),error_message=gettext("Error starting a task to rescore problem '<%= problem_id %>'. Make sure that the problem identifier is complete and correct."),full_error_message=_.template(error_message,{problem_id:problem_to_reset}),$.ajax({dataType:"json",url:_this.$btn_rescore_problem_all.data("endpoint"),data:send_data,success:_this.clear_errors_then(function(){return alert(full_success_message)}),error:std_ajax_err(function(){return _this.$request_response_error_all.text(full_error_message)})})):_this.clear_errors()):_this.$request_response_error_all.text(gettext("Please enter a problem location."))}),this.$btn_task_history_all.click(function(){var send_data;return send_data={problem_location_str:_this.$field_problem_select_all.val()},send_data.problem_location_str?$.ajax({dataType:"json",url:_this.$btn_task_history_all.data("endpoint"),data:send_data,success:_this.clear_errors_then(function(data){return create_task_list_table(_this.$table_task_history_all,data.tasks)}),error:std_ajax_err(function(){return _this.$request_response_error_all.text(gettext("Error listing task history for this student and problem."))})}):_this.$request_response_error_all.text(gettext("Please enter a problem location."))})}return StudentAdmin.prototype.clear_errors_then=function(cb){return this.$request_response_error_progress.empty(),this.$request_response_error_grade.empty(),this.$request_response_error_all.empty(),function(){return null!=cb?cb.apply(this,arguments):void 0}},StudentAdmin.prototype.clear_errors=function(){return this.$request_response_error_progress.empty(),this.$request_response_error_grade.empty(),this.$request_response_error_all.empty()},StudentAdmin.prototype.onClickTitle=function(){return this.instructor_tasks.task_poller.start()},StudentAdmin.prototype.onExit=function(){return this.instructor_tasks.task_poller.stop()},StudentAdmin}(),_.defaults(window,{InstructorDashboard:{}}),_.defaults(window.InstructorDashboard,{sections:{}}),_.defaults(window.InstructorDashboard.sections,{StudentAdmin:StudentAdmin})}.call(this),function(){var IntervalManager,KeywordValidator,PendingInstructorTasks,create_email_content_table,create_email_message_views,create_task_list_table,created_formatter,find_and_assert,number_sent_formatter,plantInterval,plantTimeout,sent_by_formatter,setup_copy_email_button,std_ajax_err,subject_formatter,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};plantTimeout=function(ms,cb){return setTimeout(cb,ms)},plantInterval=function(ms,cb){return setInterval(cb,ms)},find_and_assert=function($root,selector){var item;if(item=$root.find(selector),1!==item.length)throw console.error("element selection failed for '"+selector+"' resulted in length "+item.length),"Failed Element Selection";return item},std_ajax_err=function(handler){return function(jqXHR,textStatus,errorThrown){return console.warn("ajax error\ntextStatus: "+textStatus+"\nerrorThrown: "+errorThrown),handler.apply(this,arguments)}},create_task_list_table=function($table_tasks,tasks_data){var $table_placeholder,columns,grid,options,table_data;return $table_tasks.empty(),options={enableCellNavigation:!0,enableColumnReorder:!1,autoHeight:!0,rowHeight:100,forceFitColumns:!0},columns=[{id:"task_type",field:"task_type",name:gettext("Task Type"),minWidth:102},{id:"task_input",field:"task_input",name:gettext("Task inputs"),minWidth:150},{id:"task_id",field:"task_id",name:gettext("Task ID"),minWidth:150},{id:"requester",field:"requester",name:gettext("Requester"),minWidth:80},{id:"created",field:"created",name:gettext("Submitted"),minWidth:120},{id:"duration_sec",field:"duration_sec",name:gettext("Duration (sec)"),minWidth:80},{id:"task_state",field:"task_state",name:gettext("State"),minWidth:80},{id:"status",field:"status",name:gettext("Task Status"),minWidth:80},{id:"task_message",field:"task_message",name:gettext("Task Progress"),minWidth:120}],table_data=tasks_data,$table_placeholder=$("<div/>",{"class":"slickgrid"}),$table_tasks.append($table_placeholder),grid=new Slick.Grid($table_placeholder,table_data,columns,options)},subject_formatter=function(row,cell,value){var subject_text;return null===value?gettext("An error occurred retrieving your email. Please try again later, and contact technical support if the problem persists."):(subject_text=$("<span>").text(value.subject).html(),'<p><a href="#email_message_'+value.id+'" id="email_message_'+value.id+'_trig">'+subject_text+"</a></p>")},sent_by_formatter=function(row,cell,value){return null===value?"<p>"+gettext("Unknown")+"</p>":"<p>"+value+"</p>"},created_formatter=function(row,cell,value){return null===value?"<p>"+gettext("Unknown")+"</p>":"<p>"+value+"</p>"},number_sent_formatter=function(row,cell,value){return null===value?"<p>"+gettext("Unknown")+"</p>":"<p>"+value+"</p>"},create_email_content_table=function($table_emails,$table_emails_inner,email_data){var $table_placeholder,columns,grid,options,table_data;return $table_emails_inner.empty(),$table_emails.show(),options={enableCellNavigation:!0,enableColumnReorder:!1,autoHeight:!0,rowHeight:50,forceFitColumns:!0},columns=[{id:"email",field:"email",name:gettext("Subject"),minWidth:80,cssClass:"email-content-cell",formatter:subject_formatter},{id:"requester",field:"requester",name:gettext("Sent By"),minWidth:80,maxWidth:100,cssClass:"email-content-cell",formatter:sent_by_formatter},{id:"created",field:"created",name:gettext("Time Sent"),minWidth:80,cssClass:"email-content-cell",formatter:created_formatter},{id:"number_sent",field:"number_sent",name:gettext("Number Sent"),minwidth:100,maxWidth:150,cssClass:"email-content-cell",formatter:number_sent_formatter}],table_data=email_data,$table_placeholder=$("<div/>",{"class":"slickgrid"}),$table_emails_inner.append($table_placeholder),grid=new Slick.Grid($table_placeholder,table_data,columns,options),$table_emails.append($("<br/>"))},create_email_message_views=function($messages_wrapper,emails){var $close_button,$email_content,$email_header,$email_wrapper,$message,$message_content,email_id,email_info,subject_text,_i,_len;for($messages_wrapper.empty(),_i=0,_len=emails.length;_len>_i;_i++){if(email_info=emails[_i],!email_info.email)return;email_id=email_info.email.id,$message_content=$("<section>",{"aria-hidden":"true","class":"modal email-modal",id:"email_message_"+email_id}),$email_wrapper=$("<div>",{"class":"inner-wrapper email-content-wrapper"}),$email_header=$("<div>",{"class":"email-content-header"}),$email_header.append($("<input>",{type:"button",name:"copy-email-body-text",value:gettext("Copy Email To Editor"),id:"copy_email_"+email_id})),$close_button=$("<a>",{href:"#","class":"close-modal"}),$close_button.append($("<i>",{"class":"icon fa fa-times"})),$email_header.append($close_button),subject_text=$("<span>").text(email_info.email.subject).html(),$email_header.append($("<h2>",{"class":"message-bold"}).html("<em>"+gettext("Subject:")+"</em> "+subject_text)),$email_header.append($("<h2>",{"class":"message-bold"}).html("<em>"+gettext("Sent By:")+"</em> "+email_info.requester)),$email_header.append($("<h2>",{"class":"message-bold"}).html("<em>"+gettext("Time Sent:")+"</em> "+email_info.created)),$email_header.append($("<h2>",{"class":"message-bold"}).html("<em>"+gettext("Sent To:")+"</em> "+email_info.sent_to)),$email_wrapper.append($email_header),$email_wrapper.append($("<hr>")),$email_content=$("<div>",{"class":"email-content-message"}),$email_content.append($("<h2>",{"class":"message-bold"}).html("<em>"+gettext("Message:")+"</em>")),$message=$("<div>").html(email_info.email.html_message),$email_content.append($message),$email_wrapper.append($email_content),$message_content.append($email_wrapper),$messages_wrapper.append($message_content),$("#email_message_"+email_info.email.id+"_trig").leanModal({closeButton:".close-modal",copyEmailButton:"#copy_email_"+email_id}),setup_copy_email_button(email_id,email_info.email.html_message,email_info.email.subject)}},setup_copy_email_button=function(email_id,html_message,subject){return $("#copy_email_"+email_id).click(function(){var editor;return editor=tinyMCE.get("mce_0"),editor.setContent(html_message),$("#id_subject").val(subject)})},IntervalManager=function(){function IntervalManager(ms,fn){this.ms=ms,this.fn=fn,this.intervalID=null}return IntervalManager.prototype.start=function(){return this.fn(),null===this.intervalID?this.intervalID=setInterval(this.fn,this.ms):void 0},IntervalManager.prototype.stop=function(){return clearInterval(this.intervalID),this.intervalID=null},IntervalManager}(),PendingInstructorTasks=function(){function PendingInstructorTasks($section){var TASK_LIST_POLL_INTERVAL,_this=this;this.$section=$section,this.reload_running_tasks_list=function(){return PendingInstructorTasks.prototype.reload_running_tasks_list.apply(_this,arguments)},this.$running_tasks_section=find_and_assert(this.$section,".running-tasks-section"),this.$table_running_tasks=find_and_assert(this.$section,".running-tasks-table"),this.$no_tasks_message=find_and_assert(this.$section,".no-pending-tasks-message"),this.$table_running_tasks.length&&(TASK_LIST_POLL_INTERVAL=2e4,this.reload_running_tasks_list(),this.task_poller=new IntervalManager(TASK_LIST_POLL_INTERVAL,function(){return _this.reload_running_tasks_list()}))}return PendingInstructorTasks.prototype.reload_running_tasks_list=function(){var list_endpoint,_this=this;return list_endpoint=this.$table_running_tasks.data("endpoint"),$.ajax({dataType:"json",url:list_endpoint,success:function(data){return data.tasks.length?(create_task_list_table(_this.$table_running_tasks,data.tasks),_this.$no_tasks_message.hide(),_this.$running_tasks_section.show()):(console.log("No pending instructor tasks to display"),_this.$running_tasks_section.hide(),_this.$no_tasks_message.empty(),_this.$no_tasks_message.append($("<p>").text(gettext("No tasks currently running."))),_this.$no_tasks_message.show())},error:std_ajax_err(function(){return console.error("Error finding pending instructor tasks to display")})})},PendingInstructorTasks}(),KeywordValidator=function(){function KeywordValidator(){}return KeywordValidator.keyword_regex=/%%+[^%]+%%/g,KeywordValidator.keywords=["%%USER_ID%%","%%USER_FULLNAME%%","%%COURSE_DISPLAY_NAME%%","%%COURSE_END_DATE%%"],KeywordValidator.validate_string=function(string){var found_keyword,found_keywords,invalid_keywords,is_valid,keywords,regex_match,_fn,_i,_len;for(regex_match=string.match(KeywordValidator.keyword_regex),found_keywords=null===regex_match?[]:regex_match,invalid_keywords=[],is_valid=!0,keywords=KeywordValidator.keywords,_fn=function(found_keyword){return __indexOf.call(keywords,found_keyword)<0?invalid_keywords.push(found_keyword):void 0},_i=0,_len=found_keywords.length;_len>_i;_i++)found_keyword=found_keywords[_i],_fn(found_keyword);return 0!==invalid_keywords.length&&(is_valid=!1),{is_valid:is_valid,invalid_keywords:invalid_keywords}},KeywordValidator}.call(this),"undefined"!=typeof _&&null!==_&&(_.defaults(window,{InstructorDashboard:{}}),window.InstructorDashboard.util={plantTimeout:plantTimeout,plantInterval:plantInterval,std_ajax_err:std_ajax_err,IntervalManager:IntervalManager,create_task_list_table:create_task_list_table,create_email_content_table:create_email_content_table,create_email_message_views:create_email_message_views,PendingInstructorTasks:PendingInstructorTasks,KeywordValidator:KeywordValidator})}.call(this);